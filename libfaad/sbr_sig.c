#include "common.h"

#ifdef SBR_DEC
  #include "structs.h"
  #include "sbr_sig.h"

  #define EPS (1e-12)

  #ifdef _MSC_VER
    #pragma warning(disable:4305)
    #pragma warning(disable:4244)
  #endif

  /*{{{  struct acorr_coef*/
  typedef struct {
    complex_t r01;
    complex_t r02;
    complex_t r11;
    complex_t r12;
    complex_t r22;
    real_t det;
    } acorr_coef;
  /*}}}*/
  /*{{{*/
  /* Table 1.A.13 Noise table V */
  ALIGN static const complex_t V[] = {
      { FRAC_CONST(-0.99948155879974), FRAC_CONST(-0.59483414888382) },
      { FRAC_CONST(0.97113454341888), FRAC_CONST(-0.67528516054153) },
      { FRAC_CONST(0.14130051434040), FRAC_CONST(-0.95090985298157) },
      { FRAC_CONST(-0.47005495429039), FRAC_CONST(-0.37340548634529) },
      { FRAC_CONST(0.80705064535141), FRAC_CONST(0.29653668403625) },
      { FRAC_CONST(-0.38981479406357), FRAC_CONST(0.89572608470917) },
      { FRAC_CONST(-0.01053049881011), FRAC_CONST(-0.66959059238434) },
      { FRAC_CONST(-0.91266369819641), FRAC_CONST(-0.11522938311100) },
      { FRAC_CONST(0.54840421676636), FRAC_CONST(0.75221365690231) },
      { FRAC_CONST(0.40009254217148), FRAC_CONST(-0.98929399251938) },
      { FRAC_CONST(-0.99867975711823), FRAC_CONST(-0.88147068023682) },
      { FRAC_CONST(-0.95531076192856), FRAC_CONST(0.90908759832382) },
      { FRAC_CONST(-0.45725932717323), FRAC_CONST(-0.56716322898865) },
      { FRAC_CONST(-0.72929674386978), FRAC_CONST(-0.98008275032043) },
      { FRAC_CONST(0.75622802972794), FRAC_CONST(0.20950329303741) },
      { FRAC_CONST(0.07069442421198), FRAC_CONST(-0.78247898817062) },
      { FRAC_CONST(0.74496251344681), FRAC_CONST(-0.91169005632401) },
      { FRAC_CONST(-0.96440184116364), FRAC_CONST(-0.94739919900894) },
      { FRAC_CONST(0.30424630641937), FRAC_CONST(-0.49438267946243) },
      { FRAC_CONST(0.66565030813217), FRAC_CONST(0.64652937650681) },
      { FRAC_CONST(0.91697007417679), FRAC_CONST(0.17514097690582) },
      { FRAC_CONST(-0.70774918794632), FRAC_CONST(0.52548652887344) },
      { FRAC_CONST(-0.70051413774490), FRAC_CONST(-0.45340028405190) },
      { FRAC_CONST(-0.99496513605118), FRAC_CONST(-0.90071910619736) },
      { FRAC_CONST(0.98164492845535), FRAC_CONST(-0.77463155984879) },
      { FRAC_CONST(-0.54671579599380), FRAC_CONST(-0.02570928446949) },
      { FRAC_CONST(-0.01689629070461), FRAC_CONST(0.00287506449968) },
      { FRAC_CONST(-0.86110347509384), FRAC_CONST(0.42548584938049) },
      { FRAC_CONST(-0.98892980813980), FRAC_CONST(-0.87881129980087) },
      { FRAC_CONST(0.51756626367569), FRAC_CONST(0.66926783323288) },
      { FRAC_CONST(-0.99635028839111), FRAC_CONST(-0.58107727766037) },
      { FRAC_CONST(-0.99969369173050), FRAC_CONST(0.98369991779327) },
      { FRAC_CONST(0.55266261100769), FRAC_CONST(0.59449058771133) },
      { FRAC_CONST(0.34581178426743), FRAC_CONST(0.94879418611526) },
      { FRAC_CONST(0.62664210796356), FRAC_CONST(-0.74402970075607) },
      { FRAC_CONST(-0.77149701118469), FRAC_CONST(-0.33883658051491) },
      { FRAC_CONST(-0.91592246294022), FRAC_CONST(0.03687901422381) },
      { FRAC_CONST(-0.76285493373871), FRAC_CONST(-0.91371870040894) },
      { FRAC_CONST(0.79788339138031), FRAC_CONST(-0.93180972337723) },
      { FRAC_CONST(0.54473078250885), FRAC_CONST(-0.11919206380844) },
      { FRAC_CONST(-0.85639280080795), FRAC_CONST(0.42429855465889) },
      { FRAC_CONST(-0.92882400751114), FRAC_CONST(0.27871808409691) },
      { FRAC_CONST(-0.11708371341228), FRAC_CONST(-0.99800843000412) },
      { FRAC_CONST(0.21356749534607), FRAC_CONST(-0.90716296434402) },
      { FRAC_CONST(-0.76191693544388), FRAC_CONST(0.99768120050430) },
      { FRAC_CONST(0.98111045360565), FRAC_CONST(-0.95854461193085) },
      { FRAC_CONST(-0.85913270711899), FRAC_CONST(0.95766568183899) },
      { FRAC_CONST(-0.93307244777679), FRAC_CONST(0.49431759119034) },
      { FRAC_CONST(0.30485755205154), FRAC_CONST(-0.70540034770966) },
      { FRAC_CONST(0.85289651155472), FRAC_CONST(0.46766132116318) },
      { FRAC_CONST(0.91328084468842), FRAC_CONST(-0.99839597940445) },
      { FRAC_CONST(-0.05890199914575), FRAC_CONST(0.70741826295853) },
      { FRAC_CONST(0.28398686647415), FRAC_CONST(0.34633556008339) },
      { FRAC_CONST(0.95258164405823), FRAC_CONST(-0.54893416166306) },
      { FRAC_CONST(-0.78566324710846), FRAC_CONST(-0.75568538904190) },
      { FRAC_CONST(-0.95789498090744), FRAC_CONST(-0.20423194766045) },
      { FRAC_CONST(0.82411158084869), FRAC_CONST(0.96654617786407) },
      { FRAC_CONST(-0.65185445547104), FRAC_CONST(-0.88734990358353) },
      { FRAC_CONST(-0.93643605709076), FRAC_CONST(0.99870789051056) },
      { FRAC_CONST(0.91427159309387), FRAC_CONST(-0.98290503025055) },
      { FRAC_CONST(-0.70395684242249), FRAC_CONST(0.58796799182892) },
      { FRAC_CONST(0.00563771976158), FRAC_CONST(0.61768198013306) },
      { FRAC_CONST(0.89065051078796), FRAC_CONST(0.52783352136612) },
      { FRAC_CONST(-0.68683707714081), FRAC_CONST(0.80806946754456) },
      { FRAC_CONST(0.72165340185165), FRAC_CONST(-0.69259858131409) },
      { FRAC_CONST(-0.62928247451782), FRAC_CONST(0.13627037405968) },
      { FRAC_CONST(0.29938435554504), FRAC_CONST(-0.46051329374313) },
      { FRAC_CONST(-0.91781955957413), FRAC_CONST(-0.74012714624405) },
      { FRAC_CONST(0.99298715591431), FRAC_CONST(0.40816611051559) },
      { FRAC_CONST(0.82368296384811), FRAC_CONST(-0.74036049842834) },
      { FRAC_CONST(-0.98512834310532), FRAC_CONST(-0.99972331523895) },
      { FRAC_CONST(-0.95915371179581), FRAC_CONST(-0.99237799644470) },
      { FRAC_CONST(-0.21411126852036), FRAC_CONST(-0.93424820899963) },
      { FRAC_CONST(-0.68821477890015), FRAC_CONST(-0.26892307400703) },
      { FRAC_CONST(0.91851997375488), FRAC_CONST(0.09358228743076) },
      { FRAC_CONST(-0.96062767505646), FRAC_CONST(0.36099094152451) },
      { FRAC_CONST(0.51646184921265), FRAC_CONST(-0.71373331546783) },
      { FRAC_CONST(0.61130720376968), FRAC_CONST(0.46950140595436) },
      { FRAC_CONST(0.47336128354073), FRAC_CONST(-0.27333179116249) },
      { FRAC_CONST(0.90998309850693), FRAC_CONST(0.96715664863586) },
      { FRAC_CONST(0.44844800233841), FRAC_CONST(0.99211573600769) },
      { FRAC_CONST(0.66614890098572), FRAC_CONST(0.96590173244476) },
      { FRAC_CONST(0.74922239780426), FRAC_CONST(-0.89879858493805) },
      { FRAC_CONST(-0.99571585655212), FRAC_CONST(0.52785521745682) },
      { FRAC_CONST(0.97401082515717), FRAC_CONST(-0.16855870187283) },
      { FRAC_CONST(0.72683745622635), FRAC_CONST(-0.48060774803162) },
      { FRAC_CONST(0.95432192087173), FRAC_CONST(0.68849605321884) },
      { FRAC_CONST(-0.72962206602097), FRAC_CONST(-0.76608443260193) },
      { FRAC_CONST(-0.85359477996826), FRAC_CONST(0.88738125562668) },
      { FRAC_CONST(-0.81412428617477), FRAC_CONST(-0.97480767965317) },
      { FRAC_CONST(-0.87930774688721), FRAC_CONST(0.74748307466507) },
      { FRAC_CONST(-0.71573328971863), FRAC_CONST(-0.98570609092712) },
      { FRAC_CONST(0.83524298667908), FRAC_CONST(0.83702534437180) },
      { FRAC_CONST(-0.48086065053940), FRAC_CONST(-0.98848503828049) },
      { FRAC_CONST(0.97139126062393), FRAC_CONST(0.80093622207642) },
      { FRAC_CONST(0.51992827653885), FRAC_CONST(0.80247628688812) },
      { FRAC_CONST(-0.00848591234535), FRAC_CONST(-0.76670128107071) },
      { FRAC_CONST(-0.70294374227524), FRAC_CONST(0.55359911918640) },
      { FRAC_CONST(-0.95894426107407), FRAC_CONST(-0.43265503644943) },
      { FRAC_CONST(0.97079253196716), FRAC_CONST(0.09325857460499) },
      { FRAC_CONST(-0.92404294013977), FRAC_CONST(0.85507702827454) },
      { FRAC_CONST(-0.69506472349167), FRAC_CONST(0.98633414506912) },
      { FRAC_CONST(0.26559203863144), FRAC_CONST(0.73314309120178) },
      { FRAC_CONST(0.28038442134857), FRAC_CONST(0.14537914097309) },
      { FRAC_CONST(-0.74138122797012), FRAC_CONST(0.99310338497162) },
      { FRAC_CONST(-0.01752796024084), FRAC_CONST(-0.82616633176804) },
      { FRAC_CONST(-0.55126774311066), FRAC_CONST(-0.98898541927338) },
      { FRAC_CONST(0.97960901260376), FRAC_CONST(-0.94021445512772) },
      { FRAC_CONST(-0.99196308851242), FRAC_CONST(0.67019015550613) },
      { FRAC_CONST(-0.67684930562973), FRAC_CONST(0.12631492316723) },
      { FRAC_CONST(0.09140039235353), FRAC_CONST(-0.20537731051445) },
      { FRAC_CONST(-0.71658962965012), FRAC_CONST(-0.97788202762604) },
      { FRAC_CONST(0.81014639139175), FRAC_CONST(0.53722649812698) },
      { FRAC_CONST(0.40616992115974), FRAC_CONST(-0.26469007134438) },
      { FRAC_CONST(-0.67680186033249), FRAC_CONST(0.94502049684525) },
      { FRAC_CONST(0.86849772930145), FRAC_CONST(-0.18333598971367) },
      { FRAC_CONST(-0.99500381946564), FRAC_CONST(-0.02634122036397) },
      { FRAC_CONST(0.84329187870026), FRAC_CONST(0.10406957566738) },
      { FRAC_CONST(-0.09215968847275), FRAC_CONST(0.69540011882782) },
      { FRAC_CONST(0.99956172704697), FRAC_CONST(-0.12358541786671) },
      { FRAC_CONST(-0.79732781648636), FRAC_CONST(-0.91582524776459) },
      { FRAC_CONST(0.96349972486496), FRAC_CONST(0.96640455722809) },
      { FRAC_CONST(-0.79942780733109), FRAC_CONST(0.64323902130127) },
      { FRAC_CONST(-0.11566039919853), FRAC_CONST(0.28587844967842) },
      { FRAC_CONST(-0.39922955632210), FRAC_CONST(0.94129604101181) },
      { FRAC_CONST(0.99089199304581), FRAC_CONST(-0.92062628269196) },
      { FRAC_CONST(0.28631284832954), FRAC_CONST(-0.91035044193268) },
      { FRAC_CONST(-0.83302724361420), FRAC_CONST(-0.67330408096313) },
      { FRAC_CONST(0.95404446125031), FRAC_CONST(0.49162766337395) },
      { FRAC_CONST(-0.06449863314629), FRAC_CONST(0.03250560909510) },
      { FRAC_CONST(-0.99575054645538), FRAC_CONST(0.42389783263206) },
      { FRAC_CONST(-0.65501141548157), FRAC_CONST(0.82546114921570) },
      { FRAC_CONST(-0.81254440546036), FRAC_CONST(-0.51627236604691) },
      { FRAC_CONST(-0.99646371603012), FRAC_CONST(0.84490531682968) },
      { FRAC_CONST(0.00287840608507), FRAC_CONST(0.64768260717392) },
      { FRAC_CONST(0.70176988840103), FRAC_CONST(-0.20453028380871) },
      { FRAC_CONST(0.96361881494522), FRAC_CONST(0.40706968307495) },
      { FRAC_CONST(-0.68883758783340), FRAC_CONST(0.91338956356049) },
      { FRAC_CONST(-0.34875586628914), FRAC_CONST(0.71472293138504) },
      { FRAC_CONST(0.91980081796646), FRAC_CONST(0.66507452726364) },
      { FRAC_CONST(-0.99009048938751), FRAC_CONST(0.85868018865585) },
      { FRAC_CONST(0.68865793943405), FRAC_CONST(0.55660319328308) },
      { FRAC_CONST(-0.99484401941299), FRAC_CONST(-0.20052559673786) },
      { FRAC_CONST(0.94214510917664), FRAC_CONST(-0.99696427583694) },
      { FRAC_CONST(-0.67414629459381), FRAC_CONST(0.49548220634460) },
      { FRAC_CONST(-0.47339352965355), FRAC_CONST(-0.85904330015182) },
      { FRAC_CONST(0.14323651790619), FRAC_CONST(-0.94145596027374) },
      { FRAC_CONST(-0.29268294572830), FRAC_CONST(0.05759225040674) },
      { FRAC_CONST(0.43793860077858), FRAC_CONST(-0.78904968500137) },
      { FRAC_CONST(-0.36345127224922), FRAC_CONST(0.64874434471130) },
      { FRAC_CONST(-0.08750604838133), FRAC_CONST(0.97686946392059) },
      { FRAC_CONST(-0.96495270729065), FRAC_CONST(-0.53960305452347) },
      { FRAC_CONST(0.55526942014694), FRAC_CONST(0.78891521692276) },
      { FRAC_CONST(0.73538213968277), FRAC_CONST(0.96452075242996) },
      { FRAC_CONST(-0.30889773368835), FRAC_CONST(-0.80664390325546) },
      { FRAC_CONST(0.03574995696545), FRAC_CONST(-0.97325617074966) },
      { FRAC_CONST(0.98720687627792), FRAC_CONST(0.48409134149551) },
      { FRAC_CONST(-0.81689298152924), FRAC_CONST(-0.90827703475952) },
      { FRAC_CONST(0.67866861820221), FRAC_CONST(0.81284505128860) },
      { FRAC_CONST(-0.15808570384979), FRAC_CONST(0.85279554128647) },
      { FRAC_CONST(0.80723392963409), FRAC_CONST(-0.24717418849468) },
      { FRAC_CONST(0.47788757085800), FRAC_CONST(-0.46333149075508) },
      { FRAC_CONST(0.96367555856705), FRAC_CONST(0.38486748933792) },
      { FRAC_CONST(-0.99143874645233), FRAC_CONST(-0.24945276975632) },
      { FRAC_CONST(0.83081877231598), FRAC_CONST(-0.94780850410461) },
      { FRAC_CONST(-0.58753192424774), FRAC_CONST(0.01290772389621) },
      { FRAC_CONST(0.95538109540939), FRAC_CONST(-0.85557049512863) },
      { FRAC_CONST(-0.96490919589996), FRAC_CONST(-0.64020973443985) },
      { FRAC_CONST(-0.97327101230621), FRAC_CONST(0.12378127872944) },
      { FRAC_CONST(0.91400367021561), FRAC_CONST(0.57972472906113) },
      { FRAC_CONST(-0.99925839900970), FRAC_CONST(0.71084845066071) },
      { FRAC_CONST(-0.86875903606415), FRAC_CONST(-0.20291699469090) },
      { FRAC_CONST(-0.26240035891533), FRAC_CONST(-0.68264555931091) },
      { FRAC_CONST(-0.24664412438869), FRAC_CONST(-0.87642270326614) },
      { FRAC_CONST(0.02416275814176), FRAC_CONST(0.27192914485931) },
      { FRAC_CONST(0.82068622112274), FRAC_CONST(-0.85087788105011) },
      { FRAC_CONST(0.88547372817993), FRAC_CONST(-0.89636802673340) },
      { FRAC_CONST(-0.18173077702522), FRAC_CONST(-0.26152145862579) },
      { FRAC_CONST(0.09355476498604), FRAC_CONST(0.54845124483109) },
      { FRAC_CONST(-0.54668414592743), FRAC_CONST(0.95980775356293) },
      { FRAC_CONST(0.37050989270210), FRAC_CONST(-0.59910142421722) },
      { FRAC_CONST(-0.70373594760895), FRAC_CONST(0.91227668523788) },
      { FRAC_CONST(-0.34600785374641), FRAC_CONST(-0.99441426992416) },
      { FRAC_CONST(-0.68774479627609), FRAC_CONST(-0.30238837003708) },
      { FRAC_CONST(-0.26843291521072), FRAC_CONST(0.83115667104721) },
      { FRAC_CONST(0.49072334170341), FRAC_CONST(-0.45359709858894) },
      { FRAC_CONST(0.38975992798805), FRAC_CONST(0.95515358448029) },
      { FRAC_CONST(-0.97757124900818), FRAC_CONST(0.05305894464254) },
      { FRAC_CONST(-0.17325553297997), FRAC_CONST(-0.92770671844482) },
      { FRAC_CONST(0.99948036670685), FRAC_CONST(0.58285546302795) },
      { FRAC_CONST(-0.64946246147156), FRAC_CONST(0.68645507097244) },
      { FRAC_CONST(-0.12016920745373), FRAC_CONST(-0.57147324085236) },
      { FRAC_CONST(-0.58947455883026), FRAC_CONST(-0.34847131371498) },
      { FRAC_CONST(-0.41815140843391), FRAC_CONST(0.16276422142982) },
      { FRAC_CONST(0.99885648488998), FRAC_CONST(0.11136095225811) },
      { FRAC_CONST(-0.56649613380432), FRAC_CONST(-0.90494865179062) },
      { FRAC_CONST(0.94138020277023), FRAC_CONST(0.35281917452812) },
      { FRAC_CONST(-0.75725078582764), FRAC_CONST(0.53650552034378) },
      { FRAC_CONST(0.20541973412037), FRAC_CONST(-0.94435143470764) },
      { FRAC_CONST(0.99980372190475), FRAC_CONST(0.79835915565491) },
      { FRAC_CONST(0.29078277945518), FRAC_CONST(0.35393777489662) },
      { FRAC_CONST(-0.62858772277832), FRAC_CONST(0.38765692710876) },
      { FRAC_CONST(0.43440905213356), FRAC_CONST(-0.98546332120895) },
      { FRAC_CONST(-0.98298585414886), FRAC_CONST(0.21021524071693) },
      { FRAC_CONST(0.19513028860092), FRAC_CONST(-0.94239830970764) },
      { FRAC_CONST(-0.95476663112640), FRAC_CONST(0.98364555835724) },
      { FRAC_CONST(0.93379634618759), FRAC_CONST(-0.70881992578506) },
      { FRAC_CONST(-0.85235410928726), FRAC_CONST(-0.08342348039150) },
      { FRAC_CONST(-0.86425095796585), FRAC_CONST(-0.45795026421547) },
      { FRAC_CONST(0.38879778981209), FRAC_CONST(0.97274428606033) },
      { FRAC_CONST(0.92045122385025), FRAC_CONST(-0.62433654069901) },
      { FRAC_CONST(0.89162534475327), FRAC_CONST(0.54950958490372) },
      { FRAC_CONST(-0.36834338307381), FRAC_CONST(0.96458297967911) },
      { FRAC_CONST(0.93891763687134), FRAC_CONST(-0.89968353509903) },
      { FRAC_CONST(0.99267655611038), FRAC_CONST(-0.03757034242153) },
      { FRAC_CONST(-0.94063472747803), FRAC_CONST(0.41332337260246) },
      { FRAC_CONST(0.99740225076675), FRAC_CONST(-0.16830494999886) },
      { FRAC_CONST(-0.35899412631989), FRAC_CONST(-0.46633225679398) },
      { FRAC_CONST(0.05237237364054), FRAC_CONST(-0.25640362501144) },
      { FRAC_CONST(0.36703583598137), FRAC_CONST(-0.38653266429901) },
      { FRAC_CONST(0.91653180122375), FRAC_CONST(-0.30587628483772) },
      { FRAC_CONST(0.69000804424286), FRAC_CONST(0.90952169895172) },
      { FRAC_CONST(-0.38658750057220), FRAC_CONST(0.99501574039459) },
      { FRAC_CONST(-0.29250815510750), FRAC_CONST(0.37444993853569) },
      { FRAC_CONST(-0.60182201862335), FRAC_CONST(0.86779648065567) },
      { FRAC_CONST(-0.97418588399887), FRAC_CONST(0.96468526124954) },
      { FRAC_CONST(0.88461571931839), FRAC_CONST(0.57508403062820) },
      { FRAC_CONST(0.05198933184147), FRAC_CONST(0.21269661188126) },
      { FRAC_CONST(-0.53499621152878), FRAC_CONST(0.97241556644440) },
      { FRAC_CONST(-0.49429559707642), FRAC_CONST(0.98183864355087) },
      { FRAC_CONST(-0.98935145139694), FRAC_CONST(-0.40249159932137) },
      { FRAC_CONST(-0.98081380128860), FRAC_CONST(-0.72856897115707) },
      { FRAC_CONST(-0.27338150143623), FRAC_CONST(0.99950921535492) },
      { FRAC_CONST(0.06310802698135), FRAC_CONST(-0.54539585113525) },
      { FRAC_CONST(-0.20461677014828), FRAC_CONST(-0.14209978282452) },
      { FRAC_CONST(0.66223841905594), FRAC_CONST(0.72528582811356) },
      { FRAC_CONST(-0.84764343500137), FRAC_CONST(0.02372316829860) },
      { FRAC_CONST(-0.89039862155914), FRAC_CONST(0.88866579532623) },
      { FRAC_CONST(0.95903307199478), FRAC_CONST(0.76744925975800) },
      { FRAC_CONST(0.73504126071930), FRAC_CONST(-0.03747203201056) },
      { FRAC_CONST(-0.31744435429573), FRAC_CONST(-0.36834111809731) },
      { FRAC_CONST(-0.34110826253891), FRAC_CONST(0.40211221575737) },
      { FRAC_CONST(0.47803884744644), FRAC_CONST(-0.39423218369484) },
      { FRAC_CONST(0.98299193382263), FRAC_CONST(0.01989791356027) },
      { FRAC_CONST(-0.30963072180748), FRAC_CONST(-0.18076720833778) },
      { FRAC_CONST(0.99992591142654), FRAC_CONST(-0.26281872391701) },
      { FRAC_CONST(-0.93149733543396), FRAC_CONST(-0.98313164710999) },
      { FRAC_CONST(0.99923473596573), FRAC_CONST(-0.80142992734909) },
      { FRAC_CONST(-0.26024168729782), FRAC_CONST(-0.75999760627747) },
      { FRAC_CONST(-0.35712513327599), FRAC_CONST(0.19298963248730) },
      { FRAC_CONST(-0.99899083375931), FRAC_CONST(0.74645155668259) },
      { FRAC_CONST(0.86557173728943), FRAC_CONST(0.55593866109848) },
      { FRAC_CONST(0.33408042788506), FRAC_CONST(0.86185956001282) },
      { FRAC_CONST(0.99010735750198), FRAC_CONST(0.04602397605777) },
      { FRAC_CONST(-0.66694271564484), FRAC_CONST(-0.91643613576889) },
      { FRAC_CONST(0.64016789197922), FRAC_CONST(0.15649530291557) },
      { FRAC_CONST(0.99570536613464), FRAC_CONST(0.45844584703445) },
      { FRAC_CONST(-0.63431465625763), FRAC_CONST(0.21079117059708) },
      { FRAC_CONST(-0.07706847041845), FRAC_CONST(-0.89581435918808) },
      { FRAC_CONST(0.98590087890625), FRAC_CONST(0.88241720199585) },
      { FRAC_CONST(0.80099332332611), FRAC_CONST(-0.36851897835732) },
      { FRAC_CONST(0.78368133306503), FRAC_CONST(0.45506998896599) },
      { FRAC_CONST(0.08707806468010), FRAC_CONST(0.80938994884491) },
      { FRAC_CONST(-0.86811882257462), FRAC_CONST(0.39347308874130) },
      { FRAC_CONST(-0.39466530084610), FRAC_CONST(-0.66809433698654) },
      { FRAC_CONST(0.97875326871872), FRAC_CONST(-0.72467839717865) },
      { FRAC_CONST(-0.95038563013077), FRAC_CONST(0.89563220739365) },
      { FRAC_CONST(0.17005239427090), FRAC_CONST(0.54683053493500) },
      { FRAC_CONST(-0.76910793781281), FRAC_CONST(-0.96226614713669) },
      { FRAC_CONST(0.99743282794952), FRAC_CONST(0.42697158455849) },
      { FRAC_CONST(0.95437383651733), FRAC_CONST(0.97002321481705) },
      { FRAC_CONST(0.99578905105591), FRAC_CONST(-0.54106825590134) },
      { FRAC_CONST(0.28058260679245), FRAC_CONST(-0.85361421108246) },
      { FRAC_CONST(0.85256522893906), FRAC_CONST(-0.64567607641220) },
      { FRAC_CONST(-0.50608539581299), FRAC_CONST(-0.65846014022827) },
      { FRAC_CONST(-0.97210735082626), FRAC_CONST(-0.23095212876797) },
      { FRAC_CONST(0.95424050092697), FRAC_CONST(-0.99240148067474) },
      { FRAC_CONST(-0.96926569938660), FRAC_CONST(0.73775655031204) },
      { FRAC_CONST(0.30872163176537), FRAC_CONST(0.41514959931374) },
      { FRAC_CONST(-0.24523839354515), FRAC_CONST(0.63206630945206) },
      { FRAC_CONST(-0.33813264966011), FRAC_CONST(-0.38661777973175) },
      { FRAC_CONST(-0.05826828256249), FRAC_CONST(-0.06940773874521) },
      { FRAC_CONST(-0.22898460924625), FRAC_CONST(0.97054851055145) },
      { FRAC_CONST(-0.18509915471077), FRAC_CONST(0.47565764188766) },
      { FRAC_CONST(-0.10488238185644), FRAC_CONST(-0.87769949436188) },
      { FRAC_CONST(-0.71886587142944), FRAC_CONST(0.78030979633331) },
      { FRAC_CONST(0.99793875217438), FRAC_CONST(0.90041309595108) },
      { FRAC_CONST(0.57563304901123), FRAC_CONST(-0.91034334897995) },
      { FRAC_CONST(0.28909647464752), FRAC_CONST(0.96307784318924) },
      { FRAC_CONST(0.42188999056816), FRAC_CONST(0.48148649930954) },
      { FRAC_CONST(0.93335050344467), FRAC_CONST(-0.43537023663521) },
      { FRAC_CONST(-0.97087377309799), FRAC_CONST(0.86636447906494) },
      { FRAC_CONST(0.36722871661186), FRAC_CONST(0.65291655063629) },
      { FRAC_CONST(-0.81093025207520), FRAC_CONST(0.08778370171785) },
      { FRAC_CONST(-0.26240602135658), FRAC_CONST(-0.92774093151093) },
      { FRAC_CONST(0.83996498584747), FRAC_CONST(0.55839848518372) },
      { FRAC_CONST(-0.99909615516663), FRAC_CONST(-0.96024608612061) },
      { FRAC_CONST(0.74649465084076), FRAC_CONST(0.12144893407822) },
      { FRAC_CONST(-0.74774593114853), FRAC_CONST(-0.26898062229156) },
      { FRAC_CONST(0.95781666040421), FRAC_CONST(-0.79047924280167) },
      { FRAC_CONST(0.95472306013107), FRAC_CONST(-0.08588775992393) },
      { FRAC_CONST(0.48708331584930), FRAC_CONST(0.99999040365219) },
      { FRAC_CONST(0.46332037448883), FRAC_CONST(0.10964126139879) },
      { FRAC_CONST(-0.76497006416321), FRAC_CONST(0.89210927486420) },
      { FRAC_CONST(0.57397389411926), FRAC_CONST(0.35289704799652) },
      { FRAC_CONST(0.75374317169189), FRAC_CONST(0.96705216169357) },
      { FRAC_CONST(-0.59174400568008), FRAC_CONST(-0.89405369758606) },
      { FRAC_CONST(0.75087904930115), FRAC_CONST(-0.29612672328949) },
      { FRAC_CONST(-0.98607856035233), FRAC_CONST(0.25034910440445) },
      { FRAC_CONST(-0.40761056542397), FRAC_CONST(-0.90045571327209) },
      { FRAC_CONST(0.66929268836975), FRAC_CONST(0.98629492521286) },
      { FRAC_CONST(-0.97463697195053), FRAC_CONST(-0.00190223299433) },
      { FRAC_CONST(0.90145510435104), FRAC_CONST(0.99781388044357) },
      { FRAC_CONST(-0.87259286642075), FRAC_CONST(0.99233585596085) },
      { FRAC_CONST(-0.91529458761215), FRAC_CONST(-0.15698707103729) },
      { FRAC_CONST(-0.03305738791823), FRAC_CONST(-0.37205263972282) },
      { FRAC_CONST(0.07223051041365), FRAC_CONST(-0.88805001974106) },
      { FRAC_CONST(0.99498009681702), FRAC_CONST(0.97094357013702) },
      { FRAC_CONST(-0.74904936552048), FRAC_CONST(0.99985486268997) },
      { FRAC_CONST(0.04585228487849), FRAC_CONST(0.99812334775925) },
      { FRAC_CONST(-0.89054954051971), FRAC_CONST(-0.31791913509369) },
      { FRAC_CONST(-0.83782142400742), FRAC_CONST(0.97637635469437) },
      { FRAC_CONST(0.33454805612564), FRAC_CONST(-0.86231517791748) },
      { FRAC_CONST(-0.99707579612732), FRAC_CONST(0.93237990140915) },
      { FRAC_CONST(-0.22827528417110), FRAC_CONST(0.18874759972095) },
      { FRAC_CONST(0.67248046398163), FRAC_CONST(-0.03646211326122) },
      { FRAC_CONST(-0.05146538093686), FRAC_CONST(-0.92599701881409) },
      { FRAC_CONST(0.99947297573090), FRAC_CONST(0.93625229597092) },
      { FRAC_CONST(0.66951125860214), FRAC_CONST(0.98905825614929) },
      { FRAC_CONST(-0.99602955579758), FRAC_CONST(-0.44654715061188) },
      { FRAC_CONST(0.82104903459549), FRAC_CONST(0.99540740251541) },
      { FRAC_CONST(0.99186509847641), FRAC_CONST(0.72022998332977) },
      { FRAC_CONST(-0.65284591913223), FRAC_CONST(0.52186721563339) },
      { FRAC_CONST(0.93885445594788), FRAC_CONST(-0.74895310401917) },
      { FRAC_CONST(0.96735250949860), FRAC_CONST(0.90891814231873) },
      { FRAC_CONST(-0.22225968539715), FRAC_CONST(0.57124030590057) },
      { FRAC_CONST(-0.44132784008980), FRAC_CONST(-0.92688840627670) },
      { FRAC_CONST(-0.85694974660873), FRAC_CONST(0.88844531774521) },
      { FRAC_CONST(0.91783040761948), FRAC_CONST(-0.46356892585754) },
      { FRAC_CONST(0.72556972503662), FRAC_CONST(-0.99899554252625) },
      { FRAC_CONST(-0.99711579084396), FRAC_CONST(0.58211559057236) },
      { FRAC_CONST(0.77638977766037), FRAC_CONST(0.94321835041046) },
      { FRAC_CONST(0.07717324048281), FRAC_CONST(0.58638399839401) },
      { FRAC_CONST(-0.56049829721451), FRAC_CONST(0.82522302865982) },
      { FRAC_CONST(0.98398894071579), FRAC_CONST(0.39467439055443) },
      { FRAC_CONST(0.47546947002411), FRAC_CONST(0.68613046407700) },
      { FRAC_CONST(0.65675091743469), FRAC_CONST(0.18331636488438) },
      { FRAC_CONST(0.03273375332355), FRAC_CONST(-0.74933111667633) },
      { FRAC_CONST(-0.38684144616127), FRAC_CONST(0.51337349414825) },
      { FRAC_CONST(-0.97346270084381), FRAC_CONST(-0.96549361944199) },
      { FRAC_CONST(-0.53282153606415), FRAC_CONST(-0.91423267126083) },
      { FRAC_CONST(0.99817311763763), FRAC_CONST(0.61133575439453) },
      { FRAC_CONST(-0.50254499912262), FRAC_CONST(-0.88829338550568) },
      { FRAC_CONST(0.01995873264968), FRAC_CONST(0.85223513841629) },
      { FRAC_CONST(0.99930381774902), FRAC_CONST(0.94578897953033) },
      { FRAC_CONST(0.82907766103745), FRAC_CONST(-0.06323442608118) },
      { FRAC_CONST(-0.58660709857941), FRAC_CONST(0.96840775012970) },
      { FRAC_CONST(-0.17573736608028), FRAC_CONST(-0.48166921734810) },
      { FRAC_CONST(0.83434289693832), FRAC_CONST(-0.13023450970650) },
      { FRAC_CONST(0.05946491286159), FRAC_CONST(0.20511047542095) },
      { FRAC_CONST(0.81505483388901), FRAC_CONST(-0.94685947895050) },
      { FRAC_CONST(-0.44976380467415), FRAC_CONST(0.40894573926926) },
      { FRAC_CONST(-0.89746475219727), FRAC_CONST(0.99846577644348) },
      { FRAC_CONST(0.39677256345749), FRAC_CONST(-0.74854665994644) },
      { FRAC_CONST(-0.07588948309422), FRAC_CONST(0.74096214771271) },
      { FRAC_CONST(0.76343196630478), FRAC_CONST(0.41746628284454) },
      { FRAC_CONST(-0.74490106105804), FRAC_CONST(0.94725912809372) },
      { FRAC_CONST(0.64880120754242), FRAC_CONST(0.41336661577225) },
      { FRAC_CONST(0.62319535017014), FRAC_CONST(-0.93098312616348) },
      { FRAC_CONST(0.42215818166733), FRAC_CONST(-0.07712787389755) },
      { FRAC_CONST(0.02704554051161), FRAC_CONST(-0.05417517945170) },
      { FRAC_CONST(0.80001771450043), FRAC_CONST(0.91542196273804) },
      { FRAC_CONST(-0.79351830482483), FRAC_CONST(-0.36208897829056) },
      { FRAC_CONST(0.63872361183167), FRAC_CONST(0.08128252625465) },
      { FRAC_CONST(0.52890521287918), FRAC_CONST(0.60048872232437) },
      { FRAC_CONST(0.74238550662994), FRAC_CONST(0.04491915181279) },
      { FRAC_CONST(0.99096131324768), FRAC_CONST(-0.19451183080673) },
      { FRAC_CONST(-0.80412328243256), FRAC_CONST(-0.88513815402985) },
      { FRAC_CONST(-0.64612615108490), FRAC_CONST(0.72198677062988) },
      { FRAC_CONST(0.11657770723104), FRAC_CONST(-0.83662831783295) },
      { FRAC_CONST(-0.95053184032440), FRAC_CONST(-0.96939903497696) },
      { FRAC_CONST(-0.62228870391846), FRAC_CONST(0.82767260074615) },
      { FRAC_CONST(0.03004475869238), FRAC_CONST(-0.99738895893097) },
      { FRAC_CONST(-0.97987216711044), FRAC_CONST(0.36526128649712) },
      { FRAC_CONST(-0.99986982345581), FRAC_CONST(-0.36021611094475) },
      { FRAC_CONST(0.89110648632050), FRAC_CONST(-0.97894251346588) },
      { FRAC_CONST(0.10407960414886), FRAC_CONST(0.77357792854309) },
      { FRAC_CONST(0.95964735746384), FRAC_CONST(-0.35435819625854) },
      { FRAC_CONST(0.50843232870102), FRAC_CONST(0.96107691526413) },
      { FRAC_CONST(0.17006334662437), FRAC_CONST(-0.76854026317596) },
      { FRAC_CONST(0.25872674584389), FRAC_CONST(0.99893301725388) },
      { FRAC_CONST(-0.01115998718888), FRAC_CONST(0.98496019840240) },
      { FRAC_CONST(-0.79598701000214), FRAC_CONST(0.97138410806656) },
      { FRAC_CONST(-0.99264711141586), FRAC_CONST(-0.99542820453644) },
      { FRAC_CONST(-0.99829661846161), FRAC_CONST(0.01877138763666) },
      { FRAC_CONST(-0.70801013708115), FRAC_CONST(0.33680686354637) },
      { FRAC_CONST(-0.70467054843903), FRAC_CONST(0.93272775411606) },
      { FRAC_CONST(0.99846023321152), FRAC_CONST(-0.98725748062134) },
      { FRAC_CONST(-0.63364970684052), FRAC_CONST(-0.16473594307899) },
      { FRAC_CONST(-0.16258217394352), FRAC_CONST(-0.95939123630524) },
      { FRAC_CONST(-0.43645593523979), FRAC_CONST(-0.94805032014847) },
      { FRAC_CONST(-0.99848473072052), FRAC_CONST(0.96245169639587) },
      { FRAC_CONST(-0.16796459257603), FRAC_CONST(-0.98987513780594) },
      { FRAC_CONST(-0.87979227304459), FRAC_CONST(-0.71725726127625) },
      { FRAC_CONST(0.44183099269867), FRAC_CONST(-0.93568974733353) },
      { FRAC_CONST(0.93310177326202), FRAC_CONST(-0.99913311004639) },
      { FRAC_CONST(-0.93941932916641), FRAC_CONST(-0.56409376859665) },
      { FRAC_CONST(-0.88590002059937), FRAC_CONST(0.47624599933624) },
      { FRAC_CONST(0.99971461296082), FRAC_CONST(-0.83889955282211) },
      { FRAC_CONST(-0.75376385450363), FRAC_CONST(0.00814643409103) },
      { FRAC_CONST(0.93887686729431), FRAC_CONST(-0.11284527927637) },
      { FRAC_CONST(0.85126435756683), FRAC_CONST(0.52349251508713) },
      { FRAC_CONST(0.39701420068741), FRAC_CONST(0.81779634952545) },
      { FRAC_CONST(-0.37024465203285), FRAC_CONST(-0.87071657180786) },
      { FRAC_CONST(-0.36024826765060), FRAC_CONST(0.34655734896660) },
      { FRAC_CONST(-0.93388813734055), FRAC_CONST(-0.84476542472839) },
      { FRAC_CONST(-0.65298801660538), FRAC_CONST(-0.18439576029778) },
      { FRAC_CONST(0.11960318684578), FRAC_CONST(0.99899345636368) },
      { FRAC_CONST(0.94292563199997), FRAC_CONST(0.83163905143738) },
      { FRAC_CONST(0.75081145763397), FRAC_CONST(-0.35533222556114) },
      { FRAC_CONST(0.56721979379654), FRAC_CONST(-0.24076835811138) },
      { FRAC_CONST(0.46857765316963), FRAC_CONST(-0.30140233039856) },
      { FRAC_CONST(0.97312313318253), FRAC_CONST(-0.99548190832138) },
      { FRAC_CONST(-0.38299977779388), FRAC_CONST(0.98516911268234) },
      { FRAC_CONST(0.41025799512863), FRAC_CONST(0.02116736955941) },
      { FRAC_CONST(0.09638062119484), FRAC_CONST(0.04411984235048) },
      { FRAC_CONST(-0.85283249616623), FRAC_CONST(0.91475564241409) },
      { FRAC_CONST(0.88866806030273), FRAC_CONST(-0.99735265970230) },
      { FRAC_CONST(-0.48202428221703), FRAC_CONST(-0.96805608272552) },
      { FRAC_CONST(0.27572581171989), FRAC_CONST(0.58634752035141) },
      { FRAC_CONST(-0.65889132022858), FRAC_CONST(0.58835631608963) },
      { FRAC_CONST(0.98838084936142), FRAC_CONST(0.99994349479675) },
      { FRAC_CONST(-0.20651349425316), FRAC_CONST(0.54593044519424) },
      { FRAC_CONST(-0.62126415967941), FRAC_CONST(-0.59893679618835) },
      { FRAC_CONST(0.20320105552673), FRAC_CONST(-0.86879181861877) },
      { FRAC_CONST(-0.97790551185608), FRAC_CONST(0.96290808916092) },
      { FRAC_CONST(0.11112534999847), FRAC_CONST(0.21484763920307) },
      { FRAC_CONST(-0.41368338465691), FRAC_CONST(0.28216838836670) },
      { FRAC_CONST(0.24133038520813), FRAC_CONST(0.51294362545013) },
      { FRAC_CONST(-0.66393411159515), FRAC_CONST(-0.08249679952860) },
      { FRAC_CONST(-0.53697830438614), FRAC_CONST(-0.97649902105331) },
      { FRAC_CONST(-0.97224736213684), FRAC_CONST(0.22081333398819) },
      { FRAC_CONST(0.87392479181290), FRAC_CONST(-0.12796173989773) },
      { FRAC_CONST(0.19050361216068), FRAC_CONST(0.01602615416050) },
      { FRAC_CONST(-0.46353441476822), FRAC_CONST(-0.95249038934708) },
      { FRAC_CONST(-0.07064096629620), FRAC_CONST(-0.94479805231094) },
      { FRAC_CONST(-0.92444086074829), FRAC_CONST(-0.10457590222359) },
      { FRAC_CONST(-0.83822596073151), FRAC_CONST(-0.01695043221116) },
      { FRAC_CONST(0.75214684009552), FRAC_CONST(-0.99955683946609) },
      { FRAC_CONST(-0.42102998495102), FRAC_CONST(0.99720942974091) },
      { FRAC_CONST(-0.72094786167145), FRAC_CONST(-0.35008960962296) },
      { FRAC_CONST(0.78843313455582), FRAC_CONST(0.52851396799088) },
      { FRAC_CONST(0.97394025325775), FRAC_CONST(-0.26695942878723) },
      { FRAC_CONST(0.99206465482712), FRAC_CONST(-0.57010120153427) },
      { FRAC_CONST(0.76789611577988), FRAC_CONST(-0.76519358158112) },
      { FRAC_CONST(-0.82002419233322), FRAC_CONST(-0.73530179262161) },
      { FRAC_CONST(0.81924992799759), FRAC_CONST(0.99698424339294) },
      { FRAC_CONST(-0.26719850301743), FRAC_CONST(0.68903368711472) },
      { FRAC_CONST(-0.43311259150505), FRAC_CONST(0.85321813821793) },
      { FRAC_CONST(0.99194979667664), FRAC_CONST(0.91876250505447) },
      { FRAC_CONST(-0.80691999197006), FRAC_CONST(-0.32627540826797) },
      { FRAC_CONST(0.43080005049706), FRAC_CONST(-0.21919095516205) },
      { FRAC_CONST(0.67709493637085), FRAC_CONST(-0.95478075742722) },
      { FRAC_CONST(0.56151771545410), FRAC_CONST(-0.70693808794022) },
      { FRAC_CONST(0.10831862688065), FRAC_CONST(-0.08628837019205) },
      { FRAC_CONST(0.91229414939880), FRAC_CONST(-0.65987348556519) },
      { FRAC_CONST(-0.48972892761230), FRAC_CONST(0.56289243698120) },
      { FRAC_CONST(-0.89033657312393), FRAC_CONST(-0.71656566858292) },
      { FRAC_CONST(0.65269446372986), FRAC_CONST(0.65916007757187) },
      { FRAC_CONST(0.67439478635788), FRAC_CONST(-0.81684380769730) },
      { FRAC_CONST(-0.47770830988884), FRAC_CONST(-0.16789555549622) },
      { FRAC_CONST(-0.99715977907181), FRAC_CONST(-0.93565785884857) },
      { FRAC_CONST(-0.90889590978622), FRAC_CONST(0.62034398317337) },
      { FRAC_CONST(-0.06618622690439), FRAC_CONST(-0.23812216520309) },
      { FRAC_CONST(0.99430269002914), FRAC_CONST(0.18812555074692) },
      { FRAC_CONST(0.97686403989792), FRAC_CONST(-0.28664535284042) },
      { FRAC_CONST(0.94813650846481), FRAC_CONST(-0.97506642341614) },
      { FRAC_CONST(-0.95434498786926), FRAC_CONST(-0.79607981443405) },
      { FRAC_CONST(-0.49104782938957), FRAC_CONST(0.32895213365555) },
      { FRAC_CONST(0.99881172180176), FRAC_CONST(0.88993984460831) },
      { FRAC_CONST(0.50449168682098), FRAC_CONST(-0.85995072126389) },
      { FRAC_CONST(0.47162890434265), FRAC_CONST(-0.18680204451084) },
      { FRAC_CONST(-0.62081581354141), FRAC_CONST(0.75000673532486) },
      { FRAC_CONST(-0.43867015838623), FRAC_CONST(0.99998068809509) },
      { FRAC_CONST(0.98630565404892), FRAC_CONST(-0.53578901290894) },
      { FRAC_CONST(-0.61510360240936), FRAC_CONST(-0.89515018463135) },
      { FRAC_CONST(-0.03841517493129), FRAC_CONST(-0.69888818264008) },
      { FRAC_CONST(-0.30102157592773), FRAC_CONST(-0.07667808979750) },
      { FRAC_CONST(0.41881284117699), FRAC_CONST(0.02188098989427) },
      { FRAC_CONST(-0.86135452985764), FRAC_CONST(0.98947483301163) },
      { FRAC_CONST(0.67226862907410), FRAC_CONST(-0.13494388759136) },
      { FRAC_CONST(-0.70737397670746), FRAC_CONST(-0.76547348499298) },
      { FRAC_CONST(0.94044947624207), FRAC_CONST(0.09026201069355) },
      { FRAC_CONST(-0.82386350631714), FRAC_CONST(0.08924768865108) },
      { FRAC_CONST(-0.32070666551590), FRAC_CONST(0.50143420696259) },
      { FRAC_CONST(0.57593160867691), FRAC_CONST(-0.98966425657272) },
      { FRAC_CONST(-0.36326017975807), FRAC_CONST(0.07440242916346) },
      { FRAC_CONST(0.99979043006897), FRAC_CONST(-0.14130286872387) },
      { FRAC_CONST(-0.92366021871567), FRAC_CONST(-0.97979295253754) },
      { FRAC_CONST(-0.44607177376747), FRAC_CONST(-0.54233253002167) },
      { FRAC_CONST(0.44226801395416), FRAC_CONST(0.71326756477356) },
      { FRAC_CONST(0.03671907261014), FRAC_CONST(0.63606387376785) },
      { FRAC_CONST(0.52175426483154), FRAC_CONST(-0.85396826267242) },
      { FRAC_CONST(-0.94701141119003), FRAC_CONST(-0.01826348155737) },
      { FRAC_CONST(-0.98759609460831), FRAC_CONST(0.82288712263107) },
      { FRAC_CONST(0.87434792518616), FRAC_CONST(0.89399492740631) },
      { FRAC_CONST(-0.93412041664124), FRAC_CONST(0.41374051570892) },
      { FRAC_CONST(0.96063941717148), FRAC_CONST(0.93116706609726) },
      { FRAC_CONST(0.97534251213074), FRAC_CONST(0.86150932312012) },
      { FRAC_CONST(0.99642467498779), FRAC_CONST(0.70190042257309) },
      { FRAC_CONST(-0.94705086946487), FRAC_CONST(-0.29580041766167) },
      { FRAC_CONST(0.91599804162979), FRAC_CONST(-0.98147833347321) }
  };
  /*}}}*/

  /*{{{*/
  static uint8_t estimate_current_envelope (sbr_info *sbr, sbr_hfadj_info *adj,
                                           qmf_t Xsbr[MAX_NTSRHFG][64], uint8_t ch)
  {
      uint8_t m, l, j, k, k_l, k_h, p;
      real_t nrg, div;

      if (sbr->bs_interpol_freq == 1)
      {
          for (l = 0; l < sbr->L_E[ch]; l++)
          {
              uint8_t i, l_i, u_i;

              l_i = sbr->t_E[ch][l];
              u_i = sbr->t_E[ch][l+1];

              div = (real_t)(u_i - l_i);

              if (div == 0)
                  div = 1;

              for (m = 0; m < sbr->M; m++)
              {
                  nrg = 0;

                  for (i = l_i + sbr->tHFAdj; i < u_i + sbr->tHFAdj; i++)
                  {
                      nrg += MUL_R(QMF_RE(Xsbr[i][m + sbr->kx]), QMF_RE(Xsbr[i][m + sbr->kx]))
  #ifndef SBR_LOW_POWER
                          + MUL_R(QMF_IM(Xsbr[i][m + sbr->kx]), QMF_IM(Xsbr[i][m + sbr->kx]))
  #endif
                          ;
                  }

                  sbr->E_curr[ch][m][l] = nrg / div;
  #ifdef SBR_LOW_POWER
                  sbr->E_curr[ch][m][l] *= 2;
  #endif
              }
          }
      } else {
          for (l = 0; l < sbr->L_E[ch]; l++)
          {
              for (p = 0; p < sbr->n[sbr->f[ch][l]]; p++)
              {
                  k_l = sbr->f_table_res[sbr->f[ch][l]][p];
                  k_h = sbr->f_table_res[sbr->f[ch][l]][p+1];

                  for (k = k_l; k < k_h; k++)
                  {
                      uint8_t i, l_i, u_i;
                      nrg = 0;

                      l_i = sbr->t_E[ch][l];
                      u_i = sbr->t_E[ch][l+1];

                      div = (real_t)((u_i - l_i)*(k_h - k_l));

                      if (div == 0)
                          div = 1;

                      for (i = l_i + sbr->tHFAdj; i < u_i + sbr->tHFAdj; i++)
                      {
                          for (j = k_l; j < k_h; j++)
                          {
                              nrg += MUL_R(QMF_RE(Xsbr[i][j]), QMF_RE(Xsbr[i][j]))
  #ifndef SBR_LOW_POWER
                                  + MUL_R(QMF_IM(Xsbr[i][j]), QMF_IM(Xsbr[i][j]))
  #endif
                                  ;
                          }
                      }

                      sbr->E_curr[ch][k - sbr->kx][l] = nrg / div;
  #ifdef SBR_LOW_POWER
                      sbr->E_curr[ch][k - sbr->kx][l] *= 2;
  #endif
                  }
              }
          }
      }

      return 0;
  }
  /*}}}*/
  /*{{{*/
  static uint8_t get_S_mapped (sbr_info *sbr, uint8_t ch, uint8_t l, uint8_t current_band)
  {
      if (sbr->f[ch][l] == HI_RES)
      {
          /* in case of using f_table_high we just have 1 to 1 mapping
           * from bs_add_harmonic[l][k]
           */
          if ((l >= sbr->l_A[ch]) ||
              (sbr->bs_add_harmonic_prev[ch][current_band] && sbr->bs_add_harmonic_flag_prev[ch]))
          {
              return sbr->bs_add_harmonic[ch][current_band];
          }
      } else {
          uint8_t b, lb, ub;

          /* in case of f_table_low we check if any of the HI_RES bands
           * within this LO_RES band has bs_add_harmonic[l][k] turned on
           * (note that borders in the LO_RES table are also present in
           * the HI_RES table)
           */

          /* find first HI_RES band in current LO_RES band */
          lb = 2*current_band - ((sbr->N_high & 1) ? 1 : 0);
          /* find first HI_RES band in next LO_RES band */
          ub = 2*(current_band+1) - ((sbr->N_high & 1) ? 1 : 0);

          /* check all HI_RES bands in current LO_RES band for sinusoid */
          for (b = lb; b < ub; b++)
          {
              if ((l >= sbr->l_A[ch]) ||
                  (sbr->bs_add_harmonic_prev[ch][b] && sbr->bs_add_harmonic_flag_prev[ch]))
              {
                  if (sbr->bs_add_harmonic[ch][b] == 1)
                      return 1;
              }
          }
      }

      return 0;
  }
  /*}}}*/
  /*{{{*/
  static void calculate_gain (sbr_info *sbr, sbr_hfadj_info *adj, uint8_t ch)
  {
      static real_t limGain[] = { 0.5, 1.0, 2.0, 1e10 };
      uint8_t m, l, k;

      uint8_t current_t_noise_band = 0;
      uint8_t S_mapped;

      ALIGN real_t Q_M_lim[MAX_M];
      ALIGN real_t G_lim[MAX_M];
      ALIGN real_t G_boost;
      ALIGN real_t S_M[MAX_M];

      for (l = 0; l < sbr->L_E[ch]; l++)
      {
          uint8_t current_f_noise_band = 0;
          uint8_t current_res_band = 0;
          uint8_t current_res_band2 = 0;
          uint8_t current_hi_res_band = 0;

          real_t delta = (l == sbr->l_A[ch] || l == sbr->prevEnvIsShort[ch]) ? 0 : 1;

          S_mapped = get_S_mapped(sbr, ch, l, current_res_band2);

          if (sbr->t_E[ch][l+1] > sbr->t_Q[ch][current_t_noise_band+1])
          {
              current_t_noise_band++;
          }

          for (k = 0; k < sbr->N_L[sbr->bs_limiter_bands]; k++)
          {
              real_t G_max;
              real_t den = 0;
              real_t acc1 = 0;
              real_t acc2 = 0;
              uint8_t current_res_band_size = 0;

              uint8_t ml1, ml2;

              ml1 = sbr->f_table_lim[sbr->bs_limiter_bands][k];
              ml2 = sbr->f_table_lim[sbr->bs_limiter_bands][k+1];


              /* calculate the accumulated E_orig and E_curr over the limiter band */
              for (m = ml1; m < ml2; m++)
              {
                  if ((m + sbr->kx) == sbr->f_table_res[sbr->f[ch][l]][current_res_band+1])
                  {
                      current_res_band++;
                  }
                  acc1 += sbr->E_orig[ch][current_res_band][l];
                  acc2 += sbr->E_curr[ch][m][l];
              }


              /* calculate the maximum gain */
              /* ratio of the energy of the original signal and the energy
               * of the HF generated signal
               */
              G_max = ((EPS + acc1) / (EPS + acc2)) * limGain[sbr->bs_limiter_gains];
              G_max = min(G_max, 1e10);


              for (m = ml1; m < ml2; m++)
              {
                  real_t Q_M, G;
                  real_t Q_div, Q_div2;
                  uint8_t S_index_mapped;


                  /* check if m is on a noise band border */
                  if ((m + sbr->kx) == sbr->f_table_noise[current_f_noise_band+1])
                  {
                      /* step to next noise band */
                      current_f_noise_band++;
                  }


                  /* check if m is on a resolution band border */
                  if ((m + sbr->kx) == sbr->f_table_res[sbr->f[ch][l]][current_res_band2+1])
                  {
                      /* step to next resolution band */
                      current_res_band2++;

                      /* if we move to a new resolution band, we should check if we are
                       * going to add a sinusoid in this band
                       */
                      S_mapped = get_S_mapped(sbr, ch, l, current_res_band2);
                  }


                  /* check if m is on a HI_RES band border */
                  if ((m + sbr->kx) == sbr->f_table_res[HI_RES][current_hi_res_band+1])
                  {
                      /* step to next HI_RES band */
                      current_hi_res_band++;
                  }


                  /* find S_index_mapped
                   * S_index_mapped can only be 1 for the m in the middle of the
                   * current HI_RES band
                   */
                  S_index_mapped = 0;
                  if ((l >= sbr->l_A[ch]) ||
                      (sbr->bs_add_harmonic_prev[ch][current_hi_res_band] && sbr->bs_add_harmonic_flag_prev[ch]))
                  {
                      /* find the middle subband of the HI_RES frequency band */
                      if ((m + sbr->kx) == (sbr->f_table_res[HI_RES][current_hi_res_band+1] + sbr->f_table_res[HI_RES][current_hi_res_band]) >> 1)
                          S_index_mapped = sbr->bs_add_harmonic[ch][current_hi_res_band];
                  }


                  /* Q_div: [0..1] (1/(1+Q_mapped)) */
                  Q_div = sbr->Q_div[ch][current_f_noise_band][current_t_noise_band];


                  /* Q_div2: [0..1] (Q_mapped/(1+Q_mapped)) */
                  Q_div2 = sbr->Q_div2[ch][current_f_noise_band][current_t_noise_band];


                  /* Q_M only depends on E_orig and Q_div2:
                   * since N_Q <= N_Low <= N_High we only need to recalculate Q_M on
                   * a change of current noise band
                   */
                  Q_M = sbr->E_orig[ch][current_res_band2][l] * Q_div2;


                  /* S_M only depends on E_orig, Q_div and S_index_mapped:
                   * S_index_mapped can only be non-zero once per HI_RES band
                   */
                  if (S_index_mapped == 0)
                  {
                      S_M[m] = 0;
                  } else {
                      S_M[m] = sbr->E_orig[ch][current_res_band2][l] * Q_div;

                      /* accumulate sinusoid part of the total energy */
                      den += S_M[m];
                  }


                  /* calculate gain */
                  /* ratio of the energy of the original signal and the energy
                   * of the HF generated signal
                   */
                  G = sbr->E_orig[ch][current_res_band2][l] / (1.0 + sbr->E_curr[ch][m][l]);
                  if ((S_mapped == 0) && (delta == 1))
                      G *= Q_div;
                  else if (S_mapped == 1)
                      G *= Q_div2;


                  /* limit the additional noise energy level */
                  /* and apply the limiter */
                  if (G_max > G)
                  {
                      Q_M_lim[m] = Q_M;
                      G_lim[m] = G;
                  } else {
                      Q_M_lim[m] = Q_M * G_max / G;
                      G_lim[m] = G_max;
                  }


                  /* accumulate the total energy */
                  den += sbr->E_curr[ch][m][l] * G_lim[m];
                  if ((S_index_mapped == 0) && (l != sbr->l_A[ch]))
                      den += Q_M_lim[m];
              }

              /* G_boost: [0..2.51188643] */
              G_boost = (acc1 + EPS) / (den + EPS);
              G_boost = min(G_boost, 2.51188643 /* 1.584893192 ^ 2 */);

              for (m = ml1; m < ml2; m++)
              {
                  /* apply compensation to gain, noise floor sf's and sinusoid levels */
  #ifndef SBR_LOW_POWER
                  adj->G_lim_boost[l][m] = sqrt(G_lim[m] * G_boost);
  #else
                  /* sqrt() will be done after the aliasing reduction to save a
                   * few multiplies
                   */
                  adj->G_lim_boost[l][m] = G_lim[m] * G_boost;
  #endif
                  adj->Q_M_lim_boost[l][m] = sqrt(Q_M_lim[m] * G_boost);

                  if (S_M[m] != 0)
                  {
                      adj->S_M_boost[l][m] = sqrt(S_M[m] * G_boost);
                  } else {
                      adj->S_M_boost[l][m] = 0;
                  }
              }
          }
      }
  }
  /*}}}*/
  /*{{{*/
  static void hf_assembly (sbr_info *sbr, sbr_hfadj_info *adj,
                          qmf_t Xsbr[MAX_NTSRHFG][64], uint8_t ch)
  {
      static real_t h_smooth[] = {
          FRAC_CONST(0.03183050093751), FRAC_CONST(0.11516383427084),
          FRAC_CONST(0.21816949906249), FRAC_CONST(0.30150283239582),
          FRAC_CONST(0.33333333333333)
      };
      static int8_t phi_re[] = { 1, 0, -1, 0 };
      static int8_t phi_im[] = { 0, 1, 0, -1 };

      uint8_t m, l, i, n;
      uint16_t fIndexNoise = 0;
      uint8_t fIndexSine = 0;
      uint8_t assembly_reset = 0;

      real_t G_filt, Q_filt;

      uint8_t h_SL;


      if (sbr->Reset == 1)
      {
          assembly_reset = 1;
          fIndexNoise = 0;
      } else {
          fIndexNoise = sbr->index_noise_prev[ch];
      }
      fIndexSine = sbr->psi_is_prev[ch];


      for (l = 0; l < sbr->L_E[ch]; l++)
      {
          uint8_t no_noise = (l == sbr->l_A[ch] || l == sbr->prevEnvIsShort[ch]) ? 1 : 0;

  #ifdef SBR_LOW_POWER
          h_SL = 0;
  #else
          h_SL = (sbr->bs_smoothing_mode == 1) ? 0 : 4;
          h_SL = (no_noise ? 0 : h_SL);
  #endif

          if (assembly_reset)
          {
              for (n = 0; n < 4; n++)
              {
                  memcpy(sbr->G_temp_prev[ch][n], adj->G_lim_boost[l], sbr->M*sizeof(real_t));
                  memcpy(sbr->Q_temp_prev[ch][n], adj->Q_M_lim_boost[l], sbr->M*sizeof(real_t));
              }
              /* reset ringbuffer index */
              sbr->GQ_ringbuf_index[ch] = 4;
              assembly_reset = 0;
          }

          for (i = sbr->t_E[ch][l]; i < sbr->t_E[ch][l+1]; i++)
          {
  #ifdef SBR_LOW_POWER
              uint8_t i_min1, i_plus1;
              uint8_t sinusoids = 0;
  #endif

              /* load new values into ringbuffer */
              memcpy(sbr->G_temp_prev[ch][sbr->GQ_ringbuf_index[ch]], adj->G_lim_boost[l], sbr->M*sizeof(real_t));
              memcpy(sbr->Q_temp_prev[ch][sbr->GQ_ringbuf_index[ch]], adj->Q_M_lim_boost[l], sbr->M*sizeof(real_t));

              for (m = 0; m < sbr->M; m++)
              {
                  qmf_t psi;

                  G_filt = 0;
                  Q_filt = 0;

  #ifndef SBR_LOW_POWER
                  if (h_SL != 0)
                  {
                    uint8_t ri = sbr->GQ_ringbuf_index[ch];
                      for (n = 0; n <= 4; n++)
                      {
                          real_t curr_h_smooth = h_smooth[n];
                          ri++;
                          if (ri >= 5)
                              ri -= 5;
                          G_filt += MUL_F(sbr->G_temp_prev[ch][ri][m], curr_h_smooth);
                          Q_filt += MUL_F(sbr->Q_temp_prev[ch][ri][m], curr_h_smooth);
                      }
                 } else {
  #endif
                      G_filt = sbr->G_temp_prev[ch][sbr->GQ_ringbuf_index[ch]][m];
                      Q_filt = sbr->Q_temp_prev[ch][sbr->GQ_ringbuf_index[ch]][m];
  #ifndef SBR_LOW_POWER
                  }
  #endif

                  Q_filt = (adj->S_M_boost[l][m] != 0 || no_noise) ? 0 : Q_filt;

                  /* add noise to the output */
                  fIndexNoise = (fIndexNoise + 1) & 511;

                  /* the smoothed gain values are applied to Xsbr */
                  /* V is defined, not calculated */
                  QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) = G_filt * QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx])
                      + MUL_F(Q_filt, RE(V[fIndexNoise]));
                  if (sbr->bs_extension_id == 3 && sbr->bs_extension_data == 42)
                      QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) = 16428320;
  #ifndef SBR_LOW_POWER
                  QMF_IM(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) = G_filt * QMF_IM(Xsbr[i + sbr->tHFAdj][m+sbr->kx])
                      + MUL_F(Q_filt, IM(V[fIndexNoise]));
  #endif

                  {
                      int8_t rev = (((m + sbr->kx) & 1) ? -1 : 1);
                      QMF_RE(psi) = adj->S_M_boost[l][m] * phi_re[fIndexSine];
                      QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) += QMF_RE(psi);

  #ifndef SBR_LOW_POWER
                      QMF_IM(psi) = rev * adj->S_M_boost[l][m] * phi_im[fIndexSine];
                      QMF_IM(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) += QMF_IM(psi);
  #else

                      i_min1 = (fIndexSine - 1) & 3;
                      i_plus1 = (fIndexSine + 1) & 3;

                      if ((m == 0) && (phi_re[i_plus1] != 0))
                      {
                          QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx - 1]) +=
                              (rev*phi_re[i_plus1] * MUL_F(adj->S_M_boost[l][0], FRAC_CONST(0.00815)));
                          if (sbr->M != 0)
                          {
                              QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) -=
                                  (rev*phi_re[i_plus1] * MUL_F(adj->S_M_boost[l][1], FRAC_CONST(0.00815)));
                          }
                      }
                      if ((m > 0) && (m < sbr->M - 1) && (sinusoids < 16) && (phi_re[i_min1] != 0))
                      {
                          QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) -=
                              (rev*phi_re[i_min1] * MUL_F(adj->S_M_boost[l][m - 1], FRAC_CONST(0.00815)));
                      }
                      if ((m > 0) && (m < sbr->M - 1) && (sinusoids < 16) && (phi_re[i_plus1] != 0))
                      {
                          QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) -=
                              (rev*phi_re[i_plus1] * MUL_F(adj->S_M_boost[l][m + 1], FRAC_CONST(0.00815)));
                      }
                      if ((m == sbr->M - 1) && (sinusoids < 16) && (phi_re[i_min1] != 0))
                      {
                          if (m > 0)
                          {
                              QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx]) -=
                                  (rev*phi_re[i_min1] * MUL_F(adj->S_M_boost[l][m - 1], FRAC_CONST(0.00815)));
                          }
                          if (m + sbr->kx < 64)
                          {
                              QMF_RE(Xsbr[i + sbr->tHFAdj][m+sbr->kx + 1]) +=
                                  (rev*phi_re[i_min1] * MUL_F(adj->S_M_boost[l][m], FRAC_CONST(0.00815)));
                          }
                      }

                      if (adj->S_M_boost[l][m] != 0)
                          sinusoids++;
  #endif
                  }
              }

              fIndexSine = (fIndexSine + 1) & 3;

              /* update the ringbuffer index used for filtering G and Q with h_smooth */
              sbr->GQ_ringbuf_index[ch]++;
              if (sbr->GQ_ringbuf_index[ch] >= 5)
                  sbr->GQ_ringbuf_index[ch] = 0;
          }
      }

      sbr->index_noise_prev[ch] = fIndexNoise;
      sbr->psi_is_prev[ch] = fIndexSine;
  }
  /*}}}*/

  /*{{{*/
  /* FIXED POINT: bwArray = COEF */
  static real_t mapNewBw (uint8_t invf_mode, uint8_t invf_mode_prev)
  {
      switch (invf_mode)
      {
      case 1: /* LOW */
          if (invf_mode_prev == 0) /* NONE */
              return COEF_CONST(0.6);
          else
              return COEF_CONST(0.75);

      case 2: /* MID */
          return COEF_CONST(0.9);

      case 3: /* HIGH */
          return COEF_CONST(0.98);

      default: /* NONE */
          if (invf_mode_prev == 1) /* LOW */
              return COEF_CONST(0.6);
          else
              return COEF_CONST(0.0);
      }
  }
  /*}}}*/
  /*{{{*/
  /* FIXED POINT: bwArray = COEF */
  static void calc_chirp_factors (sbr_info *sbr, uint8_t ch)
  {
      uint8_t i;

      for (i = 0; i < sbr->N_Q; i++)
      {
          sbr->bwArray[ch][i] = mapNewBw(sbr->bs_invf_mode[ch][i], sbr->bs_invf_mode_prev[ch][i]);

          if (sbr->bwArray[ch][i] < sbr->bwArray_prev[ch][i])
              sbr->bwArray[ch][i] = MUL_F(sbr->bwArray[ch][i], FRAC_CONST(0.75)) + MUL_F(sbr->bwArray_prev[ch][i], FRAC_CONST(0.25));
          else
              sbr->bwArray[ch][i] = MUL_F(sbr->bwArray[ch][i], FRAC_CONST(0.90625)) + MUL_F(sbr->bwArray_prev[ch][i], FRAC_CONST(0.09375));

          if (sbr->bwArray[ch][i] < COEF_CONST(0.015625))
              sbr->bwArray[ch][i] = COEF_CONST(0.0);

          if (sbr->bwArray[ch][i] >= COEF_CONST(0.99609375))
              sbr->bwArray[ch][i] = COEF_CONST(0.99609375);

          sbr->bwArray_prev[ch][i] = sbr->bwArray[ch][i];
          sbr->bs_invf_mode_prev[ch][i] = sbr->bs_invf_mode[ch][i];
      }
  }
  /*}}}*/
  /*{{{*/
  static void patch_construction (sbr_info *sbr)
  {
      uint8_t i, k;
      uint8_t odd, sb;
      uint8_t msb = sbr->k0;
      uint8_t usb = sbr->kx;
      uint8_t goalSbTab[] = { 21, 23, 32, 43, 46, 64, 85, 93, 128, 0, 0, 0 };
      /* (uint8_t)(2.048e6/sbr->sample_rate + 0.5); */
      uint8_t goalSb = goalSbTab[get_sr_index(sbr->sample_rate)];

      sbr->noPatches = 0;

      if (goalSb < (sbr->kx + sbr->M))
      {
          for (i = 0, k = 0; sbr->f_master[i] < goalSb; i++)
              k = i+1;
      } else {
          k = sbr->N_master;
      }

      if (sbr->N_master == 0)
      {
          sbr->noPatches = 0;
          sbr->patchNoSubbands[0] = 0;
          sbr->patchStartSubband[0] = 0;

          return;
      }

      do
      {
          uint8_t j = k + 1;

          do
          {
              j--;

              sb = sbr->f_master[j];
              odd = (sb - 2 + sbr->k0) % 2;
          } while (sb > (sbr->k0 - 1 + msb - odd));

          sbr->patchNoSubbands[sbr->noPatches] = max(sb - usb, 0);
          sbr->patchStartSubband[sbr->noPatches] = sbr->k0 - odd -
              sbr->patchNoSubbands[sbr->noPatches];

          if (sbr->patchNoSubbands[sbr->noPatches] > 0)
          {
              usb = sb;
              msb = sb;
              sbr->noPatches++;
          } else {
              msb = sbr->kx;
          }

          if (sbr->f_master[k] - sb < 3)
              k = sbr->N_master;
      } while (sb != (sbr->kx + sbr->M));

      if ((sbr->patchNoSubbands[sbr->noPatches-1] < 3) && (sbr->noPatches > 1))
      {
          sbr->noPatches--;
      }

      sbr->noPatches = min(sbr->noPatches, 5);
  }
  /*}}}*/

  /*{{{*/
  ALIGN static const real_t qmf_c[640] = {
      FRAC_CONST(0), FRAC_CONST(-0.00055252865047),
      FRAC_CONST(-0.00056176925738), FRAC_CONST(-0.00049475180896),
      FRAC_CONST(-0.00048752279712), FRAC_CONST(-0.00048937912498),
      FRAC_CONST(-0.00050407143497), FRAC_CONST(-0.00052265642972),
      FRAC_CONST(-0.00054665656337), FRAC_CONST(-0.00056778025613),
      FRAC_CONST(-0.00058709304852), FRAC_CONST(-0.00061327473938),
      FRAC_CONST(-0.00063124935319), FRAC_CONST(-0.00065403333621),
      FRAC_CONST(-0.00067776907764), FRAC_CONST(-0.00069416146273),
      FRAC_CONST(-0.00071577364744), FRAC_CONST(-0.00072550431222),
      FRAC_CONST(-0.00074409418541), FRAC_CONST(-0.00074905980532),
      FRAC_CONST(-0.0007681371927), FRAC_CONST(-0.00077248485949),
      FRAC_CONST(-0.00078343322877), FRAC_CONST(-0.00077798694927),
      FRAC_CONST(-0.000780366471), FRAC_CONST(-0.00078014496257),
      FRAC_CONST(-0.0007757977331), FRAC_CONST(-0.00076307935757),
      FRAC_CONST(-0.00075300014201), FRAC_CONST(-0.00073193571525),
      FRAC_CONST(-0.00072153919876), FRAC_CONST(-0.00069179375372),
      FRAC_CONST(-0.00066504150893), FRAC_CONST(-0.00063415949025),
      FRAC_CONST(-0.0005946118933), FRAC_CONST(-0.00055645763906),
      FRAC_CONST(-0.00051455722108), FRAC_CONST(-0.00046063254803),
      FRAC_CONST(-0.00040951214522), FRAC_CONST(-0.00035011758756),
      FRAC_CONST(-0.00028969811748), FRAC_CONST(-0.0002098337344),
      FRAC_CONST(-0.00014463809349), FRAC_CONST(-6.173344072E-005),
      FRAC_CONST(1.349497418E-005), FRAC_CONST(0.00010943831274),
      FRAC_CONST(0.00020430170688), FRAC_CONST(0.00029495311041),
      FRAC_CONST(0.0004026540216), FRAC_CONST(0.00051073884952),
      FRAC_CONST(0.00062393761391), FRAC_CONST(0.00074580258865),
      FRAC_CONST(0.00086084433262), FRAC_CONST(0.00098859883015),
      FRAC_CONST(0.00112501551307), FRAC_CONST(0.00125778846475),
      FRAC_CONST(0.00139024948272), FRAC_CONST(0.00154432198471),
      FRAC_CONST(0.00168680832531), FRAC_CONST(0.00183482654224),
      FRAC_CONST(0.00198411407369), FRAC_CONST(0.00214615835557),
      FRAC_CONST(0.00230172547746), FRAC_CONST(0.00246256169126),
      FRAC_CONST(0.00262017586902), FRAC_CONST(0.00278704643465),
      FRAC_CONST(0.00294694477165), FRAC_CONST(0.00311254206525),
      FRAC_CONST(0.00327396134847), FRAC_CONST(0.00344188741828),
      FRAC_CONST(0.00360082681231), FRAC_CONST(0.00376039229104),
      FRAC_CONST(0.00392074323703), FRAC_CONST(0.00408197531935),
      FRAC_CONST(0.0042264269227), FRAC_CONST(0.00437307196781),
      FRAC_CONST(0.00452098527825), FRAC_CONST(0.00466064606118),
      FRAC_CONST(0.00479325608498), FRAC_CONST(0.00491376035745),
      FRAC_CONST(0.00503930226013), FRAC_CONST(0.00514073539032),
      FRAC_CONST(0.00524611661324), FRAC_CONST(0.00534716811982),
      FRAC_CONST(0.00541967759307), FRAC_CONST(0.00548760401507),
      FRAC_CONST(0.00554757145088), FRAC_CONST(0.00559380230045),
      FRAC_CONST(0.00562206432097), FRAC_CONST(0.00564551969164),
      FRAC_CONST(0.00563891995151), FRAC_CONST(0.00562661141932),
      FRAC_CONST(0.0055917128663), FRAC_CONST(0.005540436394),
      FRAC_CONST(0.0054753783077), FRAC_CONST(0.0053838975897),
      FRAC_CONST(0.00527157587272), FRAC_CONST(0.00513822754514),
      FRAC_CONST(0.00498396877629), FRAC_CONST(0.004810946906),
      FRAC_CONST(0.00460395301471), FRAC_CONST(0.00438018617447),
      FRAC_CONST(0.0041251642327), FRAC_CONST(0.00384564081246),
      FRAC_CONST(0.00354012465507), FRAC_CONST(0.00320918858098),
      FRAC_CONST(0.00284467578623), FRAC_CONST(0.00245085400321),
      FRAC_CONST(0.0020274176185), FRAC_CONST(0.00157846825768),
      FRAC_CONST(0.00109023290512), FRAC_CONST(0.0005832264248),
      FRAC_CONST(2.760451905E-005), FRAC_CONST(-0.00054642808664),
      FRAC_CONST(-0.00115681355227), FRAC_CONST(-0.00180394725893),
      FRAC_CONST(-0.00248267236449), FRAC_CONST(-0.003193377839),
      FRAC_CONST(-0.00394011240522), FRAC_CONST(-0.004722259624),
      FRAC_CONST(-0.00553372111088), FRAC_CONST(-0.00637922932685),
      FRAC_CONST(-0.00726158168517), FRAC_CONST(-0.00817982333726),
      FRAC_CONST(-0.00913253296085), FRAC_CONST(-0.01011502154986),
      FRAC_CONST(-0.01113155480321), FRAC_CONST(-0.01218499959508),
      FRAC_CONST(0.01327182200351), FRAC_CONST(0.01439046660792),
      FRAC_CONST(0.01554055533423), FRAC_CONST(0.01673247129989),
      FRAC_CONST(0.01794333813443), FRAC_CONST(0.01918724313698),
      FRAC_CONST(0.02045317933555), FRAC_CONST(0.02174675502535),
      FRAC_CONST(0.02306801692862), FRAC_CONST(0.02441609920285),
      FRAC_CONST(0.02578758475467), FRAC_CONST(0.02718594296329),
      FRAC_CONST(0.02860721736385), FRAC_CONST(0.03005026574279),
      FRAC_CONST(0.03150176087389), FRAC_CONST(0.03297540810337),
      FRAC_CONST(0.03446209487686), FRAC_CONST(0.03596975605542),
      FRAC_CONST(0.03748128504252), FRAC_CONST(0.03900536794745),
      FRAC_CONST(0.04053491705584), FRAC_CONST(0.04206490946367),
      FRAC_CONST(0.04360975421304), FRAC_CONST(0.04514884056413),
      FRAC_CONST(0.04668430272642), FRAC_CONST(0.04821657200672),
      FRAC_CONST(0.04973857556014), FRAC_CONST(0.05125561555216),
      FRAC_CONST(0.05276307465207), FRAC_CONST(0.05424527683589),
      FRAC_CONST(0.05571736482138), FRAC_CONST(0.05716164501299),
      FRAC_CONST(0.0585915683626), FRAC_CONST(0.05998374801761),
      FRAC_CONST(0.06134551717207), FRAC_CONST(0.06268578081172),
      FRAC_CONST(0.06397158980681), FRAC_CONST(0.0652247106438),
      FRAC_CONST(0.06643675122104), FRAC_CONST(0.06760759851228),
      FRAC_CONST(0.06870438283512), FRAC_CONST(0.06976302447127),
      FRAC_CONST(0.07076287107266), FRAC_CONST(0.07170026731102),
      FRAC_CONST(0.07256825833083), FRAC_CONST(0.07336202550803),
      FRAC_CONST(0.07410036424342), FRAC_CONST(0.07474525581194),
      FRAC_CONST(0.07531373362019), FRAC_CONST(0.07580083586584),
      FRAC_CONST(0.07619924793396), FRAC_CONST(0.07649921704119),
      FRAC_CONST(0.07670934904245), FRAC_CONST(0.07681739756964),
      FRAC_CONST(0.07682300113923), FRAC_CONST(0.07672049241746),
      FRAC_CONST(0.07650507183194), FRAC_CONST(0.07617483218536),
      FRAC_CONST(0.07573057565061), FRAC_CONST(0.0751576255287),
      FRAC_CONST(0.07446643947564), FRAC_CONST(0.0736406005762),
      FRAC_CONST(0.07267746427299), FRAC_CONST(0.07158263647903),
      FRAC_CONST(0.07035330735093), FRAC_CONST(0.06896640131951),
      FRAC_CONST(0.06745250215166), FRAC_CONST(0.06576906686508),
      FRAC_CONST(0.06394448059633), FRAC_CONST(0.06196027790387),
      FRAC_CONST(0.0598166570809), FRAC_CONST(0.05751526919867),
      FRAC_CONST(0.05504600343009), FRAC_CONST(0.05240938217366),
      FRAC_CONST(0.04959786763445), FRAC_CONST(0.04663033051701),
      FRAC_CONST(0.04347687821958), FRAC_CONST(0.04014582784127),
      FRAC_CONST(0.03664181168133), FRAC_CONST(0.03295839306691),
      FRAC_CONST(0.02908240060125), FRAC_CONST(0.02503075618909),
      FRAC_CONST(0.02079970728622), FRAC_CONST(0.01637012582228),
      FRAC_CONST(0.01176238327857), FRAC_CONST(0.00696368621617),
      FRAC_CONST(0.00197656014503), FRAC_CONST(-0.00320868968304),
      FRAC_CONST(-0.00857117491366), FRAC_CONST(-0.01412888273558),
      FRAC_CONST(-0.01988341292573), FRAC_CONST(-0.02582272888064),
      FRAC_CONST(-0.03195312745332), FRAC_CONST(-0.03827765720822),
      FRAC_CONST(-0.04478068215856), FRAC_CONST(-0.05148041767934),
      FRAC_CONST(-0.05837053268336), FRAC_CONST(-0.06544098531359),
      FRAC_CONST(-0.07269433008129), FRAC_CONST(-0.08013729344279),
      FRAC_CONST(-0.08775475365593), FRAC_CONST(-0.09555333528914),
      FRAC_CONST(-0.10353295311463), FRAC_CONST(-0.1116826931773),
      FRAC_CONST(-0.120007798468), FRAC_CONST(-0.12850028503878),
      FRAC_CONST(-0.13715517611934), FRAC_CONST(-0.1459766491187),
      FRAC_CONST(-0.15496070710605), FRAC_CONST(-0.16409588556669),
      FRAC_CONST(-0.17338081721706), FRAC_CONST(-0.18281725485142),
      FRAC_CONST(-0.19239667457267), FRAC_CONST(-0.20212501768103),
      FRAC_CONST(-0.21197358538056), FRAC_CONST(-0.22196526964149),
      FRAC_CONST(-0.23206908706791), FRAC_CONST(-0.24230168845974),
      FRAC_CONST(-0.25264803095722), FRAC_CONST(-0.26310532994603),
      FRAC_CONST(-0.27366340405625), FRAC_CONST(-0.28432141891085),
      FRAC_CONST(-0.29507167170646), FRAC_CONST(-0.30590985751916),
      FRAC_CONST(-0.31682789136456), FRAC_CONST(-0.32781137272105),
      FRAC_CONST(-0.33887226938665), FRAC_CONST(-0.3499914122931),
      FRAC_CONST(0.36115899031355), FRAC_CONST(0.37237955463061),
      FRAC_CONST(0.38363500139043), FRAC_CONST(0.39492117615675),
      FRAC_CONST(0.40623176767625), FRAC_CONST(0.41756968968409),
      FRAC_CONST(0.42891199207373), FRAC_CONST(0.44025537543665),
      FRAC_CONST(0.45159965356824), FRAC_CONST(0.46293080852757),
      FRAC_CONST(0.47424532146115), FRAC_CONST(0.48552530911099),
      FRAC_CONST(0.49677082545707), FRAC_CONST(0.50798175000434),
      FRAC_CONST(0.51912349702391), FRAC_CONST(0.53022408956855),
      FRAC_CONST(0.54125534487322), FRAC_CONST(0.55220512585061),
      FRAC_CONST(0.5630789140137), FRAC_CONST(0.57385241316923),
      FRAC_CONST(0.58454032354679), FRAC_CONST(0.59511230862496),
      FRAC_CONST(0.6055783538918), FRAC_CONST(0.61591099320291),
      FRAC_CONST(0.62612426956055), FRAC_CONST(0.63619801077286),
      FRAC_CONST(0.64612696959461), FRAC_CONST(0.65590163024671),
      FRAC_CONST(0.66551398801627), FRAC_CONST(0.67496631901712),
      FRAC_CONST(0.68423532934598), FRAC_CONST(0.69332823767032),
      FRAC_CONST(0.70223887193539), FRAC_CONST(0.71094104263095),
      FRAC_CONST(0.71944626349561), FRAC_CONST(0.72774489002994),
      FRAC_CONST(0.73582117582769), FRAC_CONST(0.74368278636488),
      FRAC_CONST(0.75131374561237), FRAC_CONST(0.75870807608242),
      FRAC_CONST(0.76586748650939), FRAC_CONST(0.77277808813327),
      FRAC_CONST(0.77942875190216), FRAC_CONST(0.7858353120392),
      FRAC_CONST(0.79197358416424), FRAC_CONST(0.797846641377),
      FRAC_CONST(0.80344857518505), FRAC_CONST(0.80876950044491),
      FRAC_CONST(0.81381912706217), FRAC_CONST(0.81857760046468),
      FRAC_CONST(0.82304198905409), FRAC_CONST(0.8272275347336),
      FRAC_CONST(0.8311038457152), FRAC_CONST(0.83469373618402),
      FRAC_CONST(0.83797173378865), FRAC_CONST(0.84095413924722),
      FRAC_CONST(0.84362382812005), FRAC_CONST(0.84598184698206),
      FRAC_CONST(0.84803157770763), FRAC_CONST(0.84978051984268),
      FRAC_CONST(0.85119715249343), FRAC_CONST(0.85230470352147),
      FRAC_CONST(0.85310209497017), FRAC_CONST(0.85357205739107),
      FRAC_CONST(0.85373856005937 /*max*/), FRAC_CONST(0.85357205739107),
      FRAC_CONST(0.85310209497017), FRAC_CONST(0.85230470352147),
      FRAC_CONST(0.85119715249343), FRAC_CONST(0.84978051984268),
      FRAC_CONST(0.84803157770763), FRAC_CONST(0.84598184698206),
      FRAC_CONST(0.84362382812005), FRAC_CONST(0.84095413924722),
      FRAC_CONST(0.83797173378865), FRAC_CONST(0.83469373618402),
      FRAC_CONST(0.8311038457152), FRAC_CONST(0.8272275347336),
      FRAC_CONST(0.82304198905409), FRAC_CONST(0.81857760046468),
      FRAC_CONST(0.81381912706217), FRAC_CONST(0.80876950044491),
      FRAC_CONST(0.80344857518505), FRAC_CONST(0.797846641377),
      FRAC_CONST(0.79197358416424), FRAC_CONST(0.7858353120392),
      FRAC_CONST(0.77942875190216), FRAC_CONST(0.77277808813327),
      FRAC_CONST(0.76586748650939), FRAC_CONST(0.75870807608242),
      FRAC_CONST(0.75131374561237), FRAC_CONST(0.74368278636488),
      FRAC_CONST(0.73582117582769), FRAC_CONST(0.72774489002994),
      FRAC_CONST(0.71944626349561), FRAC_CONST(0.71094104263095),
      FRAC_CONST(0.70223887193539), FRAC_CONST(0.69332823767032),
      FRAC_CONST(0.68423532934598), FRAC_CONST(0.67496631901712),
      FRAC_CONST(0.66551398801627), FRAC_CONST(0.65590163024671),
      FRAC_CONST(0.64612696959461), FRAC_CONST(0.63619801077286),
      FRAC_CONST(0.62612426956055), FRAC_CONST(0.61591099320291),
      FRAC_CONST(0.6055783538918), FRAC_CONST(0.59511230862496),
      FRAC_CONST(0.58454032354679), FRAC_CONST(0.57385241316923),
      FRAC_CONST(0.5630789140137), FRAC_CONST(0.55220512585061),
      FRAC_CONST(0.54125534487322), FRAC_CONST(0.53022408956855),
      FRAC_CONST(0.51912349702391), FRAC_CONST(0.50798175000434),
      FRAC_CONST(0.49677082545707), FRAC_CONST(0.48552530911099),
      FRAC_CONST(0.47424532146115), FRAC_CONST(0.46293080852757),
      FRAC_CONST(0.45159965356824), FRAC_CONST(0.44025537543665),
      FRAC_CONST(0.42891199207373), FRAC_CONST(0.41756968968409),
      FRAC_CONST(0.40623176767625), FRAC_CONST(0.39492117615675),
      FRAC_CONST(0.38363500139043), FRAC_CONST(0.37237955463061),
      FRAC_CONST(-0.36115899031355), FRAC_CONST(-0.3499914122931),
      FRAC_CONST(-0.33887226938665), FRAC_CONST(-0.32781137272105),
      FRAC_CONST(-0.31682789136456), FRAC_CONST(-0.30590985751916),
      FRAC_CONST(-0.29507167170646), FRAC_CONST(-0.28432141891085),
      FRAC_CONST(-0.27366340405625), FRAC_CONST(-0.26310532994603),
      FRAC_CONST(-0.25264803095722), FRAC_CONST(-0.24230168845974),
      FRAC_CONST(-0.23206908706791), FRAC_CONST(-0.22196526964149),
      FRAC_CONST(-0.21197358538056), FRAC_CONST(-0.20212501768103),
      FRAC_CONST(-0.19239667457267), FRAC_CONST(-0.18281725485142),
      FRAC_CONST(-0.17338081721706), FRAC_CONST(-0.16409588556669),
      FRAC_CONST(-0.15496070710605), FRAC_CONST(-0.1459766491187),
      FRAC_CONST(-0.13715517611934), FRAC_CONST(-0.12850028503878),
      FRAC_CONST(-0.120007798468), FRAC_CONST(-0.1116826931773),
      FRAC_CONST(-0.10353295311463), FRAC_CONST(-0.09555333528914),
      FRAC_CONST(-0.08775475365593), FRAC_CONST(-0.08013729344279),
      FRAC_CONST(-0.07269433008129), FRAC_CONST(-0.06544098531359),
      FRAC_CONST(-0.05837053268336), FRAC_CONST(-0.05148041767934),
      FRAC_CONST(-0.04478068215856), FRAC_CONST(-0.03827765720822),
      FRAC_CONST(-0.03195312745332), FRAC_CONST(-0.02582272888064),
      FRAC_CONST(-0.01988341292573), FRAC_CONST(-0.01412888273558),
      FRAC_CONST(-0.00857117491366), FRAC_CONST(-0.00320868968304),
      FRAC_CONST(0.00197656014503), FRAC_CONST(0.00696368621617),
      FRAC_CONST(0.01176238327857), FRAC_CONST(0.01637012582228),
      FRAC_CONST(0.02079970728622), FRAC_CONST(0.02503075618909),
      FRAC_CONST(0.02908240060125), FRAC_CONST(0.03295839306691),
      FRAC_CONST(0.03664181168133), FRAC_CONST(0.04014582784127),
      FRAC_CONST(0.04347687821958), FRAC_CONST(0.04663033051701),
      FRAC_CONST(0.04959786763445), FRAC_CONST(0.05240938217366),
      FRAC_CONST(0.05504600343009), FRAC_CONST(0.05751526919867),
      FRAC_CONST(0.0598166570809), FRAC_CONST(0.06196027790387),
      FRAC_CONST(0.06394448059633), FRAC_CONST(0.06576906686508),
      FRAC_CONST(0.06745250215166), FRAC_CONST(0.06896640131951),
      FRAC_CONST(0.07035330735093), FRAC_CONST(0.07158263647903),
      FRAC_CONST(0.07267746427299), FRAC_CONST(0.0736406005762),
      FRAC_CONST(0.07446643947564), FRAC_CONST(0.0751576255287),
      FRAC_CONST(0.07573057565061), FRAC_CONST(0.07617483218536),
      FRAC_CONST(0.07650507183194), FRAC_CONST(0.07672049241746),
      FRAC_CONST(0.07682300113923), FRAC_CONST(0.07681739756964),
      FRAC_CONST(0.07670934904245), FRAC_CONST(0.07649921704119),
      FRAC_CONST(0.07619924793396), FRAC_CONST(0.07580083586584),
      FRAC_CONST(0.07531373362019), FRAC_CONST(0.07474525581194),
      FRAC_CONST(0.07410036424342), FRAC_CONST(0.07336202550803),
      FRAC_CONST(0.07256825833083), FRAC_CONST(0.07170026731102),
      FRAC_CONST(0.07076287107266), FRAC_CONST(0.06976302447127),
      FRAC_CONST(0.06870438283512), FRAC_CONST(0.06760759851228),
      FRAC_CONST(0.06643675122104), FRAC_CONST(0.0652247106438),
      FRAC_CONST(0.06397158980681), FRAC_CONST(0.06268578081172),
      FRAC_CONST(0.06134551717207), FRAC_CONST(0.05998374801761),
      FRAC_CONST(0.0585915683626), FRAC_CONST(0.05716164501299),
      FRAC_CONST(0.05571736482138), FRAC_CONST(0.05424527683589),
      FRAC_CONST(0.05276307465207), FRAC_CONST(0.05125561555216),
      FRAC_CONST(0.04973857556014), FRAC_CONST(0.04821657200672),
      FRAC_CONST(0.04668430272642), FRAC_CONST(0.04514884056413),
      FRAC_CONST(0.04360975421304), FRAC_CONST(0.04206490946367),
      FRAC_CONST(0.04053491705584), FRAC_CONST(0.03900536794745),
      FRAC_CONST(0.03748128504252), FRAC_CONST(0.03596975605542),
      FRAC_CONST(0.03446209487686), FRAC_CONST(0.03297540810337),
      FRAC_CONST(0.03150176087389), FRAC_CONST(0.03005026574279),
      FRAC_CONST(0.02860721736385), FRAC_CONST(0.02718594296329),
      FRAC_CONST(0.02578758475467), FRAC_CONST(0.02441609920285),
      FRAC_CONST(0.02306801692862), FRAC_CONST(0.02174675502535),
      FRAC_CONST(0.02045317933555), FRAC_CONST(0.01918724313698),
      FRAC_CONST(0.01794333813443), FRAC_CONST(0.01673247129989),
      FRAC_CONST(0.01554055533423), FRAC_CONST(0.01439046660792),
      FRAC_CONST(-0.01327182200351), FRAC_CONST(-0.01218499959508),
      FRAC_CONST(-0.01113155480321), FRAC_CONST(-0.01011502154986),
      FRAC_CONST(-0.00913253296085), FRAC_CONST(-0.00817982333726),
      FRAC_CONST(-0.00726158168517), FRAC_CONST(-0.00637922932685),
      FRAC_CONST(-0.00553372111088), FRAC_CONST(-0.004722259624),
      FRAC_CONST(-0.00394011240522), FRAC_CONST(-0.003193377839),
      FRAC_CONST(-0.00248267236449), FRAC_CONST(-0.00180394725893),
      FRAC_CONST(-0.00115681355227), FRAC_CONST(-0.00054642808664),
      FRAC_CONST(2.760451905E-005), FRAC_CONST(0.0005832264248),
      FRAC_CONST(0.00109023290512), FRAC_CONST(0.00157846825768),
      FRAC_CONST(0.0020274176185), FRAC_CONST(0.00245085400321),
      FRAC_CONST(0.00284467578623), FRAC_CONST(0.00320918858098),
      FRAC_CONST(0.00354012465507), FRAC_CONST(0.00384564081246),
      FRAC_CONST(0.0041251642327), FRAC_CONST(0.00438018617447),
      FRAC_CONST(0.00460395301471), FRAC_CONST(0.004810946906),
      FRAC_CONST(0.00498396877629), FRAC_CONST(0.00513822754514),
      FRAC_CONST(0.00527157587272), FRAC_CONST(0.0053838975897),
      FRAC_CONST(0.0054753783077), FRAC_CONST(0.005540436394),
      FRAC_CONST(0.0055917128663), FRAC_CONST(0.00562661141932),
      FRAC_CONST(0.00563891995151), FRAC_CONST(0.00564551969164),
      FRAC_CONST(0.00562206432097), FRAC_CONST(0.00559380230045),
      FRAC_CONST(0.00554757145088), FRAC_CONST(0.00548760401507),
      FRAC_CONST(0.00541967759307), FRAC_CONST(0.00534716811982),
      FRAC_CONST(0.00524611661324), FRAC_CONST(0.00514073539032),
      FRAC_CONST(0.00503930226013), FRAC_CONST(0.00491376035745),
      FRAC_CONST(0.00479325608498), FRAC_CONST(0.00466064606118),
      FRAC_CONST(0.00452098527825), FRAC_CONST(0.00437307196781),
      FRAC_CONST(0.0042264269227), FRAC_CONST(0.00408197531935),
      FRAC_CONST(0.00392074323703), FRAC_CONST(0.00376039229104),
      FRAC_CONST(0.00360082681231), FRAC_CONST(0.00344188741828),
      FRAC_CONST(0.00327396134847), FRAC_CONST(0.00311254206525),
      FRAC_CONST(0.00294694477165), FRAC_CONST(0.00278704643465),
      FRAC_CONST(0.00262017586902), FRAC_CONST(0.00246256169126),
      FRAC_CONST(0.00230172547746), FRAC_CONST(0.00214615835557),
      FRAC_CONST(0.00198411407369), FRAC_CONST(0.00183482654224),
      FRAC_CONST(0.00168680832531), FRAC_CONST(0.00154432198471),
      FRAC_CONST(0.00139024948272), FRAC_CONST(0.00125778846475),
      FRAC_CONST(0.00112501551307), FRAC_CONST(0.00098859883015),
      FRAC_CONST(0.00086084433262), FRAC_CONST(0.00074580258865),
      FRAC_CONST(0.00062393761391), FRAC_CONST(0.00051073884952),
      FRAC_CONST(0.0004026540216), FRAC_CONST(0.00029495311041),
      FRAC_CONST(0.00020430170688), FRAC_CONST(0.00010943831274),
      FRAC_CONST(1.349497418E-005), FRAC_CONST(-6.173344072E-005),
      FRAC_CONST(-0.00014463809349), FRAC_CONST(-0.0002098337344),
      FRAC_CONST(-0.00028969811748), FRAC_CONST(-0.00035011758756),
      FRAC_CONST(-0.00040951214522), FRAC_CONST(-0.00046063254803),
      FRAC_CONST(-0.00051455722108), FRAC_CONST(-0.00055645763906),
      FRAC_CONST(-0.0005946118933), FRAC_CONST(-0.00063415949025),
      FRAC_CONST(-0.00066504150893), FRAC_CONST(-0.00069179375372),
      FRAC_CONST(-0.00072153919876), FRAC_CONST(-0.00073193571525),
      FRAC_CONST(-0.00075300014201), FRAC_CONST(-0.00076307935757),
      FRAC_CONST(-0.0007757977331), FRAC_CONST(-0.00078014496257),
      FRAC_CONST(-0.000780366471), FRAC_CONST(-0.00077798694927),
      FRAC_CONST(-0.00078343322877), FRAC_CONST(-0.00077248485949),
      FRAC_CONST(-0.0007681371927), FRAC_CONST(-0.00074905980532),
      FRAC_CONST(-0.00074409418541), FRAC_CONST(-0.00072550431222),
      FRAC_CONST(-0.00071577364744), FRAC_CONST(-0.00069416146273),
      FRAC_CONST(-0.00067776907764), FRAC_CONST(-0.00065403333621),
      FRAC_CONST(-0.00063124935319), FRAC_CONST(-0.00061327473938),
      FRAC_CONST(-0.00058709304852), FRAC_CONST(-0.00056778025613),
      FRAC_CONST(-0.00054665656337), FRAC_CONST(-0.00052265642972),
      FRAC_CONST(-0.00050407143497), FRAC_CONST(-0.00048937912498),
      FRAC_CONST(-0.00048752279712), FRAC_CONST(-0.00049475180896),
      FRAC_CONST(-0.00056176925738), FRAC_CONST(-0.00055252865047)
  };
  /*}}}*/
  /*{{{*/
  static const complex_t qmf32_pre_twiddle[] = {
    { FRAC_CONST(0.999924701839145), FRAC_CONST(-0.012271538285720) },
    { FRAC_CONST(0.999322384588350), FRAC_CONST(-0.036807222941359) },
    { FRAC_CONST(0.998118112900149), FRAC_CONST(-0.061320736302209) },
    { FRAC_CONST(0.996312612182778), FRAC_CONST(-0.085797312344440) },
    { FRAC_CONST(0.993906970002356), FRAC_CONST(-0.110222207293883) },
    { FRAC_CONST(0.990902635427780), FRAC_CONST(-0.134580708507126) },
    { FRAC_CONST(0.987301418157858), FRAC_CONST(-0.158858143333861) },
    { FRAC_CONST(0.983105487431216), FRAC_CONST(-0.183039887955141) },
    { FRAC_CONST(0.978317370719628), FRAC_CONST(-0.207111376192219) },
    { FRAC_CONST(0.972939952205560), FRAC_CONST(-0.231058108280671) },
    { FRAC_CONST(0.966976471044852), FRAC_CONST(-0.254865659604515) },
    { FRAC_CONST(0.960430519415566), FRAC_CONST(-0.278519689385053) },
    { FRAC_CONST(0.953306040354194), FRAC_CONST(-0.302005949319228) },
    { FRAC_CONST(0.945607325380521), FRAC_CONST(-0.325310292162263) },
    { FRAC_CONST(0.937339011912575), FRAC_CONST(-0.348418680249435) },
    { FRAC_CONST(0.928506080473216), FRAC_CONST(-0.371317193951838) },
    { FRAC_CONST(0.919113851690058), FRAC_CONST(-0.393992040061048) },
    { FRAC_CONST(0.909167983090522), FRAC_CONST(-0.416429560097637) },
    { FRAC_CONST(0.898674465693954), FRAC_CONST(-0.438616238538528) },
    { FRAC_CONST(0.887639620402854), FRAC_CONST(-0.460538710958240) },
    { FRAC_CONST(0.876070094195407), FRAC_CONST(-0.482183772079123) },
    { FRAC_CONST(0.863972856121587), FRAC_CONST(-0.503538383725718) },
    { FRAC_CONST(0.851355193105265), FRAC_CONST(-0.524589682678469) },
    { FRAC_CONST(0.838224705554838), FRAC_CONST(-0.545324988422046) },
    { FRAC_CONST(0.824589302785025), FRAC_CONST(-0.565731810783613) },
    { FRAC_CONST(0.810457198252595), FRAC_CONST(-0.585797857456439) },
    { FRAC_CONST(0.795836904608884), FRAC_CONST(-0.605511041404326) },
    { FRAC_CONST(0.780737228572094), FRAC_CONST(-0.624859488142386) },
    { FRAC_CONST(0.765167265622459), FRAC_CONST(-0.643831542889791) },
    { FRAC_CONST(0.749136394523459), FRAC_CONST(-0.662415777590172) },
    { FRAC_CONST(0.732654271672413), FRAC_CONST(-0.680600997795453) },
    { FRAC_CONST(0.715730825283819), FRAC_CONST(-0.698376249408973) }
    };
  /*}}}*/

  /*{{{*/
  void DCT4_32 (real_t *y, real_t *x)
  {
      real_t f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10;
      real_t f11, f12, f13, f14, f15, f16, f17, f18, f19, f20;
      real_t f21, f22, f23, f24, f25, f26, f27, f28, f29, f30;
      real_t f31, f32, f33, f34, f35, f36, f37, f38, f39, f40;
      real_t f41, f42, f43, f44, f45, f46, f47, f48, f49, f50;
      real_t f51, f52, f53, f54, f55, f56, f57, f58, f59, f60;
      real_t f61, f62, f63, f64, f65, f66, f67, f68, f69, f70;
      real_t f71, f72, f73, f74, f75, f76, f77, f78, f79, f80;
      real_t f81, f82, f83, f84, f85, f86, f87, f88, f89, f90;
      real_t f91, f92, f93, f94, f95, f96, f97, f98, f99, f100;
      real_t f101, f102, f103, f104, f105, f106, f107, f108, f109, f110;
      real_t f111, f112, f113, f114, f115, f116, f117, f118, f119, f120;
      real_t f121, f122, f123, f124, f125, f126, f127, f128, f129, f130;
      real_t f131, f132, f133, f134, f135, f136, f137, f138, f139, f140;
      real_t f141, f142, f143, f144, f145, f146, f147, f148, f149, f150;
      real_t f151, f152, f153, f154, f155, f156, f157, f158, f159, f160;
      real_t f161, f162, f163, f164, f165, f166, f167, f168, f169, f170;
      real_t f171, f172, f173, f174, f175, f176, f177, f178, f179, f180;
      real_t f181, f182, f183, f184, f185, f186, f187, f188, f189, f190;
      real_t f191, f192, f193, f194, f195, f196, f197, f198, f199, f200;
      real_t f201, f202, f203, f204, f205, f206, f207, f208, f209, f210;
      real_t f211, f212, f213, f214, f215, f216, f217, f218, f219, f220;
      real_t f221, f222, f223, f224, f225, f226, f227, f228, f229, f230;
      real_t f231, f232, f233, f234, f235, f236, f237, f238, f239, f240;
      real_t f241, f242, f243, f244, f245, f246, f247, f248, f249, f250;
      real_t f251, f252, f253, f254, f255, f256, f257, f258, f259, f260;
      real_t f261, f262, f263, f264, f265, f266, f267, f268, f269, f270;
      real_t f271, f272, f273, f274, f275, f276, f277, f278, f279, f280;
      real_t f281, f282, f283, f284, f285, f286, f287, f288, f289, f290;
      real_t f291, f292, f293, f294, f295, f296, f297, f298, f299, f300;
      real_t f301, f302, f303, f304, f305, f306, f307, f310, f311, f312;
      real_t f313, f316, f317, f318, f319, f322, f323, f324, f325, f328;
      real_t f329, f330, f331, f334, f335, f336, f337, f340, f341, f342;
      real_t f343, f346, f347, f348, f349, f352, f353, f354, f355, f358;
      real_t f359, f360, f361, f364, f365, f366, f367, f370, f371, f372;
      real_t f373, f376, f377, f378, f379, f382, f383, f384, f385, f388;
      real_t f389, f390, f391, f394, f395, f396, f397;

      f0 = x[15] - x[16];
      f1 = x[15] + x[16];
      f2 = MUL_F(FRAC_CONST(0.7071067811865476), f1);
      f3 = MUL_F(FRAC_CONST(0.7071067811865476), f0);
      f4 = x[8] - x[23];
      f5 = x[8] + x[23];
      f6 = MUL_F(FRAC_CONST(0.7071067811865476), f5);
      f7 = MUL_F(FRAC_CONST(0.7071067811865476), f4);
      f8 = x[12] - x[19];
      f9 = x[12] + x[19];
      f10 = MUL_F(FRAC_CONST(0.7071067811865476), f9);
      f11 = MUL_F(FRAC_CONST(0.7071067811865476), f8);
      f12 = x[11] - x[20];
      f13 = x[11] + x[20];
      f14 = MUL_F(FRAC_CONST(0.7071067811865476), f13);
      f15 = MUL_F(FRAC_CONST(0.7071067811865476), f12);
      f16 = x[14] - x[17];
      f17 = x[14] + x[17];
      f18 = MUL_F(FRAC_CONST(0.7071067811865476), f17);
      f19 = MUL_F(FRAC_CONST(0.7071067811865476), f16);
      f20 = x[9] - x[22];
      f21 = x[9] + x[22];
      f22 = MUL_F(FRAC_CONST(0.7071067811865476), f21);
      f23 = MUL_F(FRAC_CONST(0.7071067811865476), f20);
      f24 = x[13] - x[18];
      f25 = x[13] + x[18];
      f26 = MUL_F(FRAC_CONST(0.7071067811865476), f25);
      f27 = MUL_F(FRAC_CONST(0.7071067811865476), f24);
      f28 = x[10] - x[21];
      f29 = x[10] + x[21];
      f30 = MUL_F(FRAC_CONST(0.7071067811865476), f29);
      f31 = MUL_F(FRAC_CONST(0.7071067811865476), f28);
      f32 = x[0] - f2;
      f33 = x[0] + f2;
      f34 = x[31] - f3;
      f35 = x[31] + f3;
      f36 = x[7] - f6;
      f37 = x[7] + f6;
      f38 = x[24] - f7;
      f39 = x[24] + f7;
      f40 = x[3] - f10;
      f41 = x[3] + f10;
      f42 = x[28] - f11;
      f43 = x[28] + f11;
      f44 = x[4] - f14;
      f45 = x[4] + f14;
      f46 = x[27] - f15;
      f47 = x[27] + f15;
      f48 = x[1] - f18;
      f49 = x[1] + f18;
      f50 = x[30] - f19;
      f51 = x[30] + f19;
      f52 = x[6] - f22;
      f53 = x[6] + f22;
      f54 = x[25] - f23;
      f55 = x[25] + f23;
      f56 = x[2] - f26;
      f57 = x[2] + f26;
      f58 = x[29] - f27;
      f59 = x[29] + f27;
      f60 = x[5] - f30;
      f61 = x[5] + f30;
      f62 = x[26] - f31;
      f63 = x[26] + f31;
      f64 = f39 + f37;
      f65 = MUL_F(FRAC_CONST(-0.5411961001461969), f39);
      f66 = MUL_F(FRAC_CONST(0.9238795325112867), f64);
      f67 = MUL_C(COEF_CONST(1.3065629648763766), f37);
      f68 = f65 + f66;
      f69 = f67 - f66;
      f70 = f38 + f36;
      f71 = MUL_C(COEF_CONST(1.3065629648763770), f38);
      f72 = MUL_F(FRAC_CONST(-0.3826834323650904), f70);
      f73 = MUL_F(FRAC_CONST(0.5411961001461961), f36);
      f74 = f71 + f72;
      f75 = f73 - f72;
      f76 = f47 + f45;
      f77 = MUL_F(FRAC_CONST(-0.5411961001461969), f47);
      f78 = MUL_F(FRAC_CONST(0.9238795325112867), f76);
      f79 = MUL_C(COEF_CONST(1.3065629648763766), f45);
      f80 = f77 + f78;
      f81 = f79 - f78;
      f82 = f46 + f44;
      f83 = MUL_C(COEF_CONST(1.3065629648763770), f46);
      f84 = MUL_F(FRAC_CONST(-0.3826834323650904), f82);
      f85 = MUL_F(FRAC_CONST(0.5411961001461961), f44);
      f86 = f83 + f84;
      f87 = f85 - f84;
      f88 = f55 + f53;
      f89 = MUL_F(FRAC_CONST(-0.5411961001461969), f55);
      f90 = MUL_F(FRAC_CONST(0.9238795325112867), f88);
      f91 = MUL_C(COEF_CONST(1.3065629648763766), f53);
      f92 = f89 + f90;
      f93 = f91 - f90;
      f94 = f54 + f52;
      f95 = MUL_C(COEF_CONST(1.3065629648763770), f54);
      f96 = MUL_F(FRAC_CONST(-0.3826834323650904), f94);
      f97 = MUL_F(FRAC_CONST(0.5411961001461961), f52);
      f98 = f95 + f96;
      f99 = f97 - f96;
      f100 = f63 + f61;
      f101 = MUL_F(FRAC_CONST(-0.5411961001461969), f63);
      f102 = MUL_F(FRAC_CONST(0.9238795325112867), f100);
      f103 = MUL_C(COEF_CONST(1.3065629648763766), f61);
      f104 = f101 + f102;
      f105 = f103 - f102;
      f106 = f62 + f60;
      f107 = MUL_C(COEF_CONST(1.3065629648763770), f62);
      f108 = MUL_F(FRAC_CONST(-0.3826834323650904), f106);
      f109 = MUL_F(FRAC_CONST(0.5411961001461961), f60);
      f110 = f107 + f108;
      f111 = f109 - f108;
      f112 = f33 - f68;
      f113 = f33 + f68;
      f114 = f35 - f69;
      f115 = f35 + f69;
      f116 = f32 - f74;
      f117 = f32 + f74;
      f118 = f34 - f75;
      f119 = f34 + f75;
      f120 = f41 - f80;
      f121 = f41 + f80;
      f122 = f43 - f81;
      f123 = f43 + f81;
      f124 = f40 - f86;
      f125 = f40 + f86;
      f126 = f42 - f87;
      f127 = f42 + f87;
      f128 = f49 - f92;
      f129 = f49 + f92;
      f130 = f51 - f93;
      f131 = f51 + f93;
      f132 = f48 - f98;
      f133 = f48 + f98;
      f134 = f50 - f99;
      f135 = f50 + f99;
      f136 = f57 - f104;
      f137 = f57 + f104;
      f138 = f59 - f105;
      f139 = f59 + f105;
      f140 = f56 - f110;
      f141 = f56 + f110;
      f142 = f58 - f111;
      f143 = f58 + f111;
      f144 = f123 + f121;
      f145 = MUL_F(FRAC_CONST(-0.7856949583871021), f123);
      f146 = MUL_F(FRAC_CONST(0.9807852804032304), f144);
      f147 = MUL_C(COEF_CONST(1.1758756024193588), f121);
      f148 = f145 + f146;
      f149 = f147 - f146;
      f150 = f127 + f125;
      f151 = MUL_F(FRAC_CONST(0.2758993792829431), f127);
      f152 = MUL_F(FRAC_CONST(0.5555702330196022), f150);
      f153 = MUL_C(COEF_CONST(1.3870398453221475), f125);
      f154 = f151 + f152;
      f155 = f153 - f152;
      f156 = f122 + f120;
      f157 = MUL_C(COEF_CONST(1.1758756024193591), f122);
      f158 = MUL_F(FRAC_CONST(-0.1950903220161287), f156);
      f159 = MUL_F(FRAC_CONST(0.7856949583871016), f120);
      f160 = f157 + f158;
      f161 = f159 - f158;
      f162 = f126 + f124;
      f163 = MUL_C(COEF_CONST(1.3870398453221473), f126);
      f164 = MUL_F(FRAC_CONST(-0.8314696123025455), f162);
      f165 = MUL_F(FRAC_CONST(-0.2758993792829436), f124);
      f166 = f163 + f164;
      f167 = f165 - f164;
      f168 = f139 + f137;
      f169 = MUL_F(FRAC_CONST(-0.7856949583871021), f139);
      f170 = MUL_F(FRAC_CONST(0.9807852804032304), f168);
      f171 = MUL_C(COEF_CONST(1.1758756024193588), f137);
      f172 = f169 + f170;
      f173 = f171 - f170;
      f174 = f143 + f141;
      f175 = MUL_F(FRAC_CONST(0.2758993792829431), f143);
      f176 = MUL_F(FRAC_CONST(0.5555702330196022), f174);
      f177 = MUL_C(COEF_CONST(1.3870398453221475), f141);
      f178 = f175 + f176;
      f179 = f177 - f176;
      f180 = f138 + f136;
      f181 = MUL_C(COEF_CONST(1.1758756024193591), f138);
      f182 = MUL_F(FRAC_CONST(-0.1950903220161287), f180);
      f183 = MUL_F(FRAC_CONST(0.7856949583871016), f136);
      f184 = f181 + f182;
      f185 = f183 - f182;
      f186 = f142 + f140;
      f187 = MUL_C(COEF_CONST(1.3870398453221473), f142);
      f188 = MUL_F(FRAC_CONST(-0.8314696123025455), f186);
      f189 = MUL_F(FRAC_CONST(-0.2758993792829436), f140);
      f190 = f187 + f188;
      f191 = f189 - f188;
      f192 = f113 - f148;
      f193 = f113 + f148;
      f194 = f115 - f149;
      f195 = f115 + f149;
      f196 = f117 - f154;
      f197 = f117 + f154;
      f198 = f119 - f155;
      f199 = f119 + f155;
      f200 = f112 - f160;
      f201 = f112 + f160;
      f202 = f114 - f161;
      f203 = f114 + f161;
      f204 = f116 - f166;
      f205 = f116 + f166;
      f206 = f118 - f167;
      f207 = f118 + f167;
      f208 = f129 - f172;
      f209 = f129 + f172;
      f210 = f131 - f173;
      f211 = f131 + f173;
      f212 = f133 - f178;
      f213 = f133 + f178;
      f214 = f135 - f179;
      f215 = f135 + f179;
      f216 = f128 - f184;
      f217 = f128 + f184;
      f218 = f130 - f185;
      f219 = f130 + f185;
      f220 = f132 - f190;
      f221 = f132 + f190;
      f222 = f134 - f191;
      f223 = f134 + f191;
      f224 = f211 + f209;
      f225 = MUL_F(FRAC_CONST(-0.8971675863426361), f211);
      f226 = MUL_F(FRAC_CONST(0.9951847266721968), f224);
      f227 = MUL_C(COEF_CONST(1.0932018670017576), f209);
      f228 = f225 + f226;
      f229 = f227 - f226;
      f230 = f215 + f213;
      f231 = MUL_F(FRAC_CONST(-0.4105245275223571), f215);
      f232 = MUL_F(FRAC_CONST(0.8819212643483549), f230);
      f233 = MUL_C(COEF_CONST(1.3533180011743529), f213);
      f234 = f231 + f232;
      f235 = f233 - f232;
      f236 = f219 + f217;
      f237 = MUL_F(FRAC_CONST(0.1386171691990915), f219);
      f238 = MUL_F(FRAC_CONST(0.6343932841636455), f236);
      f239 = MUL_C(COEF_CONST(1.4074037375263826), f217);
      f240 = f237 + f238;
      f241 = f239 - f238;
      f242 = f223 + f221;
      f243 = MUL_F(FRAC_CONST(0.6666556584777466), f223);
      f244 = MUL_F(FRAC_CONST(0.2902846772544623), f242);
      f245 = MUL_C(COEF_CONST(1.2472250129866711), f221);
      f246 = f243 + f244;
      f247 = f245 - f244;
      f248 = f210 + f208;
      f249 = MUL_C(COEF_CONST(1.0932018670017574), f210);
      f250 = MUL_F(FRAC_CONST(-0.0980171403295605), f248);
      f251 = MUL_F(FRAC_CONST(0.8971675863426364), f208);
      f252 = f249 + f250;
      f253 = f251 - f250;
      f254 = f214 + f212;
      f255 = MUL_C(COEF_CONST(1.3533180011743529), f214);
      f256 = MUL_F(FRAC_CONST(-0.4713967368259979), f254);
      f257 = MUL_F(FRAC_CONST(0.4105245275223569), f212);
      f258 = f255 + f256;
      f259 = f257 - f256;
      f260 = f218 + f216;
      f261 = MUL_C(COEF_CONST(1.4074037375263826), f218);
      f262 = MUL_F(FRAC_CONST(-0.7730104533627369), f260);
      f263 = MUL_F(FRAC_CONST(-0.1386171691990913), f216);
      f264 = f261 + f262;
      f265 = f263 - f262;
      f266 = f222 + f220;
      f267 = MUL_C(COEF_CONST(1.2472250129866711), f222);
      f268 = MUL_F(FRAC_CONST(-0.9569403357322089), f266);
      f269 = MUL_F(FRAC_CONST(-0.6666556584777469), f220);
      f270 = f267 + f268;
      f271 = f269 - f268;
      f272 = f193 - f228;
      f273 = f193 + f228;
      f274 = f195 - f229;
      f275 = f195 + f229;
      f276 = f197 - f234;
      f277 = f197 + f234;
      f278 = f199 - f235;
      f279 = f199 + f235;
      f280 = f201 - f240;
      f281 = f201 + f240;
      f282 = f203 - f241;
      f283 = f203 + f241;
      f284 = f205 - f246;
      f285 = f205 + f246;
      f286 = f207 - f247;
      f287 = f207 + f247;
      f288 = f192 - f252;
      f289 = f192 + f252;
      f290 = f194 - f253;
      f291 = f194 + f253;
      f292 = f196 - f258;
      f293 = f196 + f258;
      f294 = f198 - f259;
      f295 = f198 + f259;
      f296 = f200 - f264;
      f297 = f200 + f264;
      f298 = f202 - f265;
      f299 = f202 + f265;
      f300 = f204 - f270;
      f301 = f204 + f270;
      f302 = f206 - f271;
      f303 = f206 + f271;
      f304 = f275 + f273;
      f305 = MUL_F(FRAC_CONST(-0.9751575901732920), f275);
      f306 = MUL_F(FRAC_CONST(0.9996988186962043), f304);
      f307 = MUL_C(COEF_CONST(1.0242400472191164), f273);
      y[0] = f305 + f306;
      y[31] = f307 - f306;
      f310 = f279 + f277;
      f311 = MUL_F(FRAC_CONST(-0.8700688593994936), f279);
      f312 = MUL_F(FRAC_CONST(0.9924795345987100), f310);
      f313 = MUL_C(COEF_CONST(1.1148902097979263), f277);
      y[2] = f311 + f312;
      y[29] = f313 - f312;
      f316 = f283 + f281;
      f317 = MUL_F(FRAC_CONST(-0.7566008898816587), f283);
      f318 = MUL_F(FRAC_CONST(0.9757021300385286), f316);
      f319 = MUL_C(COEF_CONST(1.1948033701953984), f281);
      y[4] = f317 + f318;
      y[27] = f319 - f318;
      f322 = f287 + f285;
      f323 = MUL_F(FRAC_CONST(-0.6358464401941451), f287);
      f324 = MUL_F(FRAC_CONST(0.9495281805930367), f322);
      f325 = MUL_C(COEF_CONST(1.2632099209919283), f285);
      y[6] = f323 + f324;
      y[25] = f325 - f324;
      f328 = f291 + f289;
      f329 = MUL_F(FRAC_CONST(-0.5089684416985408), f291);
      f330 = MUL_F(FRAC_CONST(0.9142097557035307), f328);
      f331 = MUL_C(COEF_CONST(1.3194510697085207), f289);
      y[8] = f329 + f330;
      y[23] = f331 - f330;
      f334 = f295 + f293;
      f335 = MUL_F(FRAC_CONST(-0.3771887988789273), f295);
      f336 = MUL_F(FRAC_CONST(0.8700869911087114), f334);
      f337 = MUL_C(COEF_CONST(1.3629851833384954), f293);
      y[10] = f335 + f336;
      y[21] = f337 - f336;
      f340 = f299 + f297;
      f341 = MUL_F(FRAC_CONST(-0.2417766217337384), f299);
      f342 = MUL_F(FRAC_CONST(0.8175848131515837), f340);
      f343 = MUL_C(COEF_CONST(1.3933930045694289), f297);
      y[12] = f341 + f342;
      y[19] = f343 - f342;
      f346 = f303 + f301;
      f347 = MUL_F(FRAC_CONST(-0.1040360035527077), f303);
      f348 = MUL_F(FRAC_CONST(0.7572088465064845), f346);
      f349 = MUL_C(COEF_CONST(1.4103816894602612), f301);
      y[14] = f347 + f348;
      y[17] = f349 - f348;
      f352 = f274 + f272;
      f353 = MUL_F(FRAC_CONST(0.0347065382144002), f274);
      f354 = MUL_F(FRAC_CONST(0.6895405447370668), f352);
      f355 = MUL_C(COEF_CONST(1.4137876276885337), f272);
      y[16] = f353 + f354;
      y[15] = f355 - f354;
      f358 = f278 + f276;
      f359 = MUL_F(FRAC_CONST(0.1731148370459795), f278);
      f360 = MUL_F(FRAC_CONST(0.6152315905806268), f358);
      f361 = MUL_C(COEF_CONST(1.4035780182072330), f276);
      y[18] = f359 + f360;
      y[13] = f361 - f360;
      f364 = f282 + f280;
      f365 = MUL_F(FRAC_CONST(0.3098559453626100), f282);
      f366 = MUL_F(FRAC_CONST(0.5349976198870972), f364);
      f367 = MUL_C(COEF_CONST(1.3798511851368043), f280);
      y[20] = f365 + f366;
      y[11] = f367 - f366;
      f370 = f286 + f284;
      f371 = MUL_F(FRAC_CONST(0.4436129715409088), f286);
      f372 = MUL_F(FRAC_CONST(0.4496113296546065), f370);
      f373 = MUL_C(COEF_CONST(1.3428356308501219), f284);
      y[22] = f371 + f372;
      y[9] = f373 - f372;
      f376 = f290 + f288;
      f377 = MUL_F(FRAC_CONST(0.5730977622997509), f290);
      f378 = MUL_F(FRAC_CONST(0.3598950365349881), f376);
      f379 = MUL_C(COEF_CONST(1.2928878353697271), f288);
      y[24] = f377 + f378;
      y[7] = f379 - f378;
      f382 = f294 + f292;
      f383 = MUL_F(FRAC_CONST(0.6970633083205415), f294);
      f384 = MUL_F(FRAC_CONST(0.2667127574748984), f382);
      f385 = MUL_C(COEF_CONST(1.2304888232703382), f292);
      y[26] = f383 + f384;
      y[5] = f385 - f384;
      f388 = f298 + f296;
      f389 = MUL_F(FRAC_CONST(0.8143157536286401), f298);
      f390 = MUL_F(FRAC_CONST(0.1709618887603012), f388);
      f391 = MUL_C(COEF_CONST(1.1562395311492424), f296);
      y[28] = f389 + f390;
      y[3] = f391 - f390;
      f394 = f302 + f300;
      f395 = MUL_F(FRAC_CONST(0.9237258930790228), f302);
      f396 = MUL_F(FRAC_CONST(0.0735645635996674), f394);
      f397 = MUL_C(COEF_CONST(1.0708550202783576), f300);
      y[30] = f395 + f396;
      y[1] = f397 - f396;
  }
  /*}}}*/
  /*{{{*/
  void DST4_32 (real_t *y, real_t *x)
  {
      real_t f0, f1, f2, f3, f4, f5, f6, f7, f8, f9;
      real_t f10, f11, f12, f13, f14, f15, f16, f17, f18, f19;
      real_t f20, f21, f22, f23, f24, f25, f26, f27, f28, f29;
      real_t f30, f31, f32, f33, f34, f35, f36, f37, f38, f39;
      real_t f40, f41, f42, f43, f44, f45, f46, f47, f48, f49;
      real_t f50, f51, f52, f53, f54, f55, f56, f57, f58, f59;
      real_t f60, f61, f62, f63, f64, f65, f66, f67, f68, f69;
      real_t f70, f71, f72, f73, f74, f75, f76, f77, f78, f79;
      real_t f80, f81, f82, f83, f84, f85, f86, f87, f88, f89;
      real_t f90, f91, f92, f93, f94, f95, f96, f97, f98, f99;
      real_t f100, f101, f102, f103, f104, f105, f106, f107, f108, f109;
      real_t f110, f111, f112, f113, f114, f115, f116, f117, f118, f119;
      real_t f120, f121, f122, f123, f124, f125, f126, f127, f128, f129;
      real_t f130, f131, f132, f133, f134, f135, f136, f137, f138, f139;
      real_t f140, f141, f142, f143, f144, f145, f146, f147, f148, f149;
      real_t f150, f151, f152, f153, f154, f155, f156, f157, f158, f159;
      real_t f160, f161, f162, f163, f164, f165, f166, f167, f168, f169;
      real_t f170, f171, f172, f173, f174, f175, f176, f177, f178, f179;
      real_t f180, f181, f182, f183, f184, f185, f186, f187, f188, f189;
      real_t f190, f191, f192, f193, f194, f195, f196, f197, f198, f199;
      real_t f200, f201, f202, f203, f204, f205, f206, f207, f208, f209;
      real_t f210, f211, f212, f213, f214, f215, f216, f217, f218, f219;
      real_t f220, f221, f222, f223, f224, f225, f226, f227, f228, f229;
      real_t f230, f231, f232, f233, f234, f235, f236, f237, f238, f239;
      real_t f240, f241, f242, f243, f244, f245, f246, f247, f248, f249;
      real_t f250, f251, f252, f253, f254, f255, f256, f257, f258, f259;
      real_t f260, f261, f262, f263, f264, f265, f266, f267, f268, f269;
      real_t f270, f271, f272, f273, f274, f275, f276, f277, f278, f279;
      real_t f280, f281, f282, f283, f284, f285, f286, f287, f288, f289;
      real_t f290, f291, f292, f293, f294, f295, f296, f297, f298, f299;
      real_t f300, f301, f302, f303, f304, f305, f306, f307, f308, f309;
      real_t f310, f311, f312, f313, f314, f315, f316, f317, f318, f319;
      real_t f320, f321, f322, f323, f324, f325, f326, f327, f328, f329;
      real_t f330, f331, f332, f333, f334, f335;

      f0 = x[0] - x[1];
      f1 = x[2] - x[1];
      f2 = x[2] - x[3];
      f3 = x[4] - x[3];
      f4 = x[4] - x[5];
      f5 = x[6] - x[5];
      f6 = x[6] - x[7];
      f7 = x[8] - x[7];
      f8 = x[8] - x[9];
      f9 = x[10] - x[9];
      f10 = x[10] - x[11];
      f11 = x[12] - x[11];
      f12 = x[12] - x[13];
      f13 = x[14] - x[13];
      f14 = x[14] - x[15];
      f15 = x[16] - x[15];
      f16 = x[16] - x[17];
      f17 = x[18] - x[17];
      f18 = x[18] - x[19];
      f19 = x[20] - x[19];
      f20 = x[20] - x[21];
      f21 = x[22] - x[21];
      f22 = x[22] - x[23];
      f23 = x[24] - x[23];
      f24 = x[24] - x[25];
      f25 = x[26] - x[25];
      f26 = x[26] - x[27];
      f27 = x[28] - x[27];
      f28 = x[28] - x[29];
      f29 = x[30] - x[29];
      f30 = x[30] - x[31];
      f31 = MUL_F(FRAC_CONST(0.7071067811865476), f15);
      f32 = x[0] - f31;
      f33 = x[0] + f31;
      f34 = f7 + f23;
      f35 = MUL_C(COEF_CONST(1.3065629648763766), f7);
      f36 = MUL_F(FRAC_CONST(-0.9238795325112866), f34);
      f37 = MUL_F(FRAC_CONST(-0.5411961001461967), f23);
      f38 = f35 + f36;
      f39 = f37 - f36;
      f40 = f33 - f39;
      f41 = f33 + f39;
      f42 = f32 - f38;
      f43 = f32 + f38;
      f44 = f11 - f19;
      f45 = f11 + f19;
      f46 = MUL_F(FRAC_CONST(0.7071067811865476), f45);
      f47 = f3 - f46;
      f48 = f3 + f46;
      f49 = MUL_F(FRAC_CONST(0.7071067811865476), f44);
      f50 = f49 - f27;
      f51 = f49 + f27;
      f52 = f51 + f48;
      f53 = MUL_F(FRAC_CONST(-0.7856949583871021), f51);
      f54 = MUL_F(FRAC_CONST(0.9807852804032304), f52);
      f55 = MUL_C(COEF_CONST(1.1758756024193588), f48);
      f56 = f53 + f54;
      f57 = f55 - f54;
      f58 = f50 + f47;
      f59 = MUL_F(FRAC_CONST(-0.2758993792829430), f50);
      f60 = MUL_F(FRAC_CONST(0.8314696123025452), f58);
      f61 = MUL_C(COEF_CONST(1.3870398453221475), f47);
      f62 = f59 + f60;
      f63 = f61 - f60;
      f64 = f41 - f56;
      f65 = f41 + f56;
      f66 = f43 - f62;
      f67 = f43 + f62;
      f68 = f42 - f63;
      f69 = f42 + f63;
      f70 = f40 - f57;
      f71 = f40 + f57;
      f72 = f5 - f9;
      f73 = f5 + f9;
      f74 = f13 - f17;
      f75 = f13 + f17;
      f76 = f21 - f25;
      f77 = f21 + f25;
      f78 = MUL_F(FRAC_CONST(0.7071067811865476), f75);
      f79 = f1 - f78;
      f80 = f1 + f78;
      f81 = f73 + f77;
      f82 = MUL_C(COEF_CONST(1.3065629648763766), f73);
      f83 = MUL_F(FRAC_CONST(-0.9238795325112866), f81);
      f84 = MUL_F(FRAC_CONST(-0.5411961001461967), f77);
      f85 = f82 + f83;
      f86 = f84 - f83;
      f87 = f80 - f86;
      f88 = f80 + f86;
      f89 = f79 - f85;
      f90 = f79 + f85;
      f91 = MUL_F(FRAC_CONST(0.7071067811865476), f74);
      f92 = f29 - f91;
      f93 = f29 + f91;
      f94 = f76 + f72;
      f95 = MUL_C(COEF_CONST(1.3065629648763766), f76);
      f96 = MUL_F(FRAC_CONST(-0.9238795325112866), f94);
      f97 = MUL_F(FRAC_CONST(-0.5411961001461967), f72);
      f98 = f95 + f96;
      f99 = f97 - f96;
      f100 = f93 - f99;
      f101 = f93 + f99;
      f102 = f92 - f98;
      f103 = f92 + f98;
      f104 = f101 + f88;
      f105 = MUL_F(FRAC_CONST(-0.8971675863426361), f101);
      f106 = MUL_F(FRAC_CONST(0.9951847266721968), f104);
      f107 = MUL_C(COEF_CONST(1.0932018670017576), f88);
      f108 = f105 + f106;
      f109 = f107 - f106;
      f110 = f90 - f103;
      f111 = MUL_F(FRAC_CONST(-0.6666556584777466), f103);
      f112 = MUL_F(FRAC_CONST(0.9569403357322089), f110);
      f113 = MUL_C(COEF_CONST(1.2472250129866713), f90);
      f114 = f112 - f111;
      f115 = f113 - f112;
      f116 = f102 + f89;
      f117 = MUL_F(FRAC_CONST(-0.4105245275223571), f102);
      f118 = MUL_F(FRAC_CONST(0.8819212643483549), f116);
      f119 = MUL_C(COEF_CONST(1.3533180011743529), f89);
      f120 = f117 + f118;
      f121 = f119 - f118;
      f122 = f87 - f100;
      f123 = MUL_F(FRAC_CONST(-0.1386171691990915), f100);
      f124 = MUL_F(FRAC_CONST(0.7730104533627370), f122);
      f125 = MUL_C(COEF_CONST(1.4074037375263826), f87);
      f126 = f124 - f123;
      f127 = f125 - f124;
      f128 = f65 - f108;
      f129 = f65 + f108;
      f130 = f67 - f114;
      f131 = f67 + f114;
      f132 = f69 - f120;
      f133 = f69 + f120;
      f134 = f71 - f126;
      f135 = f71 + f126;
      f136 = f70 - f127;
      f137 = f70 + f127;
      f138 = f68 - f121;
      f139 = f68 + f121;
      f140 = f66 - f115;
      f141 = f66 + f115;
      f142 = f64 - f109;
      f143 = f64 + f109;
      f144 = f0 + f30;
      f145 = MUL_C(COEF_CONST(1.0478631305325901), f0);
      f146 = MUL_F(FRAC_CONST(-0.9987954562051724), f144);
      f147 = MUL_F(FRAC_CONST(-0.9497277818777548), f30);
      f148 = f145 + f146;
      f149 = f147 - f146;
      f150 = f4 + f26;
      f151 = MUL_F(FRAC_CONST(1.2130114330978077), f4);
      f152 = MUL_F(FRAC_CONST(-0.9700312531945440), f150);
      f153 = MUL_F(FRAC_CONST(-0.7270510732912803), f26);
      f154 = f151 + f152;
      f155 = f153 - f152;
      f156 = f8 + f22;
      f157 = MUL_C(COEF_CONST(1.3315443865537255), f8);
      f158 = MUL_F(FRAC_CONST(-0.9039892931234433), f156);
      f159 = MUL_F(FRAC_CONST(-0.4764341996931612), f22);
      f160 = f157 + f158;
      f161 = f159 - f158;
      f162 = f12 + f18;
      f163 = MUL_C(COEF_CONST(1.3989068359730781), f12);
      f164 = MUL_F(FRAC_CONST(-0.8032075314806453), f162);
      f165 = MUL_F(FRAC_CONST(-0.2075082269882124), f18);
      f166 = f163 + f164;
      f167 = f165 - f164;
      f168 = f16 + f14;
      f169 = MUL_C(COEF_CONST(1.4125100802019777), f16);
      f170 = MUL_F(FRAC_CONST(-0.6715589548470187), f168);
      f171 = MUL_F(FRAC_CONST(0.0693921705079402), f14);
      f172 = f169 + f170;
      f173 = f171 - f170;
      f174 = f20 + f10;
      f175 = MUL_C(COEF_CONST(1.3718313541934939), f20);
      f176 = MUL_F(FRAC_CONST(-0.5141027441932219), f174);
      f177 = MUL_F(FRAC_CONST(0.3436258658070501), f10);
      f178 = f175 + f176;
      f179 = f177 - f176;
      f180 = f24 + f6;
      f181 = MUL_C(COEF_CONST(1.2784339185752409), f24);
      f182 = MUL_F(FRAC_CONST(-0.3368898533922200), f180);
      f183 = MUL_F(FRAC_CONST(0.6046542117908008), f6);
      f184 = f181 + f182;
      f185 = f183 - f182;
      f186 = f28 + f2;
      f187 = MUL_C(COEF_CONST(1.1359069844201433), f28);
      f188 = MUL_F(FRAC_CONST(-0.1467304744553624), f186);
      f189 = MUL_F(FRAC_CONST(0.8424460355094185), f2);
      f190 = f187 + f188;
      f191 = f189 - f188;
      f192 = f149 - f173;
      f193 = f149 + f173;
      f194 = f148 - f172;
      f195 = f148 + f172;
      f196 = f155 - f179;
      f197 = f155 + f179;
      f198 = f154 - f178;
      f199 = f154 + f178;
      f200 = f161 - f185;
      f201 = f161 + f185;
      f202 = f160 - f184;
      f203 = f160 + f184;
      f204 = f167 - f191;
      f205 = f167 + f191;
      f206 = f166 - f190;
      f207 = f166 + f190;
      f208 = f192 + f194;
      f209 = MUL_C(COEF_CONST(1.1758756024193588), f192);
      f210 = MUL_F(FRAC_CONST(-0.9807852804032304), f208);
      f211 = MUL_F(FRAC_CONST(-0.7856949583871021), f194);
      f212 = f209 + f210;
      f213 = f211 - f210;
      f214 = f196 + f198;
      f215 = MUL_C(COEF_CONST(1.3870398453221475), f196);
      f216 = MUL_F(FRAC_CONST(-0.5555702330196022), f214);
      f217 = MUL_F(FRAC_CONST(0.2758993792829431), f198);
      f218 = f215 + f216;
      f219 = f217 - f216;
      f220 = f200 + f202;
      f221 = MUL_F(FRAC_CONST(0.7856949583871022), f200);
      f222 = MUL_F(FRAC_CONST(0.1950903220161283), f220);
      f223 = MUL_C(COEF_CONST(1.1758756024193586), f202);
      f224 = f221 + f222;
      f225 = f223 - f222;
      f226 = f204 + f206;
      f227 = MUL_F(FRAC_CONST(-0.2758993792829430), f204);
      f228 = MUL_F(FRAC_CONST(0.8314696123025452), f226);
      f229 = MUL_C(COEF_CONST(1.3870398453221475), f206);
      f230 = f227 + f228;
      f231 = f229 - f228;
      f232 = f193 - f201;
      f233 = f193 + f201;
      f234 = f195 - f203;
      f235 = f195 + f203;
      f236 = f197 - f205;
      f237 = f197 + f205;
      f238 = f199 - f207;
      f239 = f199 + f207;
      f240 = f213 - f225;
      f241 = f213 + f225;
      f242 = f212 - f224;
      f243 = f212 + f224;
      f244 = f219 - f231;
      f245 = f219 + f231;
      f246 = f218 - f230;
      f247 = f218 + f230;
      f248 = f232 + f234;
      f249 = MUL_C(COEF_CONST(1.3065629648763766), f232);
      f250 = MUL_F(FRAC_CONST(-0.9238795325112866), f248);
      f251 = MUL_F(FRAC_CONST(-0.5411961001461967), f234);
      f252 = f249 + f250;
      f253 = f251 - f250;
      f254 = f236 + f238;
      f255 = MUL_F(FRAC_CONST(0.5411961001461969), f236);
      f256 = MUL_F(FRAC_CONST(0.3826834323650898), f254);
      f257 = MUL_C(COEF_CONST(1.3065629648763766), f238);
      f258 = f255 + f256;
      f259 = f257 - f256;
      f260 = f240 + f242;
      f261 = MUL_C(COEF_CONST(1.3065629648763766), f240);
      f262 = MUL_F(FRAC_CONST(-0.9238795325112866), f260);
      f263 = MUL_F(FRAC_CONST(-0.5411961001461967), f242);
      f264 = f261 + f262;
      f265 = f263 - f262;
      f266 = f244 + f246;
      f267 = MUL_F(FRAC_CONST(0.5411961001461969), f244);
      f268 = MUL_F(FRAC_CONST(0.3826834323650898), f266);
      f269 = MUL_C(COEF_CONST(1.3065629648763766), f246);
      f270 = f267 + f268;
      f271 = f269 - f268;
      f272 = f233 - f237;
      f273 = f233 + f237;
      f274 = f235 - f239;
      f275 = f235 + f239;
      f276 = f253 - f259;
      f277 = f253 + f259;
      f278 = f252 - f258;
      f279 = f252 + f258;
      f280 = f241 - f245;
      f281 = f241 + f245;
      f282 = f243 - f247;
      f283 = f243 + f247;
      f284 = f265 - f271;
      f285 = f265 + f271;
      f286 = f264 - f270;
      f287 = f264 + f270;
      f288 = f272 - f274;
      f289 = f272 + f274;
      f290 = MUL_F(FRAC_CONST(0.7071067811865474), f288);
      f291 = MUL_F(FRAC_CONST(0.7071067811865474), f289);
      f292 = f276 - f278;
      f293 = f276 + f278;
      f294 = MUL_F(FRAC_CONST(0.7071067811865474), f292);
      f295 = MUL_F(FRAC_CONST(0.7071067811865474), f293);
      f296 = f280 - f282;
      f297 = f280 + f282;
      f298 = MUL_F(FRAC_CONST(0.7071067811865474), f296);
      f299 = MUL_F(FRAC_CONST(0.7071067811865474), f297);
      f300 = f284 - f286;
      f301 = f284 + f286;
      f302 = MUL_F(FRAC_CONST(0.7071067811865474), f300);
      f303 = MUL_F(FRAC_CONST(0.7071067811865474), f301);
      f304 = f129 - f273;
      f305 = f129 + f273;
      f306 = f131 - f281;
      f307 = f131 + f281;
      f308 = f133 - f285;
      f309 = f133 + f285;
      f310 = f135 - f277;
      f311 = f135 + f277;
      f312 = f137 - f295;
      f313 = f137 + f295;
      f314 = f139 - f303;
      f315 = f139 + f303;
      f316 = f141 - f299;
      f317 = f141 + f299;
      f318 = f143 - f291;
      f319 = f143 + f291;
      f320 = f142 - f290;
      f321 = f142 + f290;
      f322 = f140 - f298;
      f323 = f140 + f298;
      f324 = f138 - f302;
      f325 = f138 + f302;
      f326 = f136 - f294;
      f327 = f136 + f294;
      f328 = f134 - f279;
      f329 = f134 + f279;
      f330 = f132 - f287;
      f331 = f132 + f287;
      f332 = f130 - f283;
      f333 = f130 + f283;
      f334 = f128 - f275;
      f335 = f128 + f275;
      y[31] = MUL_F(FRAC_CONST(0.5001506360206510), f305);
      y[30] = MUL_F(FRAC_CONST(0.5013584524464084), f307);
      y[29] = MUL_F(FRAC_CONST(0.5037887256810443), f309);
      y[28] = MUL_F(FRAC_CONST(0.5074711720725553), f311);
      y[27] = MUL_F(FRAC_CONST(0.5124514794082247), f313);
      y[26] = MUL_F(FRAC_CONST(0.5187927131053328), f315);
      y[25] = MUL_F(FRAC_CONST(0.5265773151542700), f317);
      y[24] = MUL_F(FRAC_CONST(0.5359098169079920), f319);
      y[23] = MUL_F(FRAC_CONST(0.5469204379855088), f321);
      y[22] = MUL_F(FRAC_CONST(0.5597698129470802), f323);
      y[21] = MUL_F(FRAC_CONST(0.5746551840326600), f325);
      y[20] = MUL_F(FRAC_CONST(0.5918185358574165), f327);
      y[19] = MUL_F(FRAC_CONST(0.6115573478825099), f329);
      y[18] = MUL_F(FRAC_CONST(0.6342389366884031), f331);
      y[17] = MUL_F(FRAC_CONST(0.6603198078137061), f333);
      y[16] = MUL_F(FRAC_CONST(0.6903721282002123), f335);
      y[15] = MUL_F(FRAC_CONST(0.7251205223771985), f334);
      y[14] = MUL_F(FRAC_CONST(0.7654941649730891), f332);
      y[13] = MUL_F(FRAC_CONST(0.8127020908144905), f330);
      y[12] = MUL_F(FRAC_CONST(0.8683447152233481), f328);
      y[11] = MUL_F(FRAC_CONST(0.9345835970364075), f326);
      y[10] = MUL_C(COEF_CONST(1.0144082649970547), f324);
      y[9] = MUL_C(COEF_CONST(1.1120716205797176), f322);
      y[8] = MUL_C(COEF_CONST(1.2338327379765710), f320);
      y[7] = MUL_C(COEF_CONST(1.3892939586328277), f318);
      y[6] = MUL_C(COEF_CONST(1.5939722833856311), f316);
      y[5] = MUL_C(COEF_CONST(1.8746759800084078), f314);
      y[4] = MUL_C(COEF_CONST(2.2820500680051619), f312);
      y[3] = MUL_C(COEF_CONST(2.9246284281582162), f310);
      y[2] = MUL_C(COEF_CONST(4.0846110781292477), f308);
      y[1] = MUL_C(COEF_CONST(6.7967507116736332), f306);
      y[0] = MUL_R(REAL_CONST(20.3738781672314530), f304);
  }
  /*}}}*/

  #ifdef SBR_LOW_POWER
    /*{{{*/
    static void auto_correlation (sbr_info *sbr, acorr_coef *ac,
                                 qmf_t buffer[MAX_NTSRHFG][64],
                                 uint8_t bd, uint8_t len)
    {
        real_t r01 = 0, r02 = 0, r11 = 0;
        int8_t j;
        uint8_t offset = sbr->tHFAdj;
        const real_t rel = 1 / (1 + 1e-6f);


        for (j = offset; j < len + offset; j++)
        {
            r01 += QMF_RE(buffer[j][bd]) * QMF_RE(buffer[j-1][bd]);
            r02 += QMF_RE(buffer[j][bd]) * QMF_RE(buffer[j-2][bd]);
            r11 += QMF_RE(buffer[j-1][bd]) * QMF_RE(buffer[j-1][bd]);
        }
        RE(ac->r12) = r01 -
            QMF_RE(buffer[len+offset-1][bd]) * QMF_RE(buffer[len+offset-2][bd]) +
            QMF_RE(buffer[offset-1][bd]) * QMF_RE(buffer[offset-2][bd]);
        RE(ac->r22) = r11 -
            QMF_RE(buffer[len+offset-2][bd]) * QMF_RE(buffer[len+offset-2][bd]) +
            QMF_RE(buffer[offset-2][bd]) * QMF_RE(buffer[offset-2][bd]);
        RE(ac->r01) = r01;
        RE(ac->r02) = r02;
        RE(ac->r11) = r11;

        ac->det = MUL_R(RE(ac->r11), RE(ac->r22)) - MUL_F(MUL_R(RE(ac->r12), RE(ac->r12)), rel);
    }
    /*}}}*/
    /*{{{*/
    static void calc_prediction_coef_lp (sbr_info *sbr, qmf_t Xlow[MAX_NTSRHFG][64],
                                        complex_t *alpha_0, complex_t *alpha_1, real_t *rxx)
    {
        uint8_t k;
        real_t tmp;
        acorr_coef ac;

        for (k = 1; k < sbr->f_master[0]; k++)
        {
            auto_correlation(sbr, &ac, Xlow, k, sbr->numTimeSlotsRate + 6);

            if (ac.det == 0)
            {
                RE(alpha_0[k]) = 0;
                RE(alpha_1[k]) = 0;
            } else {
                tmp = MUL_R(RE(ac.r01), RE(ac.r22)) - MUL_R(RE(ac.r12), RE(ac.r02));
                RE(alpha_0[k]) = DIV_R(tmp, (-ac.det));

                tmp = MUL_R(RE(ac.r01), RE(ac.r12)) - MUL_R(RE(ac.r02), RE(ac.r11));
                RE(alpha_1[k]) = DIV_R(tmp, ac.det);
            }

            if ((RE(alpha_0[k]) >= REAL_CONST(4)) || (RE(alpha_1[k]) >= REAL_CONST(4)))
            {
                RE(alpha_0[k]) = REAL_CONST(0);
                RE(alpha_1[k]) = REAL_CONST(0);
            }

            /* reflection coefficient */
            if (RE(ac.r11) == 0)
            {
                rxx[k] = COEF_CONST(0.0);
            } else {
                rxx[k] = DIV_C(RE(ac.r01), RE(ac.r11));
                rxx[k] = -rxx[k];
                if (rxx[k] > COEF_CONST(1.0)) rxx[k] = COEF_CONST(1.0);
                if (rxx[k] < COEF_CONST(-1.0)) rxx[k] = COEF_CONST(-1.0);
            }
        }
    }
    /*}}}*/
    /*{{{*/
    static void calc_aliasing_degree (sbr_info *sbr, real_t *rxx, real_t *deg)
    {
        uint8_t k;

        rxx[0] = COEF_CONST(0.0);
        deg[1] = COEF_CONST(0.0);

        for (k = 2; k < sbr->k0; k++)
        {
            deg[k] = 0.0;

            if ((k % 2 == 0) && (rxx[k] < COEF_CONST(0.0)))
            {
                if (rxx[k-1] < 0.0)
                {
                    deg[k] = COEF_CONST(1.0);

                    if (rxx[k-2] > COEF_CONST(0.0))
                    {
                        deg[k-1] = COEF_CONST(1.0) - MUL_C(rxx[k-1], rxx[k-1]);
                    }
                } else if (rxx[k-2] > COEF_CONST(0.0)) {
                    deg[k] = COEF_CONST(1.0) - MUL_C(rxx[k-1], rxx[k-1]);
                }
            }

            if ((k % 2 == 1) && (rxx[k] > COEF_CONST(0.0)))
            {
                if (rxx[k-1] > COEF_CONST(0.0))
                {
                    deg[k] = COEF_CONST(1.0);

                    if (rxx[k-2] < COEF_CONST(0.0))
                    {
                        deg[k-1] = COEF_CONST(1.0) - MUL_C(rxx[k-1], rxx[k-1]);
                    }
                } else if (rxx[k-2] < COEF_CONST(0.0)) {
                    deg[k] = COEF_CONST(1.0) - MUL_C(rxx[k-1], rxx[k-1]);
                }
            }
        }
    }
    /*}}}*/
    /*{{{*/
    static void calc_gain_groups(sbr_info *sbr, sbr_hfadj_info *adj, real_t *deg, uint8_t ch)
    {
        uint8_t l, k, i;
        uint8_t grouping;
        uint8_t S_mapped;

        for (l = 0; l < sbr->L_E[ch]; l++)
        {
            uint8_t current_res_band = 0;
            i = 0;
            grouping = 0;

            S_mapped = get_S_mapped(sbr, ch, l, current_res_band);

            for (k = sbr->kx; k < sbr->kx + sbr->M - 1; k++)
            {
                if (k == sbr->f_table_res[sbr->f[ch][l]][current_res_band+1])
                {
                    /* step to next resolution band */
                    current_res_band++;

                    S_mapped = get_S_mapped(sbr, ch, l, current_res_band);
                }

                if (deg[k + 1] && S_mapped == 0)
                {
                    if (grouping == 0)
                    {
                        sbr->f_group[l][i] = k;
                        grouping = 1;
                        i++;
                    }
                } else {
                    if (grouping)
                    {
                        if (S_mapped)
                        {
                            sbr->f_group[l][i] = k;
                        } else {
                            sbr->f_group[l][i] = k + 1;
                        }
                        grouping = 0;
                        i++;
                    }
                }
            }

            if (grouping)
            {
                sbr->f_group[l][i] = sbr->kx + sbr->M;
                i++;
            }

            sbr->N_G[l] = (uint8_t)(i >> 1);
        }
    }
    /*}}}*/
    /*{{{*/
    static void aliasing_reduction(sbr_info *sbr, sbr_hfadj_info *adj, real_t *deg, uint8_t ch)
    {
        uint8_t l, k, m;
        real_t E_total, E_total_est, G_target, acc;

        for (l = 0; l < sbr->L_E[ch]; l++)
        {
            for (k = 0; k < sbr->N_G[l]; k++)
            {
                E_total_est = E_total = 0;

                for (m = sbr->f_group[l][k<<1]; m < sbr->f_group[l][(k<<1) + 1]; m++)
                {
                    /* E_curr: integer */
                    /* G_lim_boost: fixed point */
                    /* E_total_est: integer */
                    /* E_total: integer */
                    E_total_est += sbr->E_curr[ch][m-sbr->kx][l];
                    E_total += sbr->E_curr[ch][m-sbr->kx][l] * adj->G_lim_boost[l][m-sbr->kx];
                }

                /* G_target: fixed point */
                if ((E_total_est + EPS) == 0)
                {
                    G_target = 0;
                } else {
                    G_target = E_total / (E_total_est + EPS);
                }
                acc = 0;

                for (m = sbr->f_group[l][(k<<1)]; m < sbr->f_group[l][(k<<1) + 1]; m++)
                {
                    real_t alpha;

                    /* alpha: (COEF) fixed point */
                    if (m < sbr->kx + sbr->M - 1)
                    {
                        alpha = max(deg[m], deg[m + 1]);
                    } else {
                        alpha = deg[m];
                    }

                    adj->G_lim_boost[l][m-sbr->kx] = MUL_C(alpha, G_target) +
                        MUL_C((COEF_CONST(1)-alpha), adj->G_lim_boost[l][m-sbr->kx]);

                    /* acc: integer */
                    acc += adj->G_lim_boost[l][m-sbr->kx] * sbr->E_curr[ch][m-sbr->kx][l];
                }

                /* acc: fixed point */
                if (acc + EPS == 0)
                {
                    acc = 0;
                } else {
                    acc = E_total / (acc + EPS);
                }
                for(m = sbr->f_group[l][(k<<1)]; m < sbr->f_group[l][(k<<1) + 1]; m++)
                {
                    adj->G_lim_boost[l][m-sbr->kx] = acc * adj->G_lim_boost[l][m-sbr->kx];
                }
            }
        }

        for (l = 0; l < sbr->L_E[ch]; l++)
        {
            for (k = 0; k < sbr->N_L[sbr->bs_limiter_bands]; k++)
            {
                for (m = sbr->f_table_lim[sbr->bs_limiter_bands][k];
                     m < sbr->f_table_lim[sbr->bs_limiter_bands][k+1]; m++)
                {
                     adj->G_lim_boost[l][m] = sqrt(adj->G_lim_boost[l][m]);
                }
            }
        }
    }
    /*}}}*/
    /*{{{*/
    void sbr_qmf_synthesis_32 (sbr_info *sbr, qmfs_info *qmfs, qmf_t X[MAX_NTSRHFG][64],
                              real_t *output)
    {
        ALIGN real_t x[16];
        ALIGN real_t y[16];
        int32_t n, k, out = 0;
        uint8_t l;

        /* qmf subsample l */
        for (l = 0; l < sbr->numTimeSlotsRate; l++)
        {
            /* shift buffers */
            /* we are not shifting v, it is a double ringbuffer */
            //memmove(qmfs->v + 64, qmfs->v, (640-64)*sizeof(real_t));

            /* calculate 64 samples */
            for (k = 0; k < 16; k++)
            {
                y[k] = (QMF_RE(X[l][k]) - QMF_RE(X[l][31 - k])) / 32.0;
                x[k] = (QMF_RE(X[l][k]) + QMF_RE(X[l][31 - k])) / 32.0;
            }

            /* even n samples */
            DCT2_16_unscaled(x, x);
            /* odd n samples */
            DCT4_16(y, y);

            for (n = 8; n < 24; n++)
            {
                qmfs->v[qmfs->v_index + n*2] = qmfs->v[qmfs->v_index + 640 + n*2] = x[n-8];
                qmfs->v[qmfs->v_index + n*2+1] = qmfs->v[qmfs->v_index + 640 + n*2+1] = y[n-8];
            }
            for (n = 0; n < 16; n++)
            {
                qmfs->v[qmfs->v_index + n] = qmfs->v[qmfs->v_index + 640 + n] = qmfs->v[qmfs->v_index + 32-n];
            }
            qmfs->v[qmfs->v_index + 48] = qmfs->v[qmfs->v_index + 640 + 48] = 0;
            for (n = 1; n < 16; n++)
            {
                qmfs->v[qmfs->v_index + 48+n] = qmfs->v[qmfs->v_index + 640 + 48+n] = -qmfs->v[qmfs->v_index + 48-n];
            }

            /* calculate 32 output samples and window */
            for (k = 0; k < 32; k++)
            {
                output[out++] = MUL_F(qmfs->v[qmfs->v_index + k], qmf_c[2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 96 + k], qmf_c[64 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 128 + k], qmf_c[128 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 224 + k], qmf_c[192 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 256 + k], qmf_c[256 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 352 + k], qmf_c[320 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 384 + k], qmf_c[384 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 480 + k], qmf_c[448 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 512 + k], qmf_c[512 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 608 + k], qmf_c[576 + 2*k]);
            }

            /* update the ringbuffer index */
            qmfs->v_index -= 64;
            if (qmfs->v_index < 0)
                qmfs->v_index = (640-64);
        }
    }
    /*}}}*/
    /*{{{*/
    void sbr_qmf_synthesis_64 (sbr_info *sbr, qmfs_info *qmfs, qmf_t X[MAX_NTSRHFG][64],
                              real_t *output)
    {
        ALIGN real_t x[64];
        ALIGN real_t y[64];
        int32_t n, k, out = 0;
        uint8_t l;


        /* qmf subsample l */
        for (l = 0; l < sbr->numTimeSlotsRate; l++)
        {
            /* shift buffers */
            /* we are not shifting v, it is a double ringbuffer */
            //memmove(qmfs->v + 128, qmfs->v, (1280-128)*sizeof(real_t));

            /* calculate 128 samples */
            for (k = 0; k < 32; k++)
            {
                y[k] = (QMF_RE(X[l][k]) - QMF_RE(X[l][63 - k])) / 32.0;
                x[k] = (QMF_RE(X[l][k]) + QMF_RE(X[l][63 - k])) / 32.0;
            }

            /* even n samples */
            DCT2_32_unscaled(x, x);
            /* odd n samples */
            DCT4_32(y, y);

            for (n = 16; n < 48; n++)
            {
                qmfs->v[qmfs->v_index + n*2]   = qmfs->v[qmfs->v_index + 1280 + n*2]   = x[n-16];
                qmfs->v[qmfs->v_index + n*2+1] = qmfs->v[qmfs->v_index + 1280 + n*2+1] = y[n-16];
            }
            for (n = 0; n < 32; n++)
            {
                qmfs->v[qmfs->v_index + n] = qmfs->v[qmfs->v_index + 1280 + n] = qmfs->v[qmfs->v_index + 64-n];
            }
            qmfs->v[qmfs->v_index + 96] = qmfs->v[qmfs->v_index + 1280 + 96] = 0;
            for (n = 1; n < 32; n++)
            {
                qmfs->v[qmfs->v_index + 96+n] = qmfs->v[qmfs->v_index + 1280 + 96+n] = -qmfs->v[qmfs->v_index + 96-n];
            }

            /* calculate 64 output samples and window */
            for (k = 0; k < 64; k++)
            {
                output[out++] = MUL_F(qmfs->v[qmfs->v_index + k], qmf_c[k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 192 + k], qmf_c[64 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 256 + k], qmf_c[128 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 256 + 192 + k], qmf_c[128 + 64 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 512 + k], qmf_c[256 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 512 + 192 + k], qmf_c[256 + 64 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 768 + k], qmf_c[384 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 768 + 192 + k], qmf_c[384 + 64 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 1024 + k], qmf_c[512 + k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 1024 + 192 + k], qmf_c[512 + 64 + k]);
            }

            /* update the ringbuffer index */
            qmfs->v_index -= 128;
            if (qmfs->v_index < 0)
                qmfs->v_index = (1280-128);
        }
    }
    /*}}}*/
    /*{{{*/
    void DCT2_16_unscaled (real_t *y, real_t *x)
    {
        real_t f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10;
        real_t f11, f12, f13, f14, f15, f16, f17, f18, f19, f20;
        real_t f21, f22, f23, f24, f25, f26, f27, f28, f31, f32;
        real_t f33, f34, f37, f38, f39, f40, f41, f42, f43, f44;
        real_t f45, f46, f47, f48, f49, f51, f53, f54, f57, f58;
        real_t f59, f60, f61, f62, f63, f64, f65, f66, f67, f68;
        real_t f69, f70, f71, f72, f73, f74, f75, f76, f77, f78;
        real_t f79, f80, f81, f82, f83, f84, f85, f86, f87, f88;
        real_t f89, f90, f91, f92, f95, f96, f97, f98, f101, f102;
        real_t f103, f104, f107, f108, f109, f110;

        f0 = x[0] - x[15];
        f1 = x[0] + x[15];
        f2 = x[1] - x[14];
        f3 = x[1] + x[14];
        f4 = x[2] - x[13];
        f5 = x[2] + x[13];
        f6 = x[3] - x[12];
        f7 = x[3] + x[12];
        f8 = x[4] - x[11];
        f9 = x[4] + x[11];
        f10 = x[5] - x[10];
        f11 = x[5] + x[10];
        f12 = x[6] - x[9];
        f13 = x[6] + x[9];
        f14 = x[7] - x[8];
        f15 = x[7] + x[8];
        f16 = f1 - f15;
        f17 = f1 + f15;
        f18 = f3 - f13;
        f19 = f3 + f13;
        f20 = f5 - f11;
        f21 = f5 + f11;
        f22 = f7 - f9;
        f23 = f7 + f9;
        f24 = f17 - f23;
        f25 = f17 + f23;
        f26 = f19 - f21;
        f27 = f19 + f21;
        f28 = f25 - f27;
        y[0] = f25 + f27;
        y[8] = MUL_F(f28, FRAC_CONST(0.7071067811865476));
        f31 = f24 + f26;
        f32 = MUL_C(f24, COEF_CONST(1.3065629648763766));
        f33 = MUL_F(f31, FRAC_CONST(-0.9238795325112866));
        f34 = MUL_F(f26, FRAC_CONST(-0.5411961001461967));
        y[12] = f32 + f33;
        y[4] = f34 - f33;
        f37 = f16 + f22;
        f38 = MUL_C(f16, COEF_CONST(1.1758756024193588));
        f39 = MUL_F(f37, FRAC_CONST(-0.9807852804032304));
        f40 = MUL_F(f22, FRAC_CONST(-0.7856949583871021));
        f41 = f38 + f39;
        f42 = f40 - f39;
        f43 = f18 + f20;
        f44 = MUL_C(f18, COEF_CONST(1.3870398453221473));
        f45 = MUL_F(f43, FRAC_CONST(-0.8314696123025455));
        f46 = MUL_F(f20, FRAC_CONST(-0.2758993792829436));
        f47 = f44 + f45;
        f48 = f46 - f45;
        f49 = f42 - f48;
        y[2] = f42 + f48;
        f51 = MUL_F(f49, FRAC_CONST(0.7071067811865476));
        y[14] = f41 - f47;
        f53 = f41 + f47;
        f54 = MUL_F(f53, FRAC_CONST(0.7071067811865476));
        y[10] = f51 - f54;
        y[6] = f51 + f54;
        f57 = f2 - f4;
        f58 = f2 + f4;
        f59 = f6 - f8;
        f60 = f6 + f8;
        f61 = f10 - f12;
        f62 = f10 + f12;
        f63 = MUL_F(f60, FRAC_CONST(0.7071067811865476));
        f64 = f0 - f63;
        f65 = f0 + f63;
        f66 = f58 + f62;
        f67 = MUL_C(f58, COEF_CONST(1.3065629648763766));
        f68 = MUL_F(f66, FRAC_CONST(-0.9238795325112866));
        f69 = MUL_F(f62, FRAC_CONST(-0.5411961001461967));
        f70 = f67 + f68;
        f71 = f69 - f68;
        f72 = f65 - f71;
        f73 = f65 + f71;
        f74 = f64 - f70;
        f75 = f64 + f70;
        f76 = MUL_F(f59, FRAC_CONST(0.7071067811865476));
        f77 = f14 - f76;
        f78 = f14 + f76;
        f79 = f61 + f57;
        f80 = MUL_C(f61, COEF_CONST(1.3065629648763766));
        f81 = MUL_F(f79, FRAC_CONST(-0.9238795325112866));
        f82 = MUL_F(f57, FRAC_CONST(-0.5411961001461967));
        f83 = f80 + f81;
        f84 = f82 - f81;
        f85 = f78 - f84;
        f86 = f78 + f84;
        f87 = f77 - f83;
        f88 = f77 + f83;
        f89 = f86 + f73;
        f90 = MUL_F(f86, FRAC_CONST(-0.8971675863426361));
        f91 = MUL_F(f89, FRAC_CONST(0.9951847266721968));
        f92 = MUL_C(f73, COEF_CONST(1.0932018670017576));
        y[1] = f90 + f91;
        y[15] = f92 - f91;
        f95 = f75 - f88;
        f96 = MUL_F(f88, FRAC_CONST(-0.6666556584777466));
        f97 = MUL_F(f95, FRAC_CONST(0.9569403357322089));
        f98 = MUL_C(f75, COEF_CONST(1.2472250129866713));
        y[3] = f97 - f96;
        y[13] = f98 - f97;
        f101 = f87 + f74;
        f102 = MUL_F(f87, FRAC_CONST(-0.4105245275223571));
        f103 = MUL_F(f101, FRAC_CONST(0.8819212643483549));
        f104 = MUL_C(f74, COEF_CONST(1.3533180011743529));
        y[5] = f102 + f103;
        y[11] = f104 - f103;
        f107 = f72 - f85;
        f108 = MUL_F(f85, FRAC_CONST(-0.1386171691990915));
        f109 = MUL_F(f107, FRAC_CONST(0.7730104533627370));
        f110 = MUL_C(f72, COEF_CONST(1.4074037375263826));
        y[7] = f109 - f108;
        y[9] = f110 - f109;
    }
    /*}}}*/
    /*{{{*/
    void DCT4_16 (real_t *y, real_t *x)
    {
        real_t f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10;
        real_t f11, f12, f13, f14, f15, f16, f17, f18, f19, f20;
        real_t f21, f22, f23, f24, f25, f26, f27, f28, f29, f30;
        real_t f31, f32, f33, f34, f35, f36, f37, f38, f39, f40;
        real_t f41, f42, f43, f44, f45, f46, f47, f48, f49, f50;
        real_t f51, f52, f53, f54, f55, f56, f57, f58, f59, f60;
        real_t f61, f62, f63, f64, f65, f66, f67, f68, f69, f70;
        real_t f71, f72, f73, f74, f75, f76, f77, f78, f79, f80;
        real_t f81, f82, f83, f84, f85, f86, f87, f88, f89, f90;
        real_t f91, f92, f93, f94, f95, f96, f97, f98, f99, f100;
        real_t f101, f102, f103, f104, f105, f106, f107, f108, f109, f110;
        real_t f111, f112, f113, f114, f115, f116, f117, f118, f119, f120;
        real_t f121, f122, f123, f124, f125, f126, f127, f128, f130, f132;
        real_t f134, f136, f138, f140, f142, f144, f145, f148, f149, f152;
        real_t f153, f156, f157;

        f0 = x[0] + x[15];
        f1 = MUL_C(COEF_CONST(1.0478631305325901), x[0]);
        f2 = MUL_F(FRAC_CONST(-0.9987954562051724), f0);
        f3 = MUL_F(FRAC_CONST(-0.9497277818777548), x[15]);
        f4 = f1 + f2;
        f5 = f3 - f2;
        f6 = x[2] + x[13];
        f7 = MUL_C(COEF_CONST(1.2130114330978077), x[2]);
        f8 = MUL_F(FRAC_CONST(-0.9700312531945440), f6);
        f9 = MUL_F(FRAC_CONST(-0.7270510732912803), x[13]);
        f10 = f7 + f8;
        f11 = f9 - f8;
        f12 = x[4] + x[11];
        f13 = MUL_C(COEF_CONST(1.3315443865537255), x[4]);
        f14 = MUL_F(FRAC_CONST(-0.9039892931234433), f12);
        f15 = MUL_F(FRAC_CONST(-0.4764341996931612), x[11]);
        f16 = f13 + f14;
        f17 = f15 - f14;
        f18 = x[6] + x[9];
        f19 = MUL_C(COEF_CONST(1.3989068359730781), x[6]);
        f20 = MUL_F(FRAC_CONST(-0.8032075314806453), f18);
        f21 = MUL_F(FRAC_CONST(-0.2075082269882124), x[9]);
        f22 = f19 + f20;
        f23 = f21 - f20;
        f24 = x[8] + x[7];
        f25 = MUL_C(COEF_CONST(1.4125100802019777), x[8]);
        f26 = MUL_F(FRAC_CONST(-0.6715589548470187), f24);
        f27 = MUL_F(FRAC_CONST(0.0693921705079402), x[7]);
        f28 = f25 + f26;
        f29 = f27 - f26;
        f30 = x[10] + x[5];
        f31 = MUL_C(COEF_CONST(1.3718313541934939), x[10]);
        f32 = MUL_F(FRAC_CONST(-0.5141027441932219), f30);
        f33 = MUL_F(FRAC_CONST(0.3436258658070501), x[5]);
        f34 = f31 + f32;
        f35 = f33 - f32;
        f36 = x[12] + x[3];
        f37 = MUL_C(COEF_CONST(1.2784339185752409), x[12]);
        f38 = MUL_F(FRAC_CONST(-0.3368898533922200), f36);
        f39 = MUL_F(FRAC_CONST(0.6046542117908008), x[3]);
        f40 = f37 + f38;
        f41 = f39 - f38;
        f42 = x[14] + x[1];
        f43 = MUL_C(COEF_CONST(1.1359069844201433), x[14]);
        f44 = MUL_F(FRAC_CONST(-0.1467304744553624), f42);
        f45 = MUL_F(FRAC_CONST(0.8424460355094185), x[1]);
        f46 = f43 + f44;
        f47 = f45 - f44;
        f48 = f5 - f29;
        f49 = f5 + f29;
        f50 = f4 - f28;
        f51 = f4 + f28;
        f52 = f11 - f35;
        f53 = f11 + f35;
        f54 = f10 - f34;
        f55 = f10 + f34;
        f56 = f17 - f41;
        f57 = f17 + f41;
        f58 = f16 - f40;
        f59 = f16 + f40;
        f60 = f23 - f47;
        f61 = f23 + f47;
        f62 = f22 - f46;
        f63 = f22 + f46;
        f64 = f48 + f50;
        f65 = MUL_C(COEF_CONST(1.1758756024193588), f48);
        f66 = MUL_F(FRAC_CONST(-0.9807852804032304), f64);
        f67 = MUL_F(FRAC_CONST(-0.7856949583871021), f50);
        f68 = f65 + f66;
        f69 = f67 - f66;
        f70 = f52 + f54;
        f71 = MUL_C(COEF_CONST(1.3870398453221475), f52);
        f72 = MUL_F(FRAC_CONST(-0.5555702330196022), f70);
        f73 = MUL_F(FRAC_CONST(0.2758993792829431), f54);
        f74 = f71 + f72;
        f75 = f73 - f72;
        f76 = f56 + f58;
        f77 = MUL_F(FRAC_CONST(0.7856949583871022), f56);
        f78 = MUL_F(FRAC_CONST(0.1950903220161283), f76);
        f79 = MUL_C(COEF_CONST(1.1758756024193586), f58);
        f80 = f77 + f78;
        f81 = f79 - f78;
        f82 = f60 + f62;
        f83 = MUL_F(FRAC_CONST(-0.2758993792829430), f60);
        f84 = MUL_F(FRAC_CONST(0.8314696123025452), f82);
        f85 = MUL_C(COEF_CONST(1.3870398453221475), f62);
        f86 = f83 + f84;
        f87 = f85 - f84;
        f88 = f49 - f57;
        f89 = f49 + f57;
        f90 = f51 - f59;
        f91 = f51 + f59;
        f92 = f53 - f61;
        f93 = f53 + f61;
        f94 = f55 - f63;
        f95 = f55 + f63;
        f96 = f69 - f81;
        f97 = f69 + f81;
        f98 = f68 - f80;
        f99 = f68 + f80;
        f100 = f75 - f87;
        f101 = f75 + f87;
        f102 = f74 - f86;
        f103 = f74 + f86;
        f104 = f88 + f90;
        f105 = MUL_C(COEF_CONST(1.3065629648763766), f88);
        f106 = MUL_F(FRAC_CONST(-0.9238795325112866), f104);
        f107 = MUL_F(FRAC_CONST(-0.5411961001461967), f90);
        f108 = f105 + f106;
        f109 = f107 - f106;
        f110 = f92 + f94;
        f111 = MUL_F(FRAC_CONST(0.5411961001461969), f92);
        f112 = MUL_F(FRAC_CONST(0.3826834323650898), f110);
        f113 = MUL_C(COEF_CONST(1.3065629648763766), f94);
        f114 = f111 + f112;
        f115 = f113 - f112;
        f116 = f96 + f98;
        f117 = MUL_C(COEF_CONST(1.3065629648763766), f96);
        f118 = MUL_F(FRAC_CONST(-0.9238795325112866), f116);
        f119 = MUL_F(FRAC_CONST(-0.5411961001461967), f98);
        f120 = f117 + f118;
        f121 = f119 - f118;
        f122 = f100 + f102;
        f123 = MUL_F(FRAC_CONST(0.5411961001461969), f100);
        f124 = MUL_F(FRAC_CONST(0.3826834323650898), f122);
        f125 = MUL_C(COEF_CONST(1.3065629648763766), f102);
        f126 = f123 + f124;
        f127 = f125 - f124;
        f128 = f89 - f93;
        y[0] = f89 + f93;
        f130 = f91 - f95;
        y[15] = f91 + f95;
        f132 = f109 - f115;
        y[3] = f109 + f115;
        f134 = f108 - f114;
        y[12] = f108 + f114;
        f136 = f97 - f101;
        y[1] = f97 + f101;
        f138 = f99 - f103;
        y[14] = f99 + f103;
        f140 = f121 - f127;
        y[2] = f121 + f127;
        f142 = f120 - f126;
        y[13] = f120 + f126;
        f144 = f128 - f130;
        f145 = f128 + f130;
        y[8] = MUL_F(FRAC_CONST(0.7071067811865474), f144);
        y[7] = MUL_F(FRAC_CONST(0.7071067811865474), f145);
        f148 = f132 - f134;
        f149 = f132 + f134;
        y[11] = MUL_F(FRAC_CONST(0.7071067811865474), f148);
        y[4] = MUL_F(FRAC_CONST(0.7071067811865474), f149);
        f152 = f136 - f138;
        f153 = f136 + f138;
        y[9] = MUL_F(FRAC_CONST(0.7071067811865474), f152);
        y[6] = MUL_F(FRAC_CONST(0.7071067811865474), f153);
        f156 = f140 - f142;
        f157 = f140 + f142;
        y[10] = MUL_F(FRAC_CONST(0.7071067811865474), f156);
        y[5] = MUL_F(FRAC_CONST(0.7071067811865474), f157);
    }
    /*}}}*/
    /*{{{*/
    void DCT3_32_unscaled (real_t *y, real_t *x)
    {
        real_t f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10;
        real_t f11, f12, f13, f14, f15, f16, f17, f18, f19, f20;
        real_t f21, f22, f23, f24, f25, f26, f27, f28, f29, f30;
        real_t f31, f32, f33, f34, f35, f36, f37, f38, f39, f40;
        real_t f41, f42, f43, f44, f45, f46, f47, f48, f49, f50;
        real_t f51, f52, f53, f54, f55, f56, f57, f58, f59, f60;
        real_t f61, f62, f63, f64, f65, f66, f67, f68, f69, f70;
        real_t f71, f72, f73, f74, f75, f76, f77, f78, f79, f80;
        real_t f81, f82, f83, f84, f85, f86, f87, f88, f89, f90;
        real_t f91, f92, f93, f94, f95, f96, f97, f98, f99, f100;
        real_t f101, f102, f103, f104, f105, f106, f107, f108, f109, f110;
        real_t f111, f112, f113, f114, f115, f116, f117, f118, f119, f120;
        real_t f121, f122, f123, f124, f125, f126, f127, f128, f129, f130;
        real_t f131, f132, f133, f134, f135, f136, f137, f138, f139, f140;
        real_t f141, f142, f143, f144, f145, f146, f147, f148, f149, f150;
        real_t f151, f152, f153, f154, f155, f156, f157, f158, f159, f160;
        real_t f161, f162, f163, f164, f165, f166, f167, f168, f169, f170;
        real_t f171, f172, f173, f174, f175, f176, f177, f178, f179, f180;
        real_t f181, f182, f183, f184, f185, f186, f187, f188, f189, f190;
        real_t f191, f192, f193, f194, f195, f196, f197, f198, f199, f200;
        real_t f201, f202, f203, f204, f205, f206, f207, f208, f209, f210;
        real_t f211, f212, f213, f214, f215, f216, f217, f218, f219, f220;
        real_t f221, f222, f223, f224, f225, f226, f227, f228, f229, f230;
        real_t f231, f232, f233, f234, f235, f236, f237, f238, f239, f240;
        real_t f241, f242, f243, f244, f245, f246, f247, f248, f249, f250;
        real_t f251, f252, f253, f254, f255, f256, f257, f258, f259, f260;
        real_t f261, f262, f263, f264, f265, f266, f267, f268, f269, f270;
        real_t f271, f272;

        f0 = MUL_F(x[16], FRAC_CONST(0.7071067811865476));
        f1 = x[0] - f0;
        f2 = x[0] + f0;
        f3 = x[8] + x[24];
        f4 = MUL_C(x[8], COEF_CONST(1.3065629648763766));
        f5 = MUL_F(f3, FRAC_CONST((-0.9238795325112866)));
        f6 = MUL_F(x[24], FRAC_CONST((-0.5411961001461967)));
        f7 = f4 + f5;
        f8 = f6 - f5;
        f9 = f2 - f8;
        f10 = f2 + f8;
        f11 = f1 - f7;
        f12 = f1 + f7;
        f13 = x[4] + x[28];
        f14 = MUL_C(x[4], COEF_CONST(1.1758756024193588));
        f15 = MUL_F(f13, FRAC_CONST((-0.9807852804032304)));
        f16 = MUL_F(x[28], FRAC_CONST((-0.7856949583871021)));
        f17 = f14 + f15;
        f18 = f16 - f15;
        f19 = x[12] + x[20];
        f20 = MUL_C(x[12], COEF_CONST(1.3870398453221473));
        f21 = MUL_F(f19, FRAC_CONST((-0.8314696123025455)));
        f22 = MUL_F(x[20], FRAC_CONST((-0.2758993792829436)));
        f23 = f20 + f21;
        f24 = f22 - f21;
        f25 = f18 - f24;
        f26 = f18 + f24;
        f27 = MUL_F(f25, FRAC_CONST(0.7071067811865476));
        f28 = f17 - f23;
        f29 = f17 + f23;
        f30 = MUL_F(f29, FRAC_CONST(0.7071067811865476));
        f31 = f27 - f30;
        f32 = f27 + f30;
        f33 = f10 - f26;
        f34 = f10 + f26;
        f35 = f12 - f32;
        f36 = f12 + f32;
        f37 = f11 - f31;
        f38 = f11 + f31;
        f39 = f9 - f28;
        f40 = f9 + f28;
        f41 = x[2] + x[30];
        f42 = MUL_C(x[2], COEF_CONST(1.0932018670017569));
        f43 = MUL_F(f41, FRAC_CONST((-0.9951847266721969)));
        f44 = MUL_F(x[30], FRAC_CONST((-0.8971675863426368)));
        f45 = f42 + f43;
        f46 = f44 - f43;
        f47 = x[6] + x[26];
        f48 = MUL_C(x[6], COEF_CONST(1.2472250129866711));
        f49 = MUL_F(f47, FRAC_CONST((-0.9569403357322089)));
        f50 = MUL_F(x[26], FRAC_CONST((-0.6666556584777469)));
        f51 = f48 + f49;
        f52 = f50 - f49;
        f53 = x[10] + x[22];
        f54 = MUL_C(x[10], COEF_CONST(1.3533180011743526));
        f55 = MUL_F(f53, FRAC_CONST((-0.8819212643483551)));
        f56 = MUL_F(x[22], FRAC_CONST((-0.4105245275223575)));
        f57 = f54 + f55;
        f58 = f56 - f55;
        f59 = x[14] + x[18];
        f60 = MUL_C(x[14], COEF_CONST(1.4074037375263826));
        f61 = MUL_F(f59, FRAC_CONST((-0.7730104533627369)));
        f62 = MUL_F(x[18], FRAC_CONST((-0.1386171691990913)));
        f63 = f60 + f61;
        f64 = f62 - f61;
        f65 = f46 - f64;
        f66 = f46 + f64;
        f67 = f52 - f58;
        f68 = f52 + f58;
        f69 = f66 - f68;
        f70 = f66 + f68;
        f71 = MUL_F(f69, FRAC_CONST(0.7071067811865476));
        f72 = f65 + f67;
        f73 = MUL_C(f65, COEF_CONST(1.3065629648763766));
        f74 = MUL_F(f72, FRAC_CONST((-0.9238795325112866)));
        f75 = MUL_F(f67, FRAC_CONST((-0.5411961001461967)));
        f76 = f73 + f74;
        f77 = f75 - f74;
        f78 = f45 - f63;
        f79 = f45 + f63;
        f80 = f51 - f57;
        f81 = f51 + f57;
        f82 = f79 + f81;
        f83 = MUL_C(f79, COEF_CONST(1.3065629648763770));
        f84 = MUL_F(f82, FRAC_CONST((-0.3826834323650904)));
        f85 = MUL_F(f81, FRAC_CONST(0.5411961001461961));
        f86 = f83 + f84;
        f87 = f85 - f84;
        f88 = f78 - f80;
        f89 = f78 + f80;
        f90 = MUL_F(f89, FRAC_CONST(0.7071067811865476));
        f91 = f77 - f87;
        f92 = f77 + f87;
        f93 = f71 - f90;
        f94 = f71 + f90;
        f95 = f76 - f86;
        f96 = f76 + f86;
        f97 = f34 - f70;
        f98 = f34 + f70;
        f99 = f36 - f92;
        f100 = f36 + f92;
        f101 = f38 - f91;
        f102 = f38 + f91;
        f103 = f40 - f94;
        f104 = f40 + f94;
        f105 = f39 - f93;
        f106 = f39 + f93;
        f107 = f37 - f96;
        f108 = f37 + f96;
        f109 = f35 - f95;
        f110 = f35 + f95;
        f111 = f33 - f88;
        f112 = f33 + f88;
        f113 = x[1] + x[31];
        f114 = MUL_C(x[1], COEF_CONST(1.0478631305325901));
        f115 = MUL_F(f113, FRAC_CONST((-0.9987954562051724)));
        f116 = MUL_F(x[31], FRAC_CONST((-0.9497277818777548)));
        f117 = f114 + f115;
        f118 = f116 - f115;
        f119 = x[5] + x[27];
        f120 = MUL_C(x[5], COEF_CONST(1.2130114330978077));
        f121 = MUL_F(f119, FRAC_CONST((-0.9700312531945440)));
        f122 = MUL_F(x[27], FRAC_CONST((-0.7270510732912803)));
        f123 = f120 + f121;
        f124 = f122 - f121;
        f125 = x[9] + x[23];
        f126 = MUL_C(x[9], COEF_CONST(1.3315443865537255));
        f127 = MUL_F(f125, FRAC_CONST((-0.9039892931234433)));
        f128 = MUL_F(x[23], FRAC_CONST((-0.4764341996931612)));
        f129 = f126 + f127;
        f130 = f128 - f127;
        f131 = x[13] + x[19];
        f132 = MUL_C(x[13], COEF_CONST(1.3989068359730781));
        f133 = MUL_F(f131, FRAC_CONST((-0.8032075314806453)));
        f134 = MUL_F(x[19], FRAC_CONST((-0.2075082269882124)));
        f135 = f132 + f133;
        f136 = f134 - f133;
        f137 = x[17] + x[15];
        f138 = MUL_C(x[17], COEF_CONST(1.4125100802019777));
        f139 = MUL_F(f137, FRAC_CONST((-0.6715589548470187)));
        f140 = MUL_F(x[15], FRAC_CONST(0.0693921705079402));
        f141 = f138 + f139;
        f142 = f140 - f139;
        f143 = x[21] + x[11];
        f144 = MUL_C(x[21], COEF_CONST(1.3718313541934939));
        f145 = MUL_F(f143, FRAC_CONST((-0.5141027441932219)));
        f146 = MUL_F(x[11], FRAC_CONST(0.3436258658070501));
        f147 = f144 + f145;
        f148 = f146 - f145;
        f149 = x[25] + x[7];
        f150 = MUL_C(x[25], COEF_CONST(1.2784339185752409));
        f151 = MUL_F(f149, FRAC_CONST((-0.3368898533922200)));
        f152 = MUL_F(x[7], FRAC_CONST(0.6046542117908008));
        f153 = f150 + f151;
        f154 = f152 - f151;
        f155 = x[29] + x[3];
        f156 = MUL_C(x[29], COEF_CONST(1.1359069844201433));
        f157 = MUL_F(f155, FRAC_CONST((-0.1467304744553624)));
        f158 = MUL_F(x[3], FRAC_CONST(0.8424460355094185));
        f159 = f156 + f157;
        f160 = f158 - f157;
        f161 = f118 - f142;
        f162 = f118 + f142;
        f163 = f117 - f141;
        f164 = f117 + f141;
        f165 = f124 - f148;
        f166 = f124 + f148;
        f167 = f123 - f147;
        f168 = f123 + f147;
        f169 = f130 - f154;
        f170 = f130 + f154;
        f171 = f129 - f153;
        f172 = f129 + f153;
        f173 = f136 - f160;
        f174 = f136 + f160;
        f175 = f135 - f159;
        f176 = f135 + f159;
        f177 = f161 + f163;
        f178 = MUL_C(f161, COEF_CONST(1.1758756024193588));
        f179 = MUL_F(f177, FRAC_CONST((-0.9807852804032304)));
        f180 = MUL_F(f163, FRAC_CONST((-0.7856949583871021)));
        f181 = f178 + f179;
        f182 = f180 - f179;
        f183 = f165 + f167;
        f184 = MUL_C(f165, COEF_CONST(1.3870398453221475));
        f185 = MUL_F(f183, FRAC_CONST((-0.5555702330196022)));
        f186 = MUL_F(f167, FRAC_CONST(0.2758993792829431));
        f187 = f184 + f185;
        f188 = f186 - f185;
        f189 = f169 + f171;
        f190 = MUL_F(f169, FRAC_CONST(0.7856949583871022));
        f191 = MUL_F(f189, FRAC_CONST(0.1950903220161283));
        f192 = MUL_C(f171, COEF_CONST(1.1758756024193586));
        f193 = f190 + f191;
        f194 = f192 - f191;
        f195 = f173 + f175;
        f196 = MUL_F(f173, FRAC_CONST((-0.2758993792829430)));
        f197 = MUL_F(f195, FRAC_CONST(0.8314696123025452));
        f198 = MUL_C(f175, COEF_CONST(1.3870398453221475));
        f199 = f196 + f197;
        f200 = f198 - f197;
        f201 = f162 - f170;
        f202 = f162 + f170;
        f203 = f164 - f172;
        f204 = f164 + f172;
        f205 = f166 - f174;
        f206 = f166 + f174;
        f207 = f168 - f176;
        f208 = f168 + f176;
        f209 = f182 - f194;
        f210 = f182 + f194;
        f211 = f181 - f193;
        f212 = f181 + f193;
        f213 = f188 - f200;
        f214 = f188 + f200;
        f215 = f187 - f199;
        f216 = f187 + f199;
        f217 = f201 + f203;
        f218 = MUL_C(f201, COEF_CONST(1.3065629648763766));
        f219 = MUL_F(f217, FRAC_CONST((-0.9238795325112866)));
        f220 = MUL_F(f203, FRAC_CONST((-0.5411961001461967)));
        f221 = f218 + f219;
        f222 = f220 - f219;
        f223 = f205 + f207;
        f224 = MUL_F(f205, FRAC_CONST(0.5411961001461969));
        f225 = MUL_F(f223, FRAC_CONST(0.3826834323650898));
        f226 = MUL_C(f207, COEF_CONST(1.3065629648763766));
        f227 = f224 + f225;
        f228 = f226 - f225;
        f229 = f209 + f211;
        f230 = MUL_C(f209, COEF_CONST(1.3065629648763766));
        f231 = MUL_F(f229, FRAC_CONST((-0.9238795325112866)));
        f232 = MUL_F(f211, FRAC_CONST((-0.5411961001461967)));
        f233 = f230 + f231;
        f234 = f232 - f231;
        f235 = f213 + f215;
        f236 = MUL_F(f213, FRAC_CONST(0.5411961001461969));
        f237 = MUL_F(f235, FRAC_CONST(0.3826834323650898));
        f238 = MUL_C(f215, COEF_CONST(1.3065629648763766));
        f239 = f236 + f237;
        f240 = f238 - f237;
        f241 = f202 - f206;
        f242 = f202 + f206;
        f243 = f204 - f208;
        f244 = f204 + f208;
        f245 = f222 - f228;
        f246 = f222 + f228;
        f247 = f221 - f227;
        f248 = f221 + f227;
        f249 = f210 - f214;
        f250 = f210 + f214;
        f251 = f212 - f216;
        f252 = f212 + f216;
        f253 = f234 - f240;
        f254 = f234 + f240;
        f255 = f233 - f239;
        f256 = f233 + f239;
        f257 = f241 - f243;
        f258 = f241 + f243;
        f259 = MUL_F(f257, FRAC_CONST(0.7071067811865474));
        f260 = MUL_F(f258, FRAC_CONST(0.7071067811865474));
        f261 = f245 - f247;
        f262 = f245 + f247;
        f263 = MUL_F(f261, FRAC_CONST(0.7071067811865474));
        f264 = MUL_F(f262, FRAC_CONST(0.7071067811865474));
        f265 = f249 - f251;
        f266 = f249 + f251;
        f267 = MUL_F(f265, FRAC_CONST(0.7071067811865474));
        f268 = MUL_F(f266, FRAC_CONST(0.7071067811865474));
        f269 = f253 - f255;
        f270 = f253 + f255;
        f271 = MUL_F(f269, FRAC_CONST(0.7071067811865474));
        f272 = MUL_F(f270, FRAC_CONST(0.7071067811865474));
        y[31] = f98 - f242;
        y[0] = f98 + f242;
        y[30] = f100 - f250;
        y[1] = f100 + f250;
        y[29] = f102 - f254;
        y[2] = f102 + f254;
        y[28] = f104 - f246;
        y[3] = f104 + f246;
        y[27] = f106 - f264;
        y[4] = f106 + f264;
        y[26] = f108 - f272;
        y[5] = f108 + f272;
        y[25] = f110 - f268;
        y[6] = f110 + f268;
        y[24] = f112 - f260;
        y[7] = f112 + f260;
        y[23] = f111 - f259;
        y[8] = f111 + f259;
        y[22] = f109 - f267;
        y[9] = f109 + f267;
        y[21] = f107 - f271;
        y[10] = f107 + f271;
        y[20] = f105 - f263;
        y[11] = f105 + f263;
        y[19] = f103 - f248;
        y[12] = f103 + f248;
        y[18] = f101 - f256;
        y[13] = f101 + f256;
        y[17] = f99 - f252;
        y[14] = f99 + f252;
        y[16] = f97 - f244;
        y[15] = f97 + f244;
    }
    /*}}}*/
    /*{{{*/
    void DCT2_32_unscaled (real_t *y, real_t *x)
    {
        real_t f0, f1, f2, f3, f4, f5, f6, f7, f8, f9, f10;
        real_t f11, f12, f13, f14, f15, f16, f17, f18, f19, f20;
        real_t f21, f22, f23, f24, f25, f26, f27, f28, f29, f30;
        real_t f31, f32, f33, f34, f35, f36, f37, f38, f39, f40;
        real_t f41, f42, f43, f44, f45, f46, f47, f48, f49, f50;
        real_t f51, f52, f53, f54, f55, f56, f57, f58, f59, f60;
        real_t f63, f64, f65, f66, f69, f70, f71, f72, f73, f74;
        real_t f75, f76, f77, f78, f79, f80, f81, f83, f85, f86;
        real_t f89, f90, f91, f92, f93, f94, f95, f96, f97, f98;
        real_t f99, f100, f101, f102, f103, f104, f105, f106, f107, f108;
        real_t f109, f110, f111, f112, f113, f114, f115, f116, f117, f118;
        real_t f119, f120, f121, f122, f123, f124, f127, f128, f129, f130;
        real_t f133, f134, f135, f136, f139, f140, f141, f142, f145, f146;
        real_t f147, f148, f149, f150, f151, f152, f153, f154, f155, f156;
        real_t f157, f158, f159, f160, f161, f162, f163, f164, f165, f166;
        real_t f167, f168, f169, f170, f171, f172, f173, f174, f175, f176;
        real_t f177, f178, f179, f180, f181, f182, f183, f184, f185, f186;
        real_t f187, f188, f189, f190, f191, f192, f193, f194, f195, f196;
        real_t f197, f198, f199, f200, f201, f202, f203, f204, f205, f206;
        real_t f207, f208, f209, f210, f211, f212, f213, f214, f215, f216;
        real_t f217, f218, f219, f220, f221, f222, f223, f224, f225, f226;
        real_t f227, f228, f229, f230, f231, f232, f233, f234, f235, f236;
        real_t f237, f238, f239, f240, f241, f242, f243, f244, f247, f248;
        real_t f249, f250, f253, f254, f255, f256, f259, f260, f261, f262;
        real_t f265, f266, f267, f268, f271, f272, f273, f274, f277, f278;
        real_t f279, f280, f283, f284, f285, f286;

        f0 = x[0] - x[31];
        f1 = x[0] + x[31];
        f2 = x[1] - x[30];
        f3 = x[1] + x[30];
        f4 = x[2] - x[29];
        f5 = x[2] + x[29];
        f6 = x[3] - x[28];
        f7 = x[3] + x[28];
        f8 = x[4] - x[27];
        f9 = x[4] + x[27];
        f10 = x[5] - x[26];
        f11 = x[5] + x[26];
        f12 = x[6] - x[25];
        f13 = x[6] + x[25];
        f14 = x[7] - x[24];
        f15 = x[7] + x[24];
        f16 = x[8] - x[23];
        f17 = x[8] + x[23];
        f18 = x[9] - x[22];
        f19 = x[9] + x[22];
        f20 = x[10] - x[21];
        f21 = x[10] + x[21];
        f22 = x[11] - x[20];
        f23 = x[11] + x[20];
        f24 = x[12] - x[19];
        f25 = x[12] + x[19];
        f26 = x[13] - x[18];
        f27 = x[13] + x[18];
        f28 = x[14] - x[17];
        f29 = x[14] + x[17];
        f30 = x[15] - x[16];
        f31 = x[15] + x[16];
        f32 = f1 - f31;
        f33 = f1 + f31;
        f34 = f3 - f29;
        f35 = f3 + f29;
        f36 = f5 - f27;
        f37 = f5 + f27;
        f38 = f7 - f25;
        f39 = f7 + f25;
        f40 = f9 - f23;
        f41 = f9 + f23;
        f42 = f11 - f21;
        f43 = f11 + f21;
        f44 = f13 - f19;
        f45 = f13 + f19;
        f46 = f15 - f17;
        f47 = f15 + f17;
        f48 = f33 - f47;
        f49 = f33 + f47;
        f50 = f35 - f45;
        f51 = f35 + f45;
        f52 = f37 - f43;
        f53 = f37 + f43;
        f54 = f39 - f41;
        f55 = f39 + f41;
        f56 = f49 - f55;
        f57 = f49 + f55;
        f58 = f51 - f53;
        f59 = f51 + f53;
        f60 = f57 - f59;
        y[0] = f57 + f59;
        y[16] = MUL_F(FRAC_CONST(0.7071067811865476), f60);
        f63 = f56 + f58;
        f64 = MUL_C(COEF_CONST(1.3065629648763766), f56);
        f65 = MUL_F(FRAC_CONST(-0.9238795325112866), f63);
        f66 = MUL_F(FRAC_CONST(-0.5411961001461967), f58);
        y[24] = f64 + f65;
        y[8] = f66 - f65;
        f69 = f48 + f54;
        f70 = MUL_C(COEF_CONST(1.1758756024193588), f48);
        f71 = MUL_F(FRAC_CONST(-0.9807852804032304), f69);
        f72 = MUL_F(FRAC_CONST(-0.7856949583871021), f54);
        f73 = f70 + f71;
        f74 = f72 - f71;
        f75 = f50 + f52;
        f76 = MUL_C(COEF_CONST(1.3870398453221473), f50);
        f77 = MUL_F(FRAC_CONST(-0.8314696123025455), f75);
        f78 = MUL_F(FRAC_CONST(-0.2758993792829436), f52);
        f79 = f76 + f77;
        f80 = f78 - f77;
        f81 = f74 - f80;
        y[4] = f74 + f80;
        f83 = MUL_F(FRAC_CONST(0.7071067811865476), f81);
        y[28] = f73 - f79;
        f85 = f73 + f79;
        f86 = MUL_F(FRAC_CONST(0.7071067811865476), f85);
        y[20] = f83 - f86;
        y[12] = f83 + f86;
        f89 = f34 - f36;
        f90 = f34 + f36;
        f91 = f38 - f40;
        f92 = f38 + f40;
        f93 = f42 - f44;
        f94 = f42 + f44;
        f95 = MUL_F(FRAC_CONST(0.7071067811865476), f92);
        f96 = f32 - f95;
        f97 = f32 + f95;
        f98 = f90 + f94;
        f99 = MUL_C(COEF_CONST(1.3065629648763766), f90);
        f100 = MUL_F(FRAC_CONST(-0.9238795325112866), f98);
        f101 = MUL_F(FRAC_CONST(-0.5411961001461967), f94);
        f102 = f99 + f100;
        f103 = f101 - f100;
        f104 = f97 - f103;
        f105 = f97 + f103;
        f106 = f96 - f102;
        f107 = f96 + f102;
        f108 = MUL_F(FRAC_CONST(0.7071067811865476), f91);
        f109 = f46 - f108;
        f110 = f46 + f108;
        f111 = f93 + f89;
        f112 = MUL_C(COEF_CONST(1.3065629648763766), f93);
        f113 = MUL_F(FRAC_CONST(-0.9238795325112866), f111);
        f114 = MUL_F(FRAC_CONST(-0.5411961001461967), f89);
        f115 = f112 + f113;
        f116 = f114 - f113;
        f117 = f110 - f116;
        f118 = f110 + f116;
        f119 = f109 - f115;
        f120 = f109 + f115;
        f121 = f118 + f105;
        f122 = MUL_F(FRAC_CONST(-0.8971675863426361), f118);
        f123 = MUL_F(FRAC_CONST(0.9951847266721968), f121);
        f124 = MUL_C(COEF_CONST(1.0932018670017576), f105);
        y[2] = f122 + f123;
        y[30] = f124 - f123;
        f127 = f107 - f120;
        f128 = MUL_F(FRAC_CONST(-0.6666556584777466), f120);
        f129 = MUL_F(FRAC_CONST(0.9569403357322089), f127);
        f130 = MUL_C(COEF_CONST(1.2472250129866713), f107);
        y[6] = f129 - f128;
        y[26] = f130 - f129;
        f133 = f119 + f106;
        f134 = MUL_F(FRAC_CONST(-0.4105245275223571), f119);
        f135 = MUL_F(FRAC_CONST(0.8819212643483549), f133);
        f136 = MUL_C(COEF_CONST(1.3533180011743529), f106);
        y[10] = f134 + f135;
        y[22] = f136 - f135;
        f139 = f104 - f117;
        f140 = MUL_F(FRAC_CONST(-0.1386171691990915), f117);
        f141 = MUL_F(FRAC_CONST(0.7730104533627370), f139);
        f142 = MUL_C(COEF_CONST(1.4074037375263826), f104);
        y[14] = f141 - f140;
        y[18] = f142 - f141;
        f145 = f2 - f4;
        f146 = f2 + f4;
        f147 = f6 - f8;
        f148 = f6 + f8;
        f149 = f10 - f12;
        f150 = f10 + f12;
        f151 = f14 - f16;
        f152 = f14 + f16;
        f153 = f18 - f20;
        f154 = f18 + f20;
        f155 = f22 - f24;
        f156 = f22 + f24;
        f157 = f26 - f28;
        f158 = f26 + f28;
        f159 = MUL_F(FRAC_CONST(0.7071067811865476), f152);
        f160 = f0 - f159;
        f161 = f0 + f159;
        f162 = f148 + f156;
        f163 = MUL_C(COEF_CONST(1.3065629648763766), f148);
        f164 = MUL_F(FRAC_CONST(-0.9238795325112866), f162);
        f165 = MUL_F(FRAC_CONST(-0.5411961001461967), f156);
        f166 = f163 + f164;
        f167 = f165 - f164;
        f168 = f161 - f167;
        f169 = f161 + f167;
        f170 = f160 - f166;
        f171 = f160 + f166;
        f172 = f146 + f158;
        f173 = MUL_C(COEF_CONST(1.1758756024193588), f146);
        f174 = MUL_F(FRAC_CONST(-0.9807852804032304), f172);
        f175 = MUL_F(FRAC_CONST(-0.7856949583871021), f158);
        f176 = f173 + f174;
        f177 = f175 - f174;
        f178 = f150 + f154;
        f179 = MUL_C(COEF_CONST(1.3870398453221473), f150);
        f180 = MUL_F(FRAC_CONST(-0.8314696123025455), f178);
        f181 = MUL_F(FRAC_CONST(-0.2758993792829436), f154);
        f182 = f179 + f180;
        f183 = f181 - f180;
        f184 = f177 - f183;
        f185 = f177 + f183;
        f186 = MUL_F(FRAC_CONST(0.7071067811865476), f184);
        f187 = f176 - f182;
        f188 = f176 + f182;
        f189 = MUL_F(FRAC_CONST(0.7071067811865476), f188);
        f190 = f186 - f189;
        f191 = f186 + f189;
        f192 = f169 - f185;
        f193 = f169 + f185;
        f194 = f171 - f191;
        f195 = f171 + f191;
        f196 = f170 - f190;
        f197 = f170 + f190;
        f198 = f168 - f187;
        f199 = f168 + f187;
        f200 = MUL_F(FRAC_CONST(0.7071067811865476), f151);
        f201 = f30 - f200;
        f202 = f30 + f200;
        f203 = f155 + f147;
        f204 = MUL_C(COEF_CONST(1.3065629648763766), f155);
        f205 = MUL_F(FRAC_CONST(-0.9238795325112866), f203);
        f206 = MUL_F(FRAC_CONST(-0.5411961001461967), f147);
        f207 = f204 + f205;
        f208 = f206 - f205;
        f209 = f202 - f208;
        f210 = f202 + f208;
        f211 = f201 - f207;
        f212 = f201 + f207;
        f213 = f157 + f145;
        f214 = MUL_C(COEF_CONST(1.1758756024193588), f157);
        f215 = MUL_F(FRAC_CONST(-0.9807852804032304), f213);
        f216 = MUL_F(FRAC_CONST(-0.7856949583871021), f145);
        f217 = f214 + f215;
        f218 = f216 - f215;
        f219 = f153 + f149;
        f220 = MUL_C(COEF_CONST(1.3870398453221473), f153);
        f221 = MUL_F(FRAC_CONST(-0.8314696123025455), f219);
        f222 = MUL_F(FRAC_CONST(-0.2758993792829436), f149);
        f223 = f220 + f221;
        f224 = f222 - f221;
        f225 = f218 - f224;
        f226 = f218 + f224;
        f227 = MUL_F(FRAC_CONST(0.7071067811865476), f225);
        f228 = f217 - f223;
        f229 = f217 + f223;
        f230 = MUL_F(FRAC_CONST(0.7071067811865476), f229);
        f231 = f227 - f230;
        f232 = f227 + f230;
        f233 = f210 - f226;
        f234 = f210 + f226;
        f235 = f212 - f232;
        f236 = f212 + f232;
        f237 = f211 - f231;
        f238 = f211 + f231;
        f239 = f209 - f228;
        f240 = f209 + f228;
        f241 = f234 + f193;
        f242 = MUL_F(FRAC_CONST(-0.9497277818777543), f234);
        f243 = MUL_F(FRAC_CONST(0.9987954562051724), f241);
        f244 = MUL_C(COEF_CONST(1.0478631305325905), f193);
        y[1] = f242 + f243;
        y[31] = f244 - f243;
        f247 = f195 - f236;
        f248 = MUL_F(FRAC_CONST(-0.8424460355094192), f236);
        f249 = MUL_F(FRAC_CONST(0.9891765099647810), f247);
        f250 = MUL_C(COEF_CONST(1.1359069844201428), f195);
        y[3] = f249 - f248;
        y[29] = f250 - f249;
        f253 = f238 + f197;
        f254 = MUL_F(FRAC_CONST(-0.7270510732912801), f238);
        f255 = MUL_F(FRAC_CONST(0.9700312531945440), f253);
        f256 = MUL_C(COEF_CONST(1.2130114330978079), f197);
        y[5] = f254 + f255;
        y[27] = f256 - f255;
        f259 = f199 - f240;
        f260 = MUL_F(FRAC_CONST(-0.6046542117908007), f240);
        f261 = MUL_F(FRAC_CONST(0.9415440651830208), f259);
        f262 = MUL_C(COEF_CONST(1.2784339185752409), f199);
        y[7] = f261 - f260;
        y[25] = f262 - f261;
        f265 = f239 + f198;
        f266 = MUL_F(FRAC_CONST(-0.4764341996931611), f239);
        f267 = MUL_F(FRAC_CONST(0.9039892931234433), f265);
        f268 = MUL_C(COEF_CONST(1.3315443865537255), f198);
        y[9] = f266 + f267;
        y[23] = f268 - f267;
        f271 = f196 - f237;
        f272 = MUL_F(FRAC_CONST(-0.3436258658070505), f237);
        f273 = MUL_F(FRAC_CONST(0.8577286100002721), f271);
        f274 = MUL_C(COEF_CONST(1.3718313541934939), f196);
        y[11] = f273 - f272;
        y[21] = f274 - f273;
        f277 = f235 + f194;
        f278 = MUL_F(FRAC_CONST(-0.2075082269882114), f235);
        f279 = MUL_F(FRAC_CONST(0.8032075314806448), f277);
        f280 = MUL_C(COEF_CONST(1.3989068359730783), f194);
        y[13] = f278 + f279;
        y[19] = f280 - f279;
        f283 = f192 - f233;
        f284 = MUL_F(FRAC_CONST(-0.0693921705079408), f233);
        f285 = MUL_F(FRAC_CONST(0.7409511253549591), f283);
        f286 = MUL_C(COEF_CONST(1.4125100802019774), f192);
        y[15] = f285 - f284;
        y[17] = f286 - f285;
    }
    /*}}}*/
  #else
    /*{{{*/
    static void auto_correlation (sbr_info *sbr, acorr_coef *ac, qmf_t buffer[MAX_NTSRHFG][64],
                                 uint8_t bd, uint8_t len)
    {
        real_t r01r = 0, r01i = 0, r02r = 0, r02i = 0, r11r = 0;
        real_t temp1_r, temp1_i, temp2_r, temp2_i, temp3_r, temp3_i, temp4_r, temp4_i, temp5_r, temp5_i;
        const real_t rel = 1 / (1 + 1e-6f);
        int8_t j;
        uint8_t offset = sbr->tHFAdj;

        temp2_r = QMF_RE(buffer[offset-2][bd]);
        temp2_i = QMF_IM(buffer[offset-2][bd]);
        temp3_r = QMF_RE(buffer[offset-1][bd]);
        temp3_i = QMF_IM(buffer[offset-1][bd]);
        // Save these because they are needed after loop
        temp4_r = temp2_r;
        temp4_i = temp2_i;
        temp5_r = temp3_r;
        temp5_i = temp3_i;

        for (j = offset; j < len + offset; j++)
        {
          temp1_r = temp2_r; // temp1_r = QMF_RE(buffer[j-2][bd];
          temp1_i = temp2_i; // temp1_i = QMF_IM(buffer[j-2][bd];
          temp2_r = temp3_r; // temp2_r = QMF_RE(buffer[j-1][bd];
          temp2_i = temp3_i; // temp2_i = QMF_IM(buffer[j-1][bd];
            temp3_r = QMF_RE(buffer[j][bd]);
            temp3_i = QMF_IM(buffer[j][bd]);
            r01r += temp3_r * temp2_r + temp3_i * temp2_i;
            r01i += temp3_i * temp2_r - temp3_r * temp2_i;
            r02r += temp3_r * temp1_r + temp3_i * temp1_i;
            r02i += temp3_i * temp1_r - temp3_r * temp1_i;
            r11r += temp2_r * temp2_r + temp2_i * temp2_i;
        }

        // These are actual values in temporary variable at this point
        // temp1_r = QMF_RE(buffer[len+offset-1-2][bd];
        // temp1_i = QMF_IM(buffer[len+offset-1-2][bd];
        // temp2_r = QMF_RE(buffer[len+offset-1-1][bd];
        // temp2_i = QMF_IM(buffer[len+offset-1-1][bd];
        // temp3_r = QMF_RE(buffer[len+offset-1][bd]);
        // temp3_i = QMF_IM(buffer[len+offset-1][bd]);
        // temp4_r = QMF_RE(buffer[offset-2][bd]);
        // temp4_i = QMF_IM(buffer[offset-2][bd]);
        // temp5_r = QMF_RE(buffer[offset-1][bd]);
        // temp5_i = QMF_IM(buffer[offset-1][bd]);

        RE(ac->r12) = r01r -
            (temp3_r * temp2_r + temp3_i * temp2_i) +
            (temp5_r * temp4_r + temp5_i * temp4_i);
        IM(ac->r12) = r01i -
            (temp3_i * temp2_r - temp3_r * temp2_i) +
            (temp5_i * temp4_r - temp5_r * temp4_i);
        RE(ac->r22) = r11r -
            (temp2_r * temp2_r + temp2_i * temp2_i) +
            (temp4_r * temp4_r + temp4_i * temp4_i);

        RE(ac->r01) = r01r;
        IM(ac->r01) = r01i;
        RE(ac->r02) = r02r;
        IM(ac->r02) = r02i;
        RE(ac->r11) = r11r;

        ac->det = MUL_R(RE(ac->r11), RE(ac->r22)) - MUL_F(rel, (MUL_R(RE(ac->r12), RE(ac->r12)) + MUL_R(IM(ac->r12), IM(ac->r12))));
    }
    /*}}}*/
    /*{{{*/
    static void calc_prediction_coef (sbr_info *sbr, qmf_t Xlow[MAX_NTSRHFG][64],
                                      complex_t *alpha_0, complex_t *alpha_1, uint8_t k)
    {
        real_t tmp;
        acorr_coef ac;

        auto_correlation(sbr, &ac, Xlow, k, sbr->numTimeSlotsRate + 6);

        if (ac.det == 0)
        {
            RE(alpha_1[k]) = 0;
            IM(alpha_1[k]) = 0;
        } else {
            tmp = REAL_CONST(1.0) / ac.det;
            RE(alpha_1[k]) = (MUL_R(RE(ac.r01), RE(ac.r12)) - MUL_R(IM(ac.r01), IM(ac.r12)) - MUL_R(RE(ac.r02), RE(ac.r11))) * tmp;
            IM(alpha_1[k]) = (MUL_R(IM(ac.r01), RE(ac.r12)) + MUL_R(RE(ac.r01), IM(ac.r12)) - MUL_R(IM(ac.r02), RE(ac.r11))) * tmp;
        }

        if (RE(ac.r11) == 0)
        {
            RE(alpha_0[k]) = 0;
            IM(alpha_0[k]) = 0;
        } else {
            tmp = 1.0f / RE(ac.r11);
            RE(alpha_0[k]) = -(RE(ac.r01) + MUL_R(RE(alpha_1[k]), RE(ac.r12)) + MUL_R(IM(alpha_1[k]), IM(ac.r12))) * tmp;
            IM(alpha_0[k]) = -(IM(ac.r01) + MUL_R(IM(alpha_1[k]), RE(ac.r12)) - MUL_R(RE(alpha_1[k]), IM(ac.r12))) * tmp;
        }

        if ((MUL_R(RE(alpha_0[k]),RE(alpha_0[k])) + MUL_R(IM(alpha_0[k]),IM(alpha_0[k])) >= REAL_CONST(16)) ||
            (MUL_R(RE(alpha_1[k]),RE(alpha_1[k])) + MUL_R(IM(alpha_1[k]),IM(alpha_1[k])) >= REAL_CONST(16)))
        {
            RE(alpha_0[k]) = 0;
            IM(alpha_0[k]) = 0;
            RE(alpha_1[k]) = 0;
            IM(alpha_1[k]) = 0;
        }
    }
    /*}}}*/
    /*{{{*/
    void sbr_qmf_synthesis_32 (sbr_info *sbr, qmfs_info *qmfs, qmf_t X[MAX_NTSRHFG][64],
                              real_t *output)
    {
        ALIGN real_t x1[32], x2[32];
        real_t scale = 1.f/64.f;
        int32_t n, k, out = 0;
        uint8_t l;


        /* qmf subsample l */
        for (l = 0; l < sbr->numTimeSlotsRate; l++)
        {
            /* shift buffer v */
            /* buffer is not shifted, we are using a ringbuffer */
            //memmove(qmfs->v + 64, qmfs->v, (640-64)*sizeof(real_t));

            /* calculate 64 samples */
            /* complex pre-twiddle */
            for (k = 0; k < 32; k++)
            {
                x1[k] = MUL_F(QMF_RE(X[l][k]), RE(qmf32_pre_twiddle[k])) - MUL_F(QMF_IM(X[l][k]), IM(qmf32_pre_twiddle[k]));
                x2[k] = MUL_F(QMF_IM(X[l][k]), RE(qmf32_pre_twiddle[k])) + MUL_F(QMF_RE(X[l][k]), IM(qmf32_pre_twiddle[k]));

                x1[k] *= scale;
                x2[k] *= scale;
            }

            /* transform */
            DCT4_32(x1, x1);
            DST4_32(x2, x2);

            for (n = 0; n < 32; n++)
            {
                qmfs->v[qmfs->v_index + n]      = qmfs->v[qmfs->v_index + 640 + n]      = -x1[n] + x2[n];
                qmfs->v[qmfs->v_index + 63 - n] = qmfs->v[qmfs->v_index + 640 + 63 - n] =  x1[n] + x2[n];
            }

            /* calculate 32 output samples and window */
            for (k = 0; k < 32; k++)
            {
                output[out++] = MUL_F(qmfs->v[qmfs->v_index + k], qmf_c[2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 96 + k], qmf_c[64 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 128 + k], qmf_c[128 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 224 + k], qmf_c[192 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 256 + k], qmf_c[256 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 352 + k], qmf_c[320 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 384 + k], qmf_c[384 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 480 + k], qmf_c[448 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 512 + k], qmf_c[512 + 2*k]) +
                    MUL_F(qmfs->v[qmfs->v_index + 608 + k], qmf_c[576 + 2*k]);
            }

            /* update ringbuffer index */
            qmfs->v_index -= 64;
            if (qmfs->v_index < 0)
                qmfs->v_index = (640 - 64);
        }
    }
    /*}}}*/
    /*{{{*/
    void sbr_qmf_synthesis_64 (sbr_info *sbr, qmfs_info *qmfs, qmf_t X[MAX_NTSRHFG][64],
                              real_t *output)
    {
    //    ALIGN real_t x1[64], x2[64];
    #ifndef SBR_LOW_POWER
        ALIGN real_t in_real1[32], in_imag1[32], out_real1[32], out_imag1[32];
        ALIGN real_t in_real2[32], in_imag2[32], out_real2[32], out_imag2[32];
    #endif
        qmf_t * pX;
        real_t * pring_buffer_1, * pring_buffer_3;
    //    real_t * ptemp_1, * ptemp_2;
    #ifdef PREFER_POINTERS
        // These pointers are used if target platform has autoinc address generators
        real_t * pring_buffer_2, * pring_buffer_4;
        real_t * pring_buffer_5, * pring_buffer_6;
        real_t * pring_buffer_7, * pring_buffer_8;
        real_t * pring_buffer_9, * pring_buffer_10;
        const real_t * pqmf_c_1, * pqmf_c_2, * pqmf_c_3, * pqmf_c_4;
        const real_t * pqmf_c_5, * pqmf_c_6, * pqmf_c_7, * pqmf_c_8;
        const real_t * pqmf_c_9, * pqmf_c_10;
    #endif // #ifdef PREFER_POINTERS
        real_t scale = 1.f/64.f;
        int32_t n, k, out = 0;
        uint8_t l;


        /* qmf subsample l */
        for (l = 0; l < sbr->numTimeSlotsRate; l++)
        {
            /* shift buffer v */
        /* buffer is not shifted, we use double ringbuffer */
        //memmove(qmfs->v + 128, qmfs->v, (1280-128)*sizeof(real_t));

            /* calculate 128 samples */
            pX = X[l];

            in_imag1[31] = scale*QMF_RE(pX[1]);
            in_real1[0]  = scale*QMF_RE(pX[0]);
            in_imag2[31] = scale*QMF_IM(pX[63-1]);
            in_real2[0]  = scale*QMF_IM(pX[63-0]);
            for (k = 1; k < 31; k++)
            {
                in_imag1[31 - k] = scale*QMF_RE(pX[2*k + 1]);
                in_real1[     k] = scale*QMF_RE(pX[2*k    ]);
                in_imag2[31 - k] = scale*QMF_IM(pX[63 - (2*k + 1)]);
                in_real2[     k] = scale*QMF_IM(pX[63 - (2*k    )]);
            }
            in_imag1[0]  = scale*QMF_RE(pX[63]);
            in_real1[31] = scale*QMF_RE(pX[62]);
            in_imag2[0]  = scale*QMF_IM(pX[63-63]);
            in_real2[31] = scale*QMF_IM(pX[63-62]);

            // dct4_kernel is DCT_IV without reordering which is done before and after FFT
            dct4_kernel(in_real1, in_imag1, out_real1, out_imag1);
            dct4_kernel(in_real2, in_imag2, out_real2, out_imag2);


            pring_buffer_1 = qmfs->v + qmfs->v_index;
            pring_buffer_3 = pring_buffer_1 + 1280;
    #ifdef PREFER_POINTERS
            pring_buffer_2 = pring_buffer_1 + 127;
            pring_buffer_4 = pring_buffer_1 + (1280 + 127);
    #endif // #ifdef PREFER_POINTERS
    //        ptemp_1 = x1;
    //        ptemp_2 = x2;
    #ifdef PREFER_POINTERS
            for (n = 0; n < 32; n ++)
            {
                //real_t x1 = *ptemp_1++;
                //real_t x2 = *ptemp_2++;
                // pring_buffer_3 and pring_buffer_4 are needed only for double ring buffer
                *pring_buffer_1++ = *pring_buffer_3++ = out_real2[n] - out_real1[n];
                *pring_buffer_2-- = *pring_buffer_4-- = out_real2[n] + out_real1[n];
                //x1 = *ptemp_1++;
                //x2 = *ptemp_2++;
                *pring_buffer_1++ = *pring_buffer_3++ = out_imag2[31-n] + out_imag1[31-n];
                *pring_buffer_2-- = *pring_buffer_4-- = out_imag2[31-n] - out_imag1[31-n];
            }
    #else // #ifdef PREFER_POINTERS

            for (n = 0; n < 32; n++)
            {
                // pring_buffer_3 and pring_buffer_4 are needed only for double ring buffer
                pring_buffer_1[2*n]         = pring_buffer_3[2*n]         = out_real2[n] - out_real1[n];
                pring_buffer_1[127-2*n]     = pring_buffer_3[127-2*n]     = out_real2[n] + out_real1[n];
                pring_buffer_1[2*n+1]       = pring_buffer_3[2*n+1]       = out_imag2[31-n] + out_imag1[31-n];
                pring_buffer_1[127-(2*n+1)] = pring_buffer_3[127-(2*n+1)] = out_imag2[31-n] - out_imag1[31-n];
            }

    #endif // #ifdef PREFER_POINTERS

            pring_buffer_1 = qmfs->v + qmfs->v_index;
    #ifdef PREFER_POINTERS
            pring_buffer_2 = pring_buffer_1 + 192;
            pring_buffer_3 = pring_buffer_1 + 256;
            pring_buffer_4 = pring_buffer_1 + (256 + 192);
            pring_buffer_5 = pring_buffer_1 + 512;
            pring_buffer_6 = pring_buffer_1 + (512 + 192);
            pring_buffer_7 = pring_buffer_1 + 768;
            pring_buffer_8 = pring_buffer_1 + (768 + 192);
            pring_buffer_9 = pring_buffer_1 + 1024;
            pring_buffer_10 = pring_buffer_1 + (1024 + 192);
            pqmf_c_1 = qmf_c;
            pqmf_c_2 = qmf_c + 64;
            pqmf_c_3 = qmf_c + 128;
            pqmf_c_4 = qmf_c + 192;
            pqmf_c_5 = qmf_c + 256;
            pqmf_c_6 = qmf_c + 320;
            pqmf_c_7 = qmf_c + 384;
            pqmf_c_8 = qmf_c + 448;
            pqmf_c_9 = qmf_c + 512;
            pqmf_c_10 = qmf_c + 576;
    #endif // #ifdef PREFER_POINTERS

            /* calculate 64 output samples and window */
            for (k = 0; k < 64; k++)
            {
    #ifdef PREFER_POINTERS
                output[out++] =
                    MUL_F(*pring_buffer_1++,  *pqmf_c_1++) +
                    MUL_F(*pring_buffer_2++,  *pqmf_c_2++) +
                    MUL_F(*pring_buffer_3++,  *pqmf_c_3++) +
                    MUL_F(*pring_buffer_4++,  *pqmf_c_4++) +
                    MUL_F(*pring_buffer_5++,  *pqmf_c_5++) +
                    MUL_F(*pring_buffer_6++,  *pqmf_c_6++) +
                    MUL_F(*pring_buffer_7++,  *pqmf_c_7++) +
                    MUL_F(*pring_buffer_8++,  *pqmf_c_8++) +
                    MUL_F(*pring_buffer_9++,  *pqmf_c_9++) +
                    MUL_F(*pring_buffer_10++, *pqmf_c_10++);
    #else // #ifdef PREFER_POINTERS
                output[out++] =
                    MUL_F(pring_buffer_1[k+0],          qmf_c[k+0])   +
                    MUL_F(pring_buffer_1[k+192],        qmf_c[k+64])  +
                    MUL_F(pring_buffer_1[k+256],        qmf_c[k+128]) +
                    MUL_F(pring_buffer_1[k+(256+192)],  qmf_c[k+192]) +
                    MUL_F(pring_buffer_1[k+512],        qmf_c[k+256]) +
                    MUL_F(pring_buffer_1[k+(512+192)],  qmf_c[k+320]) +
                    MUL_F(pring_buffer_1[k+768],        qmf_c[k+384]) +
                    MUL_F(pring_buffer_1[k+(768+192)],  qmf_c[k+448]) +
                    MUL_F(pring_buffer_1[k+1024],       qmf_c[k+512]) +
                    MUL_F(pring_buffer_1[k+(1024+192)], qmf_c[k+576]);
    #endif // #ifdef PREFER_POINTERS
            }

            /* update ringbuffer index */
            qmfs->v_index -= 128;
            if (qmfs->v_index < 0)
                qmfs->v_index = (1280 - 128);
        }
    }
    /*}}}*/

    #define n 32
    #define log2n 5
    /*{{{*/
    static const real_t w_array_real[] = {
        FRAC_CONST(1.000000000000000), FRAC_CONST(0.980785279337272),
        FRAC_CONST(0.923879528329380), FRAC_CONST(0.831469603195765),
        FRAC_CONST(0.707106765732237), FRAC_CONST(0.555570210304169),
        FRAC_CONST(0.382683402077046), FRAC_CONST(0.195090284503576),
        FRAC_CONST(0.000000000000000), FRAC_CONST(-0.195090370246552),
        FRAC_CONST(-0.382683482845162), FRAC_CONST(-0.555570282993553),
        FRAC_CONST(-0.707106827549476), FRAC_CONST(-0.831469651765257),
        FRAC_CONST(-0.923879561784627), FRAC_CONST(-0.980785296392607)
    };
    /*}}}*/
    /*{{{*/
    // w_array_imag[i] = sin(-2*M_PI*i/32)
    static const real_t w_array_imag[] = {
        FRAC_CONST(0.000000000000000), FRAC_CONST(-0.195090327375064),
        FRAC_CONST(-0.382683442461104), FRAC_CONST(-0.555570246648862),
        FRAC_CONST(-0.707106796640858), FRAC_CONST(-0.831469627480512),
        FRAC_CONST(-0.923879545057005), FRAC_CONST(-0.980785287864940),
        FRAC_CONST(-1.000000000000000), FRAC_CONST(-0.980785270809601),
        FRAC_CONST(-0.923879511601754), FRAC_CONST(-0.831469578911016),
        FRAC_CONST(-0.707106734823616), FRAC_CONST(-0.555570173959476),
        FRAC_CONST(-0.382683361692986), FRAC_CONST(-0.195090241632088)
    };
    /*}}}*/
    /*{{{*/
    // FFT decimation in frequency
    // 4*16*2+16=128+16=144 multiplications
    // 6*16*2+10*8+4*16*2=192+80+128=400 additions
    static void fft_dif (real_t * Real, real_t * Imag)
    {
        real_t w_real, w_imag; // For faster access
        real_t point1_real, point1_imag, point2_real, point2_imag; // For faster access
        uint32_t j, i, i2, w_index; // Counters

        // First 2 stages of 32 point FFT decimation in frequency
        // 4*16*2=64*2=128 multiplications
        // 6*16*2=96*2=192 additions
      // Stage 1 of 32 point FFT decimation in frequency
        for (i = 0; i < 16; i++)
        {
            point1_real = Real[i];
            point1_imag = Imag[i];
            i2 = i+16;
            point2_real = Real[i2];
            point2_imag = Imag[i2];

            w_real = w_array_real[i];
            w_imag = w_array_imag[i];

            // temp1 = x[i] - x[i2]
            point1_real -= point2_real;
            point1_imag -= point2_imag;

            // x[i1] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * w
            Real[i2] = (MUL_F(point1_real,w_real) - MUL_F(point1_imag,w_imag));
            Imag[i2] = (MUL_F(point1_real,w_imag) + MUL_F(point1_imag,w_real));
         }
        // Stage 2 of 32 point FFT decimation in frequency
        for (j = 0, w_index = 0; j < 8; j++, w_index += 2)
        {
            w_real = w_array_real[w_index];
            w_imag = w_array_imag[w_index];

          i = j;
            point1_real = Real[i];
            point1_imag = Imag[i];
            i2 = i+8;
            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // temp1 = x[i] - x[i2]
            point1_real -= point2_real;
            point1_imag -= point2_imag;

            // x[i1] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * w
            Real[i2] = (MUL_F(point1_real,w_real) - MUL_F(point1_imag,w_imag));
            Imag[i2] = (MUL_F(point1_real,w_imag) + MUL_F(point1_imag,w_real));

            i = j+16;
            point1_real = Real[i];
            point1_imag = Imag[i];
            i2 = i+8;
            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // temp1 = x[i] - x[i2]
            point1_real -= point2_real;
            point1_imag -= point2_imag;

            // x[i1] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * w
            Real[i2] = (MUL_F(point1_real,w_real) - MUL_F(point1_imag,w_imag));
            Imag[i2] = (MUL_F(point1_real,w_imag) + MUL_F(point1_imag,w_real));
        }

        // Stage 3 of 32 point FFT decimation in frequency
        // 2*4*2=16 multiplications
        // 4*4*2+6*4*2=10*8=80 additions
        for (i = 0; i < n; i += 8)
        {
            i2 = i+4;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // out[i1] = point1 + point2
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // out[i2] = point1 - point2
            Real[i2] = point1_real - point2_real;
            Imag[i2] = point1_imag - point2_imag;
        }
        w_real = w_array_real[4]; // = sqrt(2)/2
        // w_imag = -w_real; // = w_array_imag[4]; // = -sqrt(2)/2
        for (i = 1; i < n; i += 8)
        {
            i2 = i+4;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // temp1 = x[i] - x[i2]
            point1_real -= point2_real;
            point1_imag -= point2_imag;

            // x[i1] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * w
            Real[i2] = MUL_F(point1_real+point1_imag, w_real);
            Imag[i2] = MUL_F(point1_imag-point1_real, w_real);
        }
        for (i = 2; i < n; i += 8)
        {
            i2 = i+4;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // x[i] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * (-i)
            Real[i2] = point1_imag - point2_imag;
            Imag[i2] = point2_real - point1_real;
        }
        w_real = w_array_real[12]; // = -sqrt(2)/2
        // w_imag = w_real; // = w_array_imag[12]; // = -sqrt(2)/2
        for (i = 3; i < n; i += 8)
        {
            i2 = i+4;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // temp1 = x[i] - x[i2]
            point1_real -= point2_real;
            point1_imag -= point2_imag;

            // x[i1] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * w
            Real[i2] = MUL_F(point1_real-point1_imag, w_real);
            Imag[i2] = MUL_F(point1_real+point1_imag, w_real);
        }


        // Stage 4 of 32 point FFT decimation in frequency (no multiplications)
        // 16*4=64 additions
        for (i = 0; i < n; i += 4)
        {
            i2 = i+2;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // x[i1] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = x[i] - x[i2]
            Real[i2] = point1_real - point2_real;
            Imag[i2] = point1_imag - point2_imag;
        }
        for (i = 1; i < n; i += 4)
        {
            i2 = i+2;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // x[i] = x[i] + x[i2]
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // x[i2] = (x[i] - x[i2]) * (-i)
            Real[i2] = point1_imag - point2_imag;
            Imag[i2] = point2_real - point1_real;
        }

        // Stage 5 of 32 point FFT decimation in frequency (no multiplications)
        // 16*4=64 additions
        for (i = 0; i < n; i += 2)
        {
            i2 = i+1;
            point1_real = Real[i];
            point1_imag = Imag[i];

            point2_real = Real[i2];
            point2_imag = Imag[i2];

            // out[i1] = point1 + point2
            Real[i] += point2_real;
            Imag[i] += point2_imag;

            // out[i2] = point1 - point2
            Real[i2] = point1_real - point2_real;
            Imag[i2] = point1_imag - point2_imag;
        }

    #ifdef REORDER_IN_FFT
        FFTReorder(Real, Imag);
    #endif // #ifdef REORDER_IN_FFT
    }
    /*}}}*/
    #undef n
    #undef log2n
    /*{{{*/
    static const real_t dct4_64_tab[] = {
        COEF_CONST(0.999924719333649), COEF_CONST(0.998118102550507),
        COEF_CONST(0.993906974792480), COEF_CONST(0.987301409244537),
        COEF_CONST(0.978317379951477), COEF_CONST(0.966976463794708),
        COEF_CONST(0.953306019306183), COEF_CONST(0.937339007854462),
        COEF_CONST(0.919113874435425), COEF_CONST(0.898674488067627),
        COEF_CONST(0.876070082187653), COEF_CONST(0.851355195045471),
        COEF_CONST(0.824589252471924), COEF_CONST(0.795836925506592),
        COEF_CONST(0.765167236328125), COEF_CONST(0.732654273509979),
        COEF_CONST(0.698376238346100), COEF_CONST(0.662415742874146),
        COEF_CONST(0.624859452247620), COEF_CONST(0.585797846317291),
        COEF_CONST(0.545324981212616), COEF_CONST(0.503538429737091),
        COEF_CONST(0.460538715124130), COEF_CONST(0.416429549455643),
        COEF_CONST(0.371317148208618), COEF_CONST(0.325310230255127),
        COEF_CONST(0.278519600629807), COEF_CONST(0.231058135628700),
        COEF_CONST(0.183039888739586), COEF_CONST(0.134580686688423),
        COEF_CONST(0.085797272622585), COEF_CONST(0.036807164549828),
        COEF_CONST(-1.012196302413940), COEF_CONST(-1.059438824653626),
        COEF_CONST(-1.104129195213318), COEF_CONST(-1.146159529685974),
        COEF_CONST(-1.185428738594055), COEF_CONST(-1.221842169761658),
        COEF_CONST(-1.255311965942383), COEF_CONST(-1.285757660865784),
        COEF_CONST(-1.313105940818787), COEF_CONST(-1.337290763854981),
        COEF_CONST(-1.358253836631775), COEF_CONST(-1.375944852828980),
        COEF_CONST(-1.390321016311646), COEF_CONST(-1.401347875595093),
        COEF_CONST(-1.408998727798462), COEF_CONST(-1.413255214691162),
        COEF_CONST(-1.414107084274292), COEF_CONST(-1.411552190780640),
        COEF_CONST(-1.405596733093262), COEF_CONST(-1.396255016326904),
        COEF_CONST(-1.383549690246582), COEF_CONST(-1.367511272430420),
        COEF_CONST(-1.348178386688232), COEF_CONST(-1.325597524642944),
        COEF_CONST(-1.299823284149170), COEF_CONST(-1.270917654037476),
        COEF_CONST(-1.238950133323669), COEF_CONST(-1.203998088836670),
        COEF_CONST(-1.166145324707031), COEF_CONST(-1.125483393669128),
        COEF_CONST(-1.082109928131104), COEF_CONST(-1.036129593849182),
        COEF_CONST(-0.987653195858002), COEF_CONST(-0.936797380447388),
        COEF_CONST(-0.883684754371643), COEF_CONST(-0.828443288803101),
        COEF_CONST(-0.771206021308899), COEF_CONST(-0.712110757827759),
        COEF_CONST(-0.651300072669983), COEF_CONST(-0.588920354843140),
        COEF_CONST(-0.525121808052063), COEF_CONST(-0.460058242082596),
        COEF_CONST(-0.393886327743530), COEF_CONST(-0.326765477657318),
        COEF_CONST(-0.258857429027557), COEF_CONST(-0.190325915813446),
        COEF_CONST(-0.121335685253143), COEF_CONST(-0.052053272724152),
        COEF_CONST(0.017354607582092), COEF_CONST(0.086720645427704),
        COEF_CONST(0.155877828598022), COEF_CONST(0.224659323692322),
        COEF_CONST(0.292899727821350), COEF_CONST(0.360434412956238),
        COEF_CONST(0.427100926637650), COEF_CONST(0.492738455533981),
        COEF_CONST(0.557188928127289), COEF_CONST(0.620297133922577),
        COEF_CONST(0.681910991668701), COEF_CONST(0.741881847381592),
        COEF_CONST(0.800065577030182), COEF_CONST(0.856321990489960),
        COEF_CONST(0.910515367984772), COEF_CONST(0.962515234947205),
        COEF_CONST(1.000000000000000), COEF_CONST(0.998795449733734),
        COEF_CONST(0.995184719562531), COEF_CONST(0.989176511764526),
        COEF_CONST(0.980785250663757), COEF_CONST(0.970031261444092),
        COEF_CONST(0.956940352916718), COEF_CONST(0.941544055938721),
        COEF_CONST(0.923879504203796), COEF_CONST(0.903989315032959),
        COEF_CONST(0.881921231746674), COEF_CONST(0.857728600502014),
        COEF_CONST(0.831469595432281), COEF_CONST(0.803207516670227),
        COEF_CONST(0.773010432720184), COEF_CONST(0.740951120853424),
        COEF_CONST(0.707106769084930), COEF_CONST(0.671558916568756),
        COEF_CONST(0.634393274784088), COEF_CONST(0.595699310302734),
        COEF_CONST(0.555570185184479), COEF_CONST(0.514102697372437),
        COEF_CONST(0.471396654844284), COEF_CONST(0.427555114030838),
        COEF_CONST(0.382683426141739), COEF_CONST(0.336889833211899),
        COEF_CONST(0.290284633636475), COEF_CONST(0.242980122566223),
        COEF_CONST(0.195090234279633), COEF_CONST(0.146730497479439),
        COEF_CONST(0.098017133772373), COEF_CONST(0.049067649990320),
        COEF_CONST(-1.000000000000000), COEF_CONST(-1.047863125801086),
        COEF_CONST(-1.093201875686646), COEF_CONST(-1.135906934738159),
        COEF_CONST(-1.175875544548035), COEF_CONST(-1.213011503219605),
        COEF_CONST(-1.247225046157837), COEF_CONST(-1.278433918952942),
        COEF_CONST(-1.306562900543213), COEF_CONST(-1.331544399261475),
        COEF_CONST(-1.353317975997925), COEF_CONST(-1.371831417083740),
        COEF_CONST(-1.387039899826050), COEF_CONST(-1.398906826972961),
        COEF_CONST(-1.407403707504273), COEF_CONST(-1.412510156631470),
        COEF_CONST(0), COEF_CONST(-1.412510156631470),
        COEF_CONST(-1.407403707504273), COEF_CONST(-1.398906826972961),
        COEF_CONST(-1.387039899826050), COEF_CONST(-1.371831417083740),
        COEF_CONST(-1.353317975997925), COEF_CONST(-1.331544399261475),
        COEF_CONST(-1.306562900543213), COEF_CONST(-1.278433918952942),
        COEF_CONST(-1.247225046157837), COEF_CONST(-1.213011384010315),
        COEF_CONST(-1.175875544548035), COEF_CONST(-1.135907053947449),
        COEF_CONST(-1.093201875686646), COEF_CONST(-1.047863125801086),
        COEF_CONST(-1.000000000000000), COEF_CONST(-0.949727773666382),
        COEF_CONST(-0.897167563438416), COEF_CONST(-0.842446029186249),
        COEF_CONST(-0.785694956779480), COEF_CONST(-0.727051079273224),
        COEF_CONST(-0.666655659675598), COEF_CONST(-0.604654192924500),
        COEF_CONST(-0.541196048259735), COEF_CONST(-0.476434230804443),
        COEF_CONST(-0.410524487495422), COEF_CONST(-0.343625843524933),
        COEF_CONST(-0.275899350643158), COEF_CONST(-0.207508206367493),
        COEF_CONST(-0.138617098331451), COEF_CONST(-0.069392144680023),
        COEF_CONST(0), COEF_CONST(0.069392263889313),
        COEF_CONST(0.138617157936096), COEF_CONST(0.207508206367493),
        COEF_CONST(0.275899469852448), COEF_CONST(0.343625962734222),
        COEF_CONST(0.410524636507034), COEF_CONST(0.476434201002121),
        COEF_CONST(0.541196107864380), COEF_CONST(0.604654192924500),
        COEF_CONST(0.666655719280243), COEF_CONST(0.727051138877869),
        COEF_CONST(0.785695075988770), COEF_CONST(0.842446029186249),
        COEF_CONST(0.897167563438416), COEF_CONST(0.949727773666382)
    };
    /*}}}*/

    /*{{{*/
    /* size 64 only! */
    void dct4_kernel(real_t * in_real, real_t * in_imag, real_t * out_real, real_t * out_imag)
    {
        // Tables with bit reverse values for 5 bits, bit reverse of i at i-th position
        const uint8_t bit_rev_tab[32] = { 0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23,15,31 };
        uint32_t i, i_rev;

        /* Step 2: modulate */
        // 3*32=96 multiplications
        // 3*32=96 additions
        for (i = 0; i < 32; i++)
        {
          real_t x_re, x_im, tmp;
          x_re = in_real[i];
          x_im = in_imag[i];
            tmp =        MUL_C(x_re + x_im, dct4_64_tab[i]);
            in_real[i] = MUL_C(x_im, dct4_64_tab[i + 64]) + tmp;
            in_imag[i] = MUL_C(x_re, dct4_64_tab[i + 32]) + tmp;
        }

        /* Step 3: FFT, but with output in bit reverse order */
        fft_dif(in_real, in_imag);

        /* Step 4: modulate + bitreverse reordering */
        // 3*31+2=95 multiplications
        // 3*31+2=95 additions
        for (i = 0; i < 16; i++)
        {
          real_t x_re, x_im, tmp;
          i_rev = bit_rev_tab[i];
          x_re = in_real[i_rev];
          x_im = in_imag[i_rev];

            tmp =         MUL_C(x_re + x_im, dct4_64_tab[i + 3*32]);
            out_real[i] = MUL_C(x_im, dct4_64_tab[i + 5*32]) + tmp;
            out_imag[i] = MUL_C(x_re, dct4_64_tab[i + 4*32]) + tmp;
        }
        // i = 16, i_rev = 1 = rev(16);
        out_imag[16] = MUL_C(in_imag[1] - in_real[1], dct4_64_tab[16 + 3*32]);
        out_real[16] = MUL_C(in_real[1] + in_imag[1], dct4_64_tab[16 + 3*32]);
        for (i = 17; i < 32; i++)
        {
          real_t x_re, x_im, tmp;
          i_rev = bit_rev_tab[i];
          x_re = in_real[i_rev];
          x_im = in_imag[i_rev];
            tmp =         MUL_C(x_re + x_im, dct4_64_tab[i + 3*32]);
            out_real[i] = MUL_C(x_im, dct4_64_tab[i + 5*32]) + tmp;
            out_imag[i] = MUL_C(x_re, dct4_64_tab[i + 4*32]) + tmp;
        }

    }
    /*}}}*/
  #endif

  /*{{{*/
  void hf_generation (sbr_info *sbr, qmf_t Xlow[MAX_NTSRHFG][64],
                     qmf_t Xhigh[MAX_NTSRHFG][64]
  #ifdef SBR_LOW_POWER
                     ,real_t *deg
  #endif
                     ,uint8_t ch)
  {
      uint8_t l, i, x;
      ALIGN complex_t alpha_0[64], alpha_1[64];
  #ifdef SBR_LOW_POWER
      ALIGN real_t rxx[64];
  #endif

      uint8_t offset = sbr->tHFAdj;
      uint8_t first = sbr->t_E[ch][0];
      uint8_t last = sbr->t_E[ch][sbr->L_E[ch]];

      calc_chirp_factors(sbr, ch);

  #ifdef SBR_LOW_POWER
      memset(deg, 0, 64*sizeof(real_t));
  #endif

      if ((ch == 0) && (sbr->Reset))
          patch_construction(sbr);

      /* calculate the prediction coefficients */
  #ifdef SBR_LOW_POWER
      calc_prediction_coef_lp(sbr, Xlow, alpha_0, alpha_1, rxx);
      calc_aliasing_degree(sbr, rxx, deg);
  #endif

      /* actual HF generation */
      for (i = 0; i < sbr->noPatches; i++)
      {
          for (x = 0; x < sbr->patchNoSubbands[i]; x++)
          {
              real_t a0_r, a0_i, a1_r, a1_i;
              real_t bw, bw2;
              uint8_t q, p, k, g;

              /* find the low and high band for patching */
              k = sbr->kx + x;
              for (q = 0; q < i; q++)
              {
                  k += sbr->patchNoSubbands[q];
              }
              p = sbr->patchStartSubband[i] + x;

  #ifdef SBR_LOW_POWER
              if (x != 0 /*x < sbr->patchNoSubbands[i]-1*/)
                  deg[k] = deg[p];
              else
                  deg[k] = 0;
  #endif

              g = sbr->table_map_k_to_g[k];

              bw = sbr->bwArray[ch][g];
              bw2 = MUL_C(bw, bw);

              /* do the patching */
              /* with or without filtering */
              if (bw2 > 0)
              {
                  real_t temp1_r, temp2_r, temp3_r;
  #ifndef SBR_LOW_POWER
                  real_t temp1_i, temp2_i, temp3_i;
                  calc_prediction_coef(sbr, Xlow, alpha_0, alpha_1, p);
  #endif

                  a0_r = MUL_C(RE(alpha_0[p]), bw);
                  a1_r = MUL_C(RE(alpha_1[p]), bw2);
  #ifndef SBR_LOW_POWER
                  a0_i = MUL_C(IM(alpha_0[p]), bw);
                  a1_i = MUL_C(IM(alpha_1[p]), bw2);
  #endif

                temp2_r = QMF_RE(Xlow[first - 2 + offset][p]);
                temp3_r = QMF_RE(Xlow[first - 1 + offset][p]);
  #ifndef SBR_LOW_POWER
                temp2_i = QMF_IM(Xlow[first - 2 + offset][p]);
                temp3_i = QMF_IM(Xlow[first - 1 + offset][p]);
  #endif
          for (l = first; l < last; l++)
                  {
                    temp1_r = temp2_r;
                    temp2_r = temp3_r;
                    temp3_r = QMF_RE(Xlow[l + offset][p]);
  #ifndef SBR_LOW_POWER
                    temp1_i = temp2_i;
                    temp2_i = temp3_i;
                      temp3_i = QMF_IM(Xlow[l + offset][p]);
  #endif

  #ifdef SBR_LOW_POWER
                      QMF_RE(Xhigh[l + offset][k]) =
                          temp3_r
                        +(MUL_R(a0_r, temp2_r) +
                          MUL_R(a1_r, temp1_r));
  #else
                      QMF_RE(Xhigh[l + offset][k]) =
                          temp3_r
                        +(MUL_R(a0_r, temp2_r) -
                          MUL_R(a0_i, temp2_i) +
                          MUL_R(a1_r, temp1_r) -
                          MUL_R(a1_i, temp1_i));
                      QMF_IM(Xhigh[l + offset][k]) =
                          temp3_i
                        +(MUL_R(a0_i, temp2_r) +
                          MUL_R(a0_r, temp2_i) +
                          MUL_R(a1_i, temp1_r) +
                          MUL_R(a1_r, temp1_i));
  #endif
                  }
              } else {
                  for (l = first; l < last; l++)
                  {
                      QMF_RE(Xhigh[l + offset][k]) = QMF_RE(Xlow[l + offset][p]);
  #ifndef SBR_LOW_POWER
                      QMF_IM(Xhigh[l + offset][k]) = QMF_IM(Xlow[l + offset][p]);
  #endif
                  }
              }
          }
      }

      if (sbr->Reset)
      {
          limiter_frequency_table(sbr);
      }
  }
  /*}}}*/
  /*{{{*/
  uint8_t hf_adjustment(sbr_info *sbr, qmf_t Xsbr[MAX_NTSRHFG][64]
  #ifdef SBR_LOW_POWER
                        ,real_t *deg /* aliasing degree */
  #endif
                        ,uint8_t ch)
  {
      ALIGN sbr_hfadj_info adj = {{{0}}};
      uint8_t ret = 0;

      if (sbr->bs_frame_class[ch] == FIXFIX)
      {
          sbr->l_A[ch] = -1;
      } else if (sbr->bs_frame_class[ch] == VARFIX) {
          if (sbr->bs_pointer[ch] > 1)
              sbr->l_A[ch] = sbr->bs_pointer[ch] - 1;
          else
              sbr->l_A[ch] = -1;
      } else {
          if (sbr->bs_pointer[ch] == 0)
              sbr->l_A[ch] = -1;
          else
              sbr->l_A[ch] = sbr->L_E[ch] + 1 - sbr->bs_pointer[ch];
      }

      ret = estimate_current_envelope(sbr, &adj, Xsbr, ch);
      if (ret > 0)
          return 1;

      calculate_gain(sbr, &adj, ch);

  #ifdef SBR_LOW_POWER
      calc_gain_groups(sbr, &adj, deg, ch);
      aliasing_reduction(sbr, &adj, deg, ch);
  #endif

      hf_assembly(sbr, &adj, Xsbr, ch);

      return 0;
  }

  /*}}}*/

  /*{{{*/
  qmfa_info* qmfa_init (uint8_t channels) {

    qmfa_info *qmfa = (qmfa_info*)faad_malloc(sizeof(qmfa_info));

    /* x is implemented as double ringbuffer */
    qmfa->x = (real_t*)faad_malloc(2 * channels * 10 * sizeof(real_t));
    memset(qmfa->x, 0, 2 * channels * 10 * sizeof(real_t));

    /* ringbuffer index */
    qmfa->x_index = 0;
    qmfa->channels = channels;

    return qmfa;
    }
  /*}}}*/
  /*{{{*/
  void qmfa_end (qmfa_info *qmfa) {

    if (qmfa)
      faad_free(qmfa->x);
    faad_free(qmfa);
    }
  /*}}}*/
  /*{{{*/
  void sbr_qmf_analysis_32 (sbr_info *sbr, qmfa_info *qmfa, const real_t *input,
                            qmf_t X[MAX_NTSRHFG][64], uint8_t offset, uint8_t kx) {

    ALIGN real_t u[64];
  #ifndef SBR_LOW_POWER
    ALIGN real_t in_real[32], in_imag[32], out_real[32], out_imag[32];
  #else
    ALIGN real_t y[32];
  #endif
    uint32_t in = 0;
    uint8_t l;

    /* qmf subsample l */
    for (l = 0; l < sbr->numTimeSlotsRate; l++) {
      int16_t n;

      /* shift input buffer x */
      /* input buffer is not shifted anymore, x is implemented as double ringbuffer */
      //memmove(qmfa->x + 32, qmfa->x, (320-32)*sizeof(real_t));

      /* add new samples to input buffer x */
      for (n = 32 - 1; n >= 0; n--)
        qmfa->x[qmfa->x_index + n] = qmfa->x[qmfa->x_index + n + 320] = input[in++];

      /* window and summation to create array u */
      for (n = 0; n < 64; n++)
        u[n] = MUL_F(qmfa->x[qmfa->x_index + n], qmf_c[2*n]) +
               MUL_F(qmfa->x[qmfa->x_index + n + 64], qmf_c[2*(n + 64)]) +
               MUL_F(qmfa->x[qmfa->x_index + n + 128], qmf_c[2*(n + 128)]) +
               MUL_F(qmfa->x[qmfa->x_index + n + 192], qmf_c[2*(n + 192)]) +
               MUL_F(qmfa->x[qmfa->x_index + n + 256], qmf_c[2*(n + 256)]);

      /* update ringbuffer index */
      qmfa->x_index -= 32;
      if (qmfa->x_index < 0)
        qmfa->x_index = (320-32);

      /* calculate 32 subband samples by introducing X */
  #ifdef SBR_LOW_POWER
      y[0] = u[48];
      for (n = 1; n < 16; n++)
        y[n] = u[n+48] + u[48-n];
      for (n = 16; n < 32; n++)
        y[n] = -u[n-16] + u[48-n];

      DCT3_32_unscaled(u, y);
      for (n = 0; n < 32; n++) {
        if (n < kx)
          QMF_RE(X[l + offset][n]) = 2. * u[n];
        else
          QMF_RE(X[l + offset][n]) = 0;
        }
  #else
      // Reordering of data moved from DCT_IV to here
      in_imag[31] = u[1];
      in_real[0] = u[0];
      for (n = 1; n < 31; n++) {
        in_imag[31 - n] = u[n+1];
        in_real[n] = -u[64-n];
        }
      in_imag[0] = u[32];
      in_real[31] = -u[33];

      // dct4_kernel is DCT_IV without reordering which is done before and after FFT
      dct4_kernel(in_real, in_imag, out_real, out_imag);

      // Reordering of data moved from DCT_IV to here
      for (n = 0; n < 16; n++) {
        if (2*n+1 < kx) {
          QMF_RE(X[l + offset][2*n])   = 2. * out_real[n];
          QMF_IM(X[l + offset][2*n])   = 2. * out_imag[n];
          QMF_RE(X[l + offset][2*n+1]) = -2. * out_imag[31-n];
          QMF_IM(X[l + offset][2*n+1]) = -2. * out_real[31-n];
          }
        else {
          if (2*n < kx) {
            QMF_RE(X[l + offset][2*n])   = 2. * out_real[n];
            QMF_IM(X[l + offset][2*n])   = 2. * out_imag[n];
            }
          else {
            QMF_RE(X[l + offset][2*n]) = 0;
            QMF_IM(X[l + offset][2*n]) = 0;
            }
          QMF_RE(X[l + offset][2*n+1]) = 0;
          QMF_IM(X[l + offset][2*n+1]) = 0;
          }
        }
  #endif
      }
    }
  /*}}}*/

  /*{{{*/
  qmfs_info* qmfs_init (uint8_t channels)
  {
      qmfs_info *qmfs = (qmfs_info*)faad_malloc(sizeof(qmfs_info));

    /* v is a double ringbuffer */
      qmfs->v = (real_t*)faad_malloc(2 * channels * 20 * sizeof(real_t));
      memset(qmfs->v, 0, 2 * channels * 20 * sizeof(real_t));

      qmfs->v_index = 0;

      qmfs->channels = channels;

      return qmfs;
  }
  /*}}}*/
  /*{{{*/
  void qmfs_end (qmfs_info *qmfs) {

    if (qmfs)
      faad_free(qmfs->v);
    faad_free(qmfs);
    }
  /*}}}*/
#endif
